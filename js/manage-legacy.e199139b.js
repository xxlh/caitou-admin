"use strict";(self["webpackChunkvue_antd_pro"]=self["webpackChunkvue_antd_pro"]||[]).push([[690],{89051:function(e,t,r){r.r(t),r.d(t,{default:function(){return m}});var a=function(){var e=this,t=e._self._c;return t("a-card",{attrs:{bordered:!1}},[t("content-header",{attrs:{title:"管理员设置"}}),t("a-spin",{attrs:{spinning:e.isLoading}},[t("a-form",{attrs:{form:e.form}},[t("a-form-item",{attrs:{label:"姓名",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"管理员姓名"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["real_name",{rules:[{required:!0,min:2,message:"请输入至少2个字符"}]}],expression:"['real_name', {rules: [{required: true, min: 2, message: '请输入至少2个字符'}]}]"}]})],1),t("a-form-item",{attrs:{label:"用户名",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"后台登录用户名"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["user_name",{rules:[{required:!0,min:4,message:"请输入至少4个字符"}]}],expression:"['user_name', {rules: [{required: true, min: 4, message: '请输入至少4个字符'}]}]"}]})],1),t("a-form-item",{attrs:{label:"用户密码",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"后台登录密码"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["password",{rules:[{min:6,message:"请输入至少6个字符"}]}],expression:"['password', {rules: [{min: 6, message: '请输入至少6个字符'}]}]"}],attrs:{type:"password"}})],1),t("a-form-item",{attrs:{label:"确认密码",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["password_confirm",{rules:[{message:"请输入确认密码"},{validator:e.compareToFirstPassword}]}],expression:"['password_confirm', {rules: [\n            {message: '请输入确认密码'},\n            {validator: compareToFirstPassword}\n          ]}]"}],attrs:{type:"password"}})],1),t("a-form-item",{attrs:{wrapperCol:{span:13,offset:6}}},[t("a-button",{attrs:{type:"primary",loading:e.isLoading,disabled:e.isLoading},on:{click:e.handleSubmit}},[e._v("提交")])],1)],1)],1)],1)},n=[],i=(r(26099),r(74123)),o=r(47695),s=r(2543),l=r.n(s),c={name:"TableList",components:{ContentHeader:o.dv,STable:o.Wd},data:function(){return{labelCol:{span:6},wrapperCol:{span:13},isLoading:!1,form:this.$form.createForm(this)}},mounted:function(){this.getInfo()},methods:{getInfo:function(){var e=this;this.isLoading=!0,i.Vp().then((function(t){var r=t.data.userInfo;e.form.setFieldsValue(l().pick(r,"user_name","real_name"))})).finally((function(){e.isLoading=!1}))},compareToFirstPassword:function(e,t,r){var a=this.form,n=a.getFieldValue("password");return!n||t===n||new Error("您输入的确认密码不一致")},handleSubmit:function(e){var t=this;e.preventDefault();var r=this.form.validateFields;r((function(e,r){e||(t.isLoading=!0,t.onFormSubmit(r).finally((function(){t.isLoading=!1})))}))},onFormSubmit:function(e){var t=this;return i.qV({form:e}).then((function(e){t.$message.success(e.message),setTimeout((function(){window.location.reload()}),800)}))}}},u=c,d=r(81656),h=(0,d.A)(u,a,n,!1,null,null,null),m=h.exports},28713:function(e,t,r){r.r(t),r.d(t,{default:function(){return N}});var a=function(){var e=this,t=e._self._c;return t("a-card",{attrs:{bordered:!1}},[t("div",{staticClass:"card-title"},[e._v(e._s(e.$route.meta.title))]),t("div",{staticClass:"table-operator"},[t("a-button",{attrs:{type:"primary",icon:"plus"},on:{click:e.handleAdd}},[e._v("新增")])],1),e.isLoading?e._e():t("a-table",{attrs:{rowKey:"id",columns:e.columns,dataSource:e.roleList,defaultExpandAllRows:!0,expandIconColumnIndex:1,pagination:!1,loading:e.isLoading},scopedSlots:e._u([{key:"action",fn:function(r,a){return t("span",{},[[t("a",{directives:[{name:"action",rawName:"v-action:update",arg:"update"}],staticStyle:{"margin-right":"8px"},on:{click:function(t){return e.handleEdit(a)}}},[e._v("编辑")]),t("a",{directives:[{name:"action",rawName:"v-action:delete",arg:"delete"}],on:{click:function(t){return e.handleDelete(a)}}},[e._v("删除")])]],2)}}],null,!1,3241514144)}),t("AddForm",{ref:"AddForm",attrs:{roleList:e.roleList,menuList:e.menuList},on:{handleSubmit:e.handleRefresh}}),t("EditForm",{ref:"EditForm",attrs:{roleList:e.roleList,menuList:e.menuList},on:{handleSubmit:e.handleRefresh}})],1)},n=[],i=r(69870),o=r(17654),s=(r(26099),r(37280)),l=r(26222),c={list:"/store.menu/list"};function u(e){return(0,l.p)({url:c.list,method:"get",params:e})}var d=r(47695),h=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"新增角色",width:720,visible:e.visible,confirmLoading:e.confirmLoading,maskClosable:!1},on:{ok:e.handleSubmit,cancel:e.handleCancel}},[t("a-spin",{attrs:{spinning:e.confirmLoading}},[t("a-form",{attrs:{form:e.form}},[t("a-form-item",{attrs:{label:"角色名称",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["role_name",{rules:[{required:!0,min:2,message:"请输入至少2个字符"}]}],expression:"['role_name', {rules: [{required: true, min: 2, message: '请输入至少2个字符'}]}]"}]})],1),t("a-form-item",{attrs:{label:"上级角色",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-tree-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["parent_id"],expression:"['parent_id']"}],attrs:{treeData:e.roleListTree,dropdownStyle:{maxHeight:"400px",overflow:"auto"},allowClear:""}})],1),t("a-form-item",{attrs:{label:"菜单权限",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"设置该角色有权操作的功能"}},[t("a-tree",{ref:"MenuTree",attrs:{checkable:"",checkStrictly:"",treeData:e.menuListTreeData,autoExpandParent:!1},on:{check:e.onCheckedMenu},model:{value:e.checkedKeys,callback:function(t){e.checkedKeys=t},expression:"checkedKeys"}})],1),t("a-form-item",{attrs:{label:"排序",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"数字越小越靠前"}},[t("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["sort",{initialValue:100,rules:[{required:!0,message:"请输入至少1个数字"}]}],expression:"['sort', {initialValue: 100, rules: [{required: true, message: '请输入至少1个数字'}]}]"}],attrs:{min:0}})],1)],1)],1)],1)},m=[],f=r(9133),p=r(57888),v=(r(28706),r(62010),r(23500),r(2543)),g=r.n(v),w={props:{roleList:{type:Array,required:!0},menuList:{type:Array,required:!0}},data:function(){return{title:"",labelCol:{span:7},wrapperCol:{span:13},visible:!1,confirmLoading:!1,form:this.$form.createForm(this),roleListTree:[],menuListTreeData:[],checkedKeys:{checked:[],halfChecked:[]}}},methods:{add:function(){this.visible=!0,this.getRoleList(),this.getMenuList()},getMenuList:function(){var e=this.menuList;this.menuListTreeData=this.formatTreeDataForMenuList(e)},onCheckedMenu:function(e,t){var r=t.checked,a=t.node,n=this.menuListTreeData,i=this.findNode(a.eventKey,n);this.onCheckChilds(r,i),this.onCheckParents(r,i)},findNode:function(e,t){for(var r=0;r<t.length;r++){var a=t[r];if(a.key===e)return a;if(a.children){var n=this.findNode(e,a.children);if(n)return n}}return!1},onCheckParents:function(e,t){var r=this,a=this.menuListTreeData,n=function e(t){var n=[],i=r.findNode(t,a);if(!i)return n;if(n.push(i.key),i.children){var o=e(i.parentKey);o.length&&(n=n.concat(o))}return n},i=n(t.parentKey);e&&i.length&&(this.checkedKeys.checked=g().union(this.checkedKeys.checked,i))},onCheckChilds:function(e,t){var r=t.children?this.getAllMenuKeys(t.children):[];r.length&&(this.checkedKeys.checked=e?g().union(this.checkedKeys.checked,r):g().difference(this.checkedKeys.checked,r))},getAllMenuKeys:function(e){var t=this,r=[];return e.forEach((function(e){if(r.push(e.key),e.children&&e.children.length){var a=t.getAllMenuKeys(e.children);a.length&&(r=r.concat(a))}})),r},getRoleList:function(){var e=this.roleList,t=this.formatTreeForRoleList(e);t.unshift({title:"顶级角色",key:0,value:0}),this.roleListTree=t},formatTreeForRoleList:function(e){var t=this,r=[];return e.forEach((function(e){var a={title:e.role_name,key:e.role_id,value:e.role_id};e.children&&e.children.length&&(a["children"]=t.formatTreeForRoleList(e["children"])),r.push(a)})),r},formatTreeDataForMenuList:function(e){var t=this,r=[];return e.forEach((function(e){var a={title:e.name,key:e.menu_id,parentKey:e.parent_id};e.children&&e.children.length&&(a["children"]=t.formatTreeDataForMenuList(e["children"])),r.push(a)})),r},handleSubmit:function(e){var t=this;e.preventDefault();var r=this.form.validateFields;r((function(e,r){e||t.onFormSubmit((0,p.A)((0,p.A)({},r),{},{menus:t.getCheckedKeys()}))}))},getCheckedKeys:function(){var e=this.$refs.MenuTree;return[].concat((0,f.A)(e.getCheckedKeys()),(0,f.A)(e.getHalfCheckedKeys()))},handleCancel:function(){this.visible=!1,this.form.resetFields();var e=this.$refs.MenuTree;e.clearExpandedKeys(),this.checkedKeys.checked=[]},onFormSubmit:function(e){var t=this;this.confirmLoading=!0,s.WQ({form:e}).then((function(r){t.$message.success(r.message,1.5),t.handleCancel(),t.$emit("handleSubmit",e)})).finally((function(e){t.confirmLoading=!1}))}}},y=w,b=r(81656),C=(0,b.A)(y,h,m,!1,null,null,null),L=C.exports,k=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"编辑角色",width:720,visible:e.visible,confirmLoading:e.confirmLoading,maskClosable:!1},on:{ok:e.handleSubmit,cancel:e.handleCancel}},[t("a-spin",{attrs:{spinning:e.confirmLoading}},[t("a-form",{attrs:{form:e.form}},[t("a-form-item",{attrs:{label:"角色名称",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["role_name",{rules:[{required:!0,min:2,message:"请输入至少2个字符"}]}],expression:"['role_name', {rules: [{required: true, min: 2, message: '请输入至少2个字符'}]}]"}]})],1),t("a-form-item",{attrs:{label:"上级角色",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-tree-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["parent_id"],expression:"['parent_id']"}],attrs:{treeData:e.roleListTree,dropdownStyle:{maxHeight:"400px",overflow:"auto"},allowClear:""}})],1),t("a-form-item",{attrs:{label:"菜单权限",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"设置该角色有权操作的功能"}},[t("a-tree",{ref:"MenuTree",attrs:{checkable:"",checkStrictly:"",treeData:e.menuListTreeData,autoExpandParent:!1},on:{check:e.onCheckedMenu},model:{value:e.checkedKeys,callback:function(t){e.checkedKeys=t},expression:"checkedKeys"}})],1),t("a-form-item",{attrs:{label:"排序",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"数字越小越靠前"}},[t("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["sort",{initialValue:100,rules:[{required:!0,message:"请输入至少1个数字"}]}],expression:"['sort', {initialValue: 100, rules: [{required: true, message: '请输入至少1个数字'}]}]"}],attrs:{min:0}})],1)],1)],1)],1)},x=[],_=(r(74423),r(21699),{props:{roleList:{type:Array,required:!0},menuList:{type:Array,required:!0}},data:function(){return{title:"",labelCol:{span:7},wrapperCol:{span:13},visible:!1,confirmLoading:!1,form:this.$form.createForm(this),record:{},roleListTree:[],menuListTreeData:[],checkedKeys:{checked:[],halfChecked:[]}}},methods:{edit:function(e){this.visible=!0,this.record=e,this.getRoleList(),this.getMenuList(),this.setMenuChecked(),this.setFieldsValue()},setFieldsValue:function(){var e=this,t=this.$nextTick,r=this.form.setFieldsValue;t((function(){r(g().pick(e.record,["role_name","parent_id","sort"]))}))},getMenuList:function(){var e=this.menuList;this.menuListTreeData=this.formatTreeDataForMenuList(e)},onCheckedMenu:function(e,t){var r=t.checked,a=t.node,n=this.menuListTreeData,i=this.findNode(a.eventKey,n);this.onCheckChilds(r,i),this.onCheckParents(r,i)},findNode:function(e,t){for(var r=0;r<t.length;r++){var a=t[r];if(a.key===e)return a;if(a.children){var n=this.findNode(e,a.children);if(n)return n}}return!1},onCheckParents:function(e,t){var r=this,a=this.menuListTreeData,n=function e(t){var n=[],i=r.findNode(t,a);if(!i)return n;if(n.push(i.key),i.children){var o=e(i.parentKey);o.length&&(n=n.concat(o))}return n},i=n(t.parentKey);e&&i.length&&(this.checkedKeys.checked=g().union(this.checkedKeys.checked,i))},onCheckChilds:function(e,t){var r=t.children?this.getAllMenuKeys(t.children):[];r.length&&(this.checkedKeys.checked=e?g().union(this.checkedKeys.checked,r):g().difference(this.checkedKeys.checked,r))},getAllMenuKeys:function(e){var t=this,r=[];return e.forEach((function(e){if(r.push(e.key),e.children&&e.children.length){var a=t.getAllMenuKeys(e.children);a.length&&(r=r.concat(a))}})),r},setMenuChecked:function(){var e=this.menuListTreeData,t=this.record,r=this.getAllMenuKeys(e);this.checkedKeys.checked=g().intersection(t.menuIds,r)},getRoleList:function(){var e=this.roleList,t=this.formatTreeForRoleList(e);t.unshift({title:"顶级角色",key:0,value:0}),this.roleListTree=t},formatTreeForRoleList:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=[];return e.forEach((function(e){var n={title:e.role_name,key:e.role_id,value:e.role_id};([e.role_id,e.parent_id].includes(t.record.role_id)||!0===r)&&(n.disabled=!0),e.children&&e.children.length&&(n["children"]=t.formatTreeForRoleList(e["children"],n.disabled)),a.push(n)})),a},formatTreeDataForMenuList:function(e){var t=this,r=[];return e.forEach((function(e){var a={title:e.name,key:e.menu_id,parentKey:e.parent_id};e.children&&e.children.length&&(a["children"]=t.formatTreeDataForMenuList(e["children"])),r.push(a)})),r},handleSubmit:function(e){var t=this;e.preventDefault();var r=this.form.validateFields;r((function(e,r){e||t.onFormSubmit((0,p.A)((0,p.A)({},r),{},{menus:t.getCheckedKeys()}))}))},getCheckedKeys:function(){var e=this.$refs.MenuTree;return[].concat((0,f.A)(e.getCheckedKeys()),(0,f.A)(e.getHalfCheckedKeys()))},handleCancel:function(){this.visible=!1,this.form.resetFields();var e=this.$refs.MenuTree;e.clearExpandedKeys(),this.checkedKeys.checked=[]},onFormSubmit:function(e){var t=this;this.confirmLoading=!0,s.hc({roleId:this.record["role_id"],form:e}).then((function(r){t.$message.success(r.message,1.5),t.handleCancel(),t.$emit("handleSubmit",e)})).finally((function(e){t.confirmLoading=!1}))}}}),F=_,A=(0,b.A)(F,k,x,!1,null,null,null),S=A.exports,T={name:"Index",components:{STable:d.Wd,AddForm:L,EditForm:S},data:function(){return{roleList:[],queryParam:{},isLoading:!0,columns:[{title:"角色ID",dataIndex:"id"},{title:"角色名称",dataIndex:"name"},{title:"添加时间",dataIndex:"created_at"},{title:"操作",dataIndex:"action",width:"180px",scopedSlots:{customRender:"action"}}],menuList:[]}},created:function(){this.getRoleList()},methods:{getRoleList:function(){var e=this;this.isLoading=!0,s.p_().then((function(t){e.roleList=t.data})).finally((function(t){e.isLoading=!1}))},getMenuList:function(){var e=this;return(0,o.A)((0,i.A)().mark((function t(){return(0,i.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.menuList.length){t.next=4;break}return e.isLoading=!0,t.next=4,u().then((function(t){e.menuList=t.data.list})).finally((function(){e.isLoading=!1}));case 4:case"end":return t.stop()}}),t)})))()},handleAdd:function(){var e=this;return(0,o.A)((0,i.A)().mark((function t(){return(0,i.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getMenuList();case 2:e.$refs.AddForm.add();case 3:case"end":return t.stop()}}),t)})))()},handleEdit:function(e){var t=this;return(0,o.A)((0,i.A)().mark((function r(){return(0,i.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.getMenuList();case 2:t.$refs.EditForm.edit(e);case 3:case"end":return r.stop()}}),r)})))()},handleDelete:function(e){var t=this,r=this.$confirm({title:"您确定要删除该记录吗?",content:"删除后不可恢复",onOk:function(){return s.KF({roleId:e["id"]}).then((function(e){t.$message.success(e.message,1.5),t.handleRefresh()})).finally((function(e){r.destroy()}))}})},handleRefresh:function(){this.getRoleList()}}},K=T,E=(0,b.A)(K,a,n,!1,null,null,null),N=E.exports},27874:function(e,t,r){r.r(t),r.d(t,{default:function(){return R}});r(62010),r(27495),r(5746);var a=function(){var e=this,t=e._self._c;return t("a-card",{attrs:{bordered:!1}},[t("div",{staticClass:"card-title"},[e._v(e._s(e.$route.meta.title))]),t("div",{staticClass:"table-operator"},[t("a-row",[t("a-col",{attrs:{span:6}},[t("a-button",{directives:[{name:"action",rawName:"v-action:create",arg:"create"}],attrs:{type:"primary",icon:"plus"},on:{click:e.handleAdd}},[e._v("新增")])],1),t("a-col",{attrs:{span:8,offset:10}},[t("a-input-search",{staticStyle:{"max-width":"300px","min-width":"150px",float:"right"},attrs:{placeholder:"请输入用户名/姓名"},on:{search:e.onSearch},model:{value:e.queryParam.search,callback:function(t){e.$set(e.queryParam,"search",t)},expression:"queryParam.search"}})],1)],1)],1),t("s-table",{ref:"table",attrs:{rowKey:"id",loading:e.isLoading,columns:e.columns,data:e.loadData,pageSize:15},scopedSlots:e._u([{key:"username",fn:function(r,a){return t("div",{},[t("span",{staticStyle:{"margin-right":"6px"}},[e._v(e._s(r))]),a.role&&"超级管理员"==a.role.name?t("a-tag",{attrs:{color:"green"}},[e._v("超级管理员")]):e._e()],1)}},{key:"roles",fn:function(r,a){return t("div",{},e._l(r,(function(r,a){return t("a-tag",{key:a,attrs:{color:"超级管理员"==r.name?"green":""}},[e._v(" "+e._s(r.name)+" "),"仓储管理员"==r.name&&e.storeListById[r.store_id]?t("span",[e._v(" ("+e._s(e.storeListById[r.store_id].name)+")")]):e._e(),"区域管理员"==r.name&&e.areaListById[r.store_id]?t("span",[e._v(" ("+e._s(e.areaListById[r.store_id].name)+")")]):e._e()])})),1)}},{key:"action",fn:function(r,a){return t("div",{staticClass:"actions"},[t("a",{directives:[{name:"action",rawName:"v-action:update",arg:"update"}],on:{click:function(t){return e.handleEdit(a)}}},[e._v("编辑")]),a.role&&"超级管理员"==a.role.name?e._e():[t("a",{directives:[{name:"action",rawName:"v-action:update",arg:"update"}],on:{click:function(t){return e.handleAssign(a)}}},[e._v("分配角色")]),t("a",{directives:[{name:"action",rawName:"v-action:delete",arg:"delete"}],on:{click:function(t){return e.handleDelete(a)}}},[e._v("删除")])]],2)}}])}),t("AddForm",{ref:"AddForm",on:{handleSubmit:e.handleRefresh}}),t("EditForm",{ref:"EditForm",on:{handleSubmit:e.handleRefresh}}),t("AssignForm",{ref:"AssignForm",attrs:{roleList:e.roleList,storeList:e.storeList,areaList:e.areaList},on:{handleSubmit:e.handleRefresh}})],1)},n=[],i=r(69870),o=r(17654),s=r(57888),l=(r(26099),r(74123)),c=r(37280),u=r(47695),d=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:e.title,width:720,visible:e.visible,confirmLoading:e.confirmLoading,maskClosable:!1},on:{ok:e.handleSubmit,cancel:e.handleCancel}},[t("a-spin",{attrs:{spinning:e.confirmLoading}},[t("a-form",{attrs:{form:e.form}},[t("a-form-item",{attrs:{label:"管理员姓名",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,min:2,message:"请输入至少2个字符"}]}],expression:"['name', {rules: [{required: true, min: 2, message: '请输入至少2个字符'}]}]"}]})],1),t("a-form-item",{attrs:{label:"用户名",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"后台登录用户名"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["username",{rules:[{required:!0,min:3,message:"请输入至少4个字符"}]}],expression:"['username', {rules: [{required: true, min: 3, message: '请输入至少4个字符'}]}]"}]})],1),t("a-form-item",{attrs:{label:"用户密码",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"后台登录密码"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["password",{rules:[{required:!0,min:6,message:"请输入至少6个字符"}]}],expression:"['password', {rules: [\n            {required: true, min: 6, message: '请输入至少6个字符'}\n          ]}]"}],attrs:{type:"password"}})],1),t("a-form-item",{attrs:{label:"确认密码",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["password_confirm",{rules:[{required:!0,message:"请输入确认密码"},{validator:e.compareToFirstPassword}]}],expression:"['password_confirm', {rules: [\n            {required: true, message: '请输入确认密码'},\n            {validator: compareToFirstPassword}\n          ]}]"}],attrs:{type:"password"}})],1),t("a-form-item",{attrs:{label:"手机",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["phone",{rules:[{required:!0,message:"请输入手机号"}]}],expression:"['phone', {rules: [{required: true, message: '请输入手机号'}]}]"}]})],1),t("a-form-item",{attrs:{label:"邮箱",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["email",{initialValue:null}],expression:"['email', {initialValue: null}]"}]})],1)],1)],1)],1)},h=[],m=(r(62062),{data:function(){return{title:"",labelCol:{span:7},wrapperCol:{span:13},visible:!1,confirmLoading:!1,form:this.$form.createForm(this)}},methods:{add:function(){this.title="新增管理员",this.visible=!0},handleSubmit:function(e){var t=this;e.preventDefault();var r=this.form.validateFields;r((function(e,r){r.roles&&(r.roles=r.roles.map((function(e){return e.value}))),!e&&t.onFormSubmit(r)}))},handleCancel:function(){this.visible=!1,this.form.resetFields()},compareToFirstPassword:function(e,t,r){var a=this.form;return!t||t===a.getFieldValue("password")||new Error("您输入的确认密码不一致")},onFormSubmit:function(e){var t=this;this.confirmLoading=!0,l.WQ(e).then((function(r){t.$message.success("添加成功",1.5),t.handleCancel(),t.$emit("handleSubmit",e)})).catch((function(e){return t.$message.success(e.message,1.5)})).finally((function(e){t.confirmLoading=!1}))}}}),f=m,p=r(81656),v=(0,p.A)(f,d,h,!1,null,null,null),g=v.exports,w=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:e.title,width:720,visible:e.visible,confirmLoading:e.confirmLoading,maskClosable:!1},on:{ok:e.handleSubmit,cancel:e.handleCancel}},[t("a-spin",{attrs:{spinning:e.confirmLoading}},[t("a-form",{attrs:{form:e.form}},[t("a-form-item",{attrs:{label:"管理员姓名",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,min:2,message:"请输入至少2个字符"}]}],expression:"['name', {rules: [{required: true, min: 2, message: '请输入至少2个字符'}]}]"}]})],1),t("a-form-item",{attrs:{label:"用户名",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"后台登录用户名"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["username",{rules:[{required:!0,min:3,message:"请输入至少3个字符"}]}],expression:"['username', {rules: [{required: true, min: 3, message: '请输入至少3个字符'}]}]"}]})],1),t("a-form-item",{attrs:{label:"用户密码",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"后台登录密码"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["password",{rules:[{min:6,message:"请输入至少6个字符"}]}],expression:"['password', {rules: [{min: 6, message: '请输入至少6个字符'}]}]"}],attrs:{type:"password"}})],1),t("a-form-item",{attrs:{label:"确认密码",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["password_confirm",{rules:[{message:"请输入确认密码"},{validator:e.compareToFirstPassword}]}],expression:"['password_confirm', {rules: [\n            { message: '请输入确认密码'},\n            {validator: compareToFirstPassword}\n          ]}]"}],attrs:{type:"password"}})],1),t("a-form-item",{attrs:{label:"手机",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["phone"],expression:"['phone']"}]})],1),t("a-form-item",{attrs:{label:"邮箱",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["email"],expression:"['email']"}]})],1)],1)],1)],1)},y=[],b=r(2543),C=r.n(b),L={props:{},data:function(){return{title:"",labelCol:{span:7},wrapperCol:{span:13},visible:!1,confirmLoading:!1,form:this.$form.createForm(this),record:{}}},methods:{edit:function(e){this.title="编辑管理员",this.visible=!0,this.record=e,this.setFieldsValue()},setFieldsValue:function(){var e=this,t=this.form.setFieldsValue;this.$nextTick((function(){var r=C().pick(e.record,["username","name","phone","email"]);t(r)}))},handleSubmit:function(e){var t=this;e.preventDefault();var r=this.form.validateFields;r((function(e,r){r.roles&&(r.roles=r.roles.map((function(e){return e.value}))),!e&&t.onFormSubmit(r)}))},handleCancel:function(){this.visible=!1,this.form.resetFields()},compareToFirstPassword:function(e,t,r){var a=this.form;return!t||t===a.getFieldValue("password")||new Error("您输入的确认密码不一致")},onFormSubmit:function(e){var t=this;this.confirmLoading=!0,l.hc(this.record["id"],e).then((function(r){t.$message.success("编辑成功",1.5),t.handleCancel(),t.$emit("handleSubmit",e)})).finally((function(e){t.confirmLoading=!1}))}}},k=L,x=(0,p.A)(k,w,y,!1,null,null,null),_=x.exports,F=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:e.title,width:720,visible:e.visible,confirmLoading:e.confirmLoading,maskClosable:!1},on:{ok:e.handleSubmit,cancel:e.handleCancel}},[t("a-spin",{attrs:{spinning:e.confirmLoading}},[t("a-form",{attrs:{form:e.form}},[t("a-form-item",{attrs:{label:"仓储角色",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"后台管理员角色"}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["role",{rules:[{required:!0,message:"请至少选择一个角色"}]}],expression:"['role', {rules: [{required: true, message: '请至少选择一个角色'}]}]"}],attrs:{options:e.roleList.map((function(e){return{label:e.name,value:e.name}})),dropdownStyle:{maxHeight:"500px",overflow:"auto"},allowClear:""}})],1),t("a-form-item",{directives:[{name:"show",rawName:"v-show",value:"仓储管理员"==e.form.getFieldValue("role"),expression:"form.getFieldValue('role') == '仓储管理员'"}],attrs:{label:"选择对应仓储",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"后台登录密码"}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["store_id",{rules:[{required:"仓储管理员"==e.form.getFieldValue("role"),message:"请至少选择一个对应仓储"}]}],expression:"['store_id', {rules: [{required: form.getFieldValue('role') == '仓储管理员', message: '请至少选择一个对应仓储'}]}]"}],attrs:{options:e.storeList.map((function(e){return{label:e.name,value:e.id}})),dropdownStyle:{maxHeight:"500px",overflow:"auto"},allowClear:""}})],1),t("a-form-item",{directives:[{name:"show",rawName:"v-show",value:"区域管理员"==e.form.getFieldValue("role"),expression:"form.getFieldValue('role') == '区域管理员'"}],attrs:{label:"选择对应区域",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"后台登录密码"}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["area_id",{rules:[{required:"区域管理员"==e.form.getFieldValue("role"),message:"请至少选择一个对应仓储"}]}],expression:"['area_id', {rules: [{required: form.getFieldValue('role') == '区域管理员', message: '请至少选择一个对应仓储'}]}]"}],attrs:{options:e.areaList.map((function(e){return{label:e.name,value:e.id}})),dropdownStyle:{maxHeight:"500px",overflow:"auto"},allowClear:""}})],1)],1)],1)],1)},A=[],S=(r(28706),r(74423),r(21699),r(23500),{props:{roleList:{type:Array,required:!0},storeList:{type:Array,required:!0},areaList:{type:Array,required:!0}},data:function(){return{title:"",labelCol:{span:7},wrapperCol:{span:13},visible:!1,confirmLoading:!1,form:this.$form.createForm(this),roleListTreeData:[],storeListTreeData:[],record:{}}},methods:{edit:function(e){this.title="编辑管理员",this.visible=!0,this.record=e,e.role&&"超级管理员"!=e.role["name"]&&this.getRoleList(),this.setFieldsValue()},setFieldsValue:function(){var e=this,t=this.form.setFieldsValue;this.getCheckedRoleKeys;this.$nextTick((function(){var r=C().pick(e.record,["username","name","sort"]);t(r)}))},getRoleList:function(){this.roleList},getCheckedRoleKeys:function(){var e=this.roleList,t=this.record,r=function e(r){var a=[];return r.forEach((function(r){if(t["roleIds"].includes(r["id"])&&a.push({label:r["name"],value:r["id"]}),r.children&&r.children.length){var n=e(r.children);n.length&&(a=a.concat(n))}})),a};return r(e)},formatTreeData:function(e){var t=this,r=[];return e.forEach((function(e){var a={title:e.name,key:e.id,value:e.id};e.children&&e.children.length&&(a["children"]=t.formatTreeData(e["children"])),r.push(a)})),r},handleSubmit:function(e){var t=this;e.preventDefault();var r=this.form.validateFields;r((function(e,r){r.roles&&(r.roles=r.roles.map((function(e){return e.value}))),!e&&t.onFormSubmit(r)}))},handleCancel:function(){this.visible=!1,this.form.resetFields()},compareToFirstPassword:function(e,t,r){var a=this.form;return!t||t===a.getFieldValue("password")||new Error("您输入的确认密码不一致")},onFormSubmit:function(e){var t=this;this.confirmLoading=!0,l.kp(this.record["id"],e).then((function(r){t.$message.success("已分配角色",1.5),t.handleCancel(),t.$emit("handleSubmit",e)})).finally((function(e){t.confirmLoading=!1}))}}}),T=S,K=(0,p.A)(T,F,A,!1,null,null,null),E=K.exports,N=r(3238),q=r(55472),D={name:"Index",components:{STable:u.Wd,AddForm:g,EditForm:_,AssignForm:E},data:function(){var e=this;return{roleList:[],storeList:[],storeListById:[],areaList:[],areaListById:[],queryParam:{},isLoading:!1,columns:[{title:"管理员ID",dataIndex:"id"},{title:"用户名",dataIndex:"username",scopedSlots:{customRender:"username"}},{title:"姓名",dataIndex:"name"},{title:"角色",dataIndex:"roles",scopedSlots:{customRender:"roles"}},{title:"添加时间",dataIndex:"created_at"},{title:"操作",dataIndex:"action",width:"180px",scopedSlots:{customRender:"action"}}],loadData:function(t){return l.p_((0,s.A)((0,s.A)({},t),e.queryParam)).then((function(e){return e}))}}},created:function(){this.getRoleList(),this.getStoreList(),this.getAreaList()},methods:{handleAdd:function(){this.$refs.AddForm.add()},handleEdit:function(e){this.$refs.EditForm.edit(e)},handleAssign:function(e){this.$refs.AssignForm.edit(e)},getRoleList:function(){var e=this;this.isLoading=!0,c.p_().then((function(t){e.roleList=t.data})).finally((function(){e.isLoading=!1}))},getStoreList:function(){var e=this;return(0,o.A)((0,i.A)().mark((function t(){return(0,i.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,N.p_();case 2:e.storeList=t.sent.data,e.storeListById=C()(e.storeList).keyBy("id").value();case 4:case"end":return t.stop()}}),t)})))()},getAreaList:function(){var e=this;return(0,o.A)((0,i.A)().mark((function t(){return(0,i.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,q.p_();case 2:e.areaList=t.sent.data,e.areaListById=C()(e.areaList).keyBy("id").value();case 4:case"end":return t.stop()}}),t)})))()},handleDelete:function(e){var t=this,r=this.$confirm({title:"您确定要删除该记录吗?",content:"删除后不可恢复",onOk:function(){return l.KF({userId:e["id"]}).then((function(e){t.$message.success(e.message,1.5),t.handleRefresh()})).finally((function(e){r.destroy()}))}})},handleRefresh:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.$refs.table.refresh(e)},onSearch:function(){this.handleRefresh(!0)}}},$=D,I=(0,p.A)($,a,n,!1,null,null,null),R=I.exports},55472:function(e,t,r){r.d(t,{WQ:function(){return o},bW:function(){return l},hc:function(){return s},p_:function(){return i}});r(27495),r(25440);var a=r(26222),n={list:"/areas",add:"/areas",edit:"/areas/{id}",getCategories:"/areas/{id}/categories",setCategories:"/areas/{id}/categorize"};function i(e){return(0,a.p)({url:n.list,method:"get",params:e})}function o(e){return(0,a.p)({url:n.add,method:"post",data:e})}function s(e,t){return(0,a.p)({url:n.edit.replace("{id}",e),method:"patch",data:t})}function l(e){return(0,a.p)({url:n.getCategories.replace("{id}",e),method:"get"})}},3238:function(e,t,r){r.d(t,{KF:function(){return c},Q7:function(){return o},WQ:function(){return s},hc:function(){return l},p_:function(){return i}});r(27495),r(25440);var a=r(26222),n={list:"/stores",all:"/stores",add:"/stores",edit:"/stores/{id}",delete:"/stores/{id}"};function i(e){return(0,a.p)({url:n.list,method:"get",params:e})}function o(e){return(0,a.p)({url:n.all,method:"get",params:e})}function s(e){return(0,a.p)({url:n.add,method:"post",data:e})}function l(e,t){return(0,a.p)({url:n.edit.replace("{id}",e),method:"patch",data:t})}function c(e){return(0,a.p)({url:n.delete.replace("{id}",e),method:"delete"})}},37280:function(e,t,r){r.d(t,{KF:function(){return l},WQ:function(){return o},hc:function(){return s},p_:function(){return i}});var a=r(26222),n={list:"/roles",add:"/roles",edit:"/roles/{id}",delete:"/roles/{id}"};function i(e){return(0,a.p)({url:n.list,method:"get",params:e})}function o(e){return(0,a.p)({url:n.add,method:"post",data:e})}function s(e){return(0,a.p)({url:n.edit,method:"patch",data:e})}function l(e){return(0,a.p)({url:n.delete,method:"delete",data:e})}},17654:function(e,t,r){r.d(t,{A:function(){return n}});r(26099);function a(e,t,r,a,n,i,o){try{var s=e[i](o),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(a,n)}function n(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function s(e){a(o,n,i,s,l,"next",e)}function l(e){a(o,n,i,s,l,"throw",e)}s(void 0)}))}}},69870:function(e,t,r){r.d(t,{A:function(){return n}});r(52675),r(89463),r(66412),r(2259),r(78125),r(34782),r(62010),r(4731),r(60479),r(40875),r(10287),r(26099),r(47764),r(23500),r(62953);var a=r(68285);function n(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
n=function(){return t};var e,t={},r=Object.prototype,i=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},s="function"==typeof Symbol?Symbol:{},l=s.iterator||"@@iterator",c=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag";function d(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{d({},"")}catch(e){d=function(e,t,r){return e[t]=r}}function h(e,t,r,a){var n=t&&t.prototype instanceof y?t:y,i=Object.create(n.prototype),s=new N(a||[]);return o(i,"_invoke",{value:S(e,r,s)}),i}function m(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var f="suspendedStart",p="suspendedYield",v="executing",g="completed",w={};function y(){}function b(){}function C(){}var L={};d(L,l,(function(){return this}));var k=Object.getPrototypeOf,x=k&&k(k(q([])));x&&x!==r&&i.call(x,l)&&(L=x);var _=C.prototype=y.prototype=Object.create(L);function F(e){["next","throw","return"].forEach((function(t){d(e,t,(function(e){return this._invoke(t,e)}))}))}function A(e,t){function r(n,o,s,l){var c=m(e[n],e,o);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==(0,a.A)(d)&&i.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,s,l)}),(function(e){r("throw",e,s,l)})):t.resolve(d).then((function(e){u.value=e,s(u)}),(function(e){return r("throw",e,s,l)}))}l(c.arg)}var n;o(this,"_invoke",{value:function(e,a){function i(){return new t((function(t,n){r(e,a,t,n)}))}return n=n?n.then(i,i):i()}})}function S(t,r,a){var n=f;return function(i,o){if(n===v)throw Error("Generator is already running");if(n===g){if("throw"===i)throw o;return{value:e,done:!0}}for(a.method=i,a.arg=o;;){var s=a.delegate;if(s){var l=T(s,a);if(l){if(l===w)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(n===f)throw n=g,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);n=v;var c=m(t,r,a);if("normal"===c.type){if(n=a.done?g:p,c.arg===w)continue;return{value:c.arg,done:a.done}}"throw"===c.type&&(n=g,a.method="throw",a.arg=c.arg)}}}function T(t,r){var a=r.method,n=t.iterator[a];if(n===e)return r.delegate=null,"throw"===a&&t.iterator["return"]&&(r.method="return",r.arg=e,T(t,r),"throw"===r.method)||"return"!==a&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+a+"' method")),w;var i=m(n,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,w;var o=i.arg;return o?o.done?(r[t.resultName]=o.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,w):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,w)}function K(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function N(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(K,this),this.reset(!0)}function q(t){if(t||""===t){var r=t[l];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function r(){for(;++n<t.length;)if(i.call(t,n))return r.value=t[n],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw new TypeError((0,a.A)(t)+" is not iterable")}return b.prototype=C,o(_,"constructor",{value:C,configurable:!0}),o(C,"constructor",{value:b,configurable:!0}),b.displayName=d(C,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,C):(e.__proto__=C,d(e,u,"GeneratorFunction")),e.prototype=Object.create(_),e},t.awrap=function(e){return{__await:e}},F(A.prototype),d(A.prototype,c,(function(){return this})),t.AsyncIterator=A,t.async=function(e,r,a,n,i){void 0===i&&(i=Promise);var o=new A(h(e,r,a,n),i);return t.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},F(_),d(_,u,"Generator"),d(_,l,(function(){return this})),d(_,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var a in t)r.push(a);return r.reverse(),function e(){for(;r.length;){var a=r.pop();if(a in t)return e.value=a,e.done=!1,e}return e.done=!0,e}},t.values=q,N.prototype={constructor:N,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(E),!t)for(var r in this)"t"===r.charAt(0)&&i.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function a(a,n){return s.type="throw",s.arg=t,r.next=a,n&&(r.method="next",r.arg=e),!!n}for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n],s=o.completion;if("root"===o.tryLoc)return a("end");if(o.tryLoc<=this.prev){var l=i.call(o,"catchLoc"),c=i.call(o,"finallyLoc");if(l&&c){if(this.prev<o.catchLoc)return a(o.catchLoc,!0);if(this.prev<o.finallyLoc)return a(o.finallyLoc)}else if(l){if(this.prev<o.catchLoc)return a(o.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return a(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&i.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var n=a;break}}n&&("break"===e||"continue"===e)&&n.tryLoc<=t&&t<=n.finallyLoc&&(n=null);var o=n?n.completion:{};return o.type=e,o.arg=t,n?(this.method="next",this.next=n.finallyLoc,w):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),w},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),E(r),w}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var a=r.completion;if("throw"===a.type){var n=a.arg;E(r)}return n}}throw Error("illegal catch attempt")},delegateYield:function(t,r,a){return this.delegate={iterator:q(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=e),w}},t}}}]);
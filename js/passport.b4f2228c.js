(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["passport"],{"1da1":function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));r("d3b7");function o(e,t,r,o,n,i,a){try{var s=e[i](a),c=s.value}catch(u){return void r(u)}s.done?t(c):Promise.resolve(c).then(o,n)}function n(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function s(e){o(a,n,i,s,c,"next",e)}function c(e){o(a,n,i,s,c,"throw",e)}s(void 0)}))}}},"2a7a":function(e,t,r){},"34c1":function(e,t,r){"use strict";r("2a7a")},"9b19":function(e,t,r){e.exports=r.p+"assets/logo.a3adccf1.svg"},cedc:function(e,t,r){"use strict";r.r(t);var o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"main"},[e._m(0),r("a-form",{ref:"formLogin",staticClass:"user-layout-login",attrs:{id:"formLogin",form:e.form},on:{submit:e.handleSubmit}},[e.isLoginError?r("a-alert",{attrs:{type:"error",showIcon:"",message:e.loginErrorMsg}}):e._e(),r("a-form-item",[r("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["username",{rules:[{required:!0,message:"您还没有输入用户名"}],validateTrigger:"change"}],expression:"[\n          'username',\n          {rules: [{ required: true, message: '您还没有输入用户名' }], validateTrigger: 'change'}\n        ]"}],staticClass:"login-input",attrs:{size:"large",type:"text",placeholder:"请输入用户名"}},[r("a-icon",{style:{color:"rgba(0,0,0,.25)"},attrs:{slot:"prefix",type:"user"},slot:"prefix"})],1)],1),r("a-form-item",[r("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["password",{rules:[{required:!0,message:"您还没有输入用户密码"}],validateTrigger:"blur"}],expression:"[\n          'password',\n          {rules: [{ required: true, message: '您还没有输入用户密码' }], validateTrigger: 'blur'}\n        ]"}],staticClass:"login-input",attrs:{size:"large",type:"password",autocomplete:"false",placeholder:"请输入用户密码"}},[r("a-icon",{style:{color:"rgba(0,0,0,.25)"},attrs:{slot:"prefix",type:"lock"},slot:"prefix"})],1)],1),r("a-form-item",{staticStyle:{"margin-top":"24px"}},[r("a-button",{staticClass:"login-button",attrs:{size:"large",type:"primary",htmlType:"submit",loading:e.state.loginBtn,disabled:e.state.loginBtn}},[e._v("登陆")])],1)],1),e.userAgent.includes("Mobile")||e.userAgent.includes("wxwork")||e.userAgent.includes("MicroMessenger")?r("a-button",{staticClass:"login-button",attrs:{loading:e.state.weworkLogin,size:"large"},on:{click:e.toWeworkAuth}},[r("a-avatar",{staticStyle:{margin:"0 10px"},attrs:{shape:"square",size:"small",src:"/static/img/icon/wework.png"}}),e._v("企业微信登录")],1):r("a-popover",{on:{visibleChange:e.generateWeworkQRcode}},[r("a-button",{staticClass:"login-button",attrs:{size:"large",loading:e.state.weworkLogin}},[r("a-avatar",{staticStyle:{margin:"0 10px"},attrs:{shape:"square",size:"small",src:"/static/img/icon/wework.png"}}),e._v("企业微信登录")],1),r("template",{slot:"content"},[r("div",{attrs:{id:"wework-qrcode"}},[e._v("Loading")])])],2)],1)},n=[function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"header"},[o("div",{staticClass:"logo"},[o("img",{staticClass:"logo",attrs:{src:r("9b19"),alt:"logo"}})]),o("p",{staticClass:"title"},[e._v("商城系统登录")])])}],i=r("1da1"),a=r("5530"),s=(r("96cf"),r("d3b7"),r("ac1f"),r("5319"),r("5880")),c=r("ca00"),u=(r("7ded"),{data:function(){return{isLoginError:!1,loginErrorMsg:"登录失败",form:this.$form.createForm(this),state:{loginBtn:!1,weworkLogin:!1},userAgent:window.navigator.userAgent}},created:function(){var e=document.createElement("script");e.type="text/javascript",e.src="http://wwcdn.weixin.qq.com/node/wework/wwopen/js/wwLogin-1.2.7.js",document.body.appendChild(e),this.loginWework()},watch:{"$route.query.code":function(e,t){e&&e!=t&&this.loginWework()}},methods:Object(a["a"])(Object(a["a"])({},Object(s["mapActions"])(["Login","LoginWework"])),{},{handleSubmit:function(e){var t=this;e.preventDefault();var r=this.form.validateFields,o=this.state,n=this.Login;o.loginBtn=!0,r(["username","password"],{force:!0},(function(e,r){if(e)setTimeout((function(){o.loginBtn=!1}),100);else{var i=Object(a["a"])({},r);n(i).then((function(e){return t.loginSuccess(e)})).catch((function(e){return t.loginFailed(e)})).finally((function(){o.loginBtn=!1}))}}))},loginSuccess:function(e){var t=this;this.isLoginError=!1,this.$message.success("登录成功！",1.5),setTimeout((function(){t.$router.push({path:"/"}),t.$notification.success({message:"欢迎",description:"".concat(Object(c["h"])(),"，欢迎回来")})}),1e3)},loginFailed:function(e){this.isLoginError=!0,this.loginErrorMsg=e.msg},toWeworkAuth:function(){this.state.weworkLogin=!0,location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+this.$store.state.WEWORK_CORPID+"&redirect_uri="+encodeURIComponent(location.href)+"&response_type=code&scope=snsapi_base&state=STATE#wechat_redirect"},generateWeworkQRcode:function(){var e=this;this.$nextTick((function(){new WwLogin({id:"wework-qrcode",appid:e.$store.state.WEWORK_CORPID,agentid:e.$store.state.WEWORK_AGENTID,redirect_uri:encodeURIComponent(location.href),state:"",href:"",lang:"zh"})}))},loginWework:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:r=e.$route.query.code,r&&(e.state.weworkLogin=!0,e.LoginWework({code:r}).then((function(t){return e.loginSuccess(t)})).catch((function(t){e.loginFailed(t),delete e.$route.query.code,delete e.$route.query.appid,e.$router.replace({query:Object(a["a"])(Object(a["a"])({},e.$route.query),{},{weworkFail:parseInt(e.$route.query.weworkFail||0)+1})})})).finally((function(){e.state.weworkLogin=!1})));case 2:case"end":return t.stop()}}),t)})))()}})}),l=u,g=(r("34c1"),r("2877")),d=Object(g["a"])(l,o,n,!1,null,"ccd3e520",null);t["default"]=d.exports}}]);
"use strict";(self["webpackChunkvue_antd_pro"]=self["webpackChunkvue_antd_pro"]||[]).push([[690],{89051:function(e,t,r){r.r(t),r.d(t,{default:function(){return h}});var a=function(){var e=this,t=e._self._c;return t("a-card",{attrs:{bordered:!1}},[t("content-header",{attrs:{title:"管理员设置"}}),t("a-spin",{attrs:{spinning:e.isLoading}},[t("a-form",{attrs:{form:e.form}},[t("a-form-item",{attrs:{label:"姓名",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"管理员姓名"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["real_name",{rules:[{required:!0,min:2,message:"请输入至少2个字符"}]}],expression:"['real_name', {rules: [{required: true, min: 2, message: '请输入至少2个字符'}]}]"}]})],1),t("a-form-item",{attrs:{label:"用户名",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"后台登录用户名"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["user_name",{rules:[{required:!0,min:4,message:"请输入至少4个字符"}]}],expression:"['user_name', {rules: [{required: true, min: 4, message: '请输入至少4个字符'}]}]"}]})],1),t("a-form-item",{attrs:{label:"用户密码",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"后台登录密码"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["password",{rules:[{min:6,message:"请输入至少6个字符"}]}],expression:"['password', {rules: [{min: 6, message: '请输入至少6个字符'}]}]"}],attrs:{type:"password"}})],1),t("a-form-item",{attrs:{label:"确认密码",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["password_confirm",{rules:[{message:"请输入确认密码"},{validator:e.compareToFirstPassword}]}],expression:"['password_confirm', {rules: [\n            {message: '请输入确认密码'},\n            {validator: compareToFirstPassword}\n          ]}]"}],attrs:{type:"password"}})],1),t("a-form-item",{attrs:{wrapperCol:{span:13,offset:6}}},[t("a-button",{attrs:{type:"primary",loading:e.isLoading,disabled:e.isLoading},on:{click:e.handleSubmit}},[e._v("提交")])],1)],1)],1)],1)},n=[],i=(r(26099),r(74123)),o=r(12448),s=r(2543),l=r.n(s),u={name:"TableList",components:{ContentHeader:o.dv,STable:o.Wd},data:function(){return{labelCol:{span:6},wrapperCol:{span:13},isLoading:!1,form:this.$form.createForm(this)}},mounted:function(){this.getInfo()},methods:{getInfo:function(){var e=this;this.isLoading=!0,i.Vp().then((function(t){var r=t.data.userInfo;e.form.setFieldsValue(l().pick(r,"user_name","real_name"))})).finally((function(){e.isLoading=!1}))},compareToFirstPassword:function(e,t,r){var a=this.form,n=a.getFieldValue("password");return!n||t===n||new Error("您输入的确认密码不一致")},handleSubmit:function(e){var t=this;e.preventDefault();var r=this.form.validateFields;r((function(e,r){e||(t.isLoading=!0,t.onFormSubmit(r).finally((function(){t.isLoading=!1})))}))},onFormSubmit:function(e){var t=this;return i.qV({form:e}).then((function(e){t.$message.success(e.message),setTimeout((function(){window.location.reload()}),800)}))}}},d=u,c=r(81656),m=(0,c.A)(d,a,n,!1,null,null,null),h=m.exports},28713:function(e,t,r){r.r(t),r.d(t,{default:function(){return q}});var a=function(){var e=this,t=e._self._c;return t("a-card",{attrs:{bordered:!1}},[t("div",{staticClass:"card-title"},[e._v(e._s(e.$route.meta.title))]),t("div",{staticClass:"table-operator"},[t("a-button",{attrs:{type:"primary",icon:"plus"},on:{click:e.handleAdd}},[e._v("新增")])],1),e.isLoading?e._e():t("a-table",{attrs:{rowKey:"id",columns:e.columns,dataSource:e.roleList,defaultExpandAllRows:!0,expandIconColumnIndex:1,pagination:!1,loading:e.isLoading},scopedSlots:e._u([{key:"action",fn:function(r,a){return t("span",{},[[t("a",{directives:[{name:"action",rawName:"v-action:update",arg:"update"}],staticStyle:{"margin-right":"8px"},on:{click:function(t){return e.handleEdit(a)}}},[e._v("编辑")]),t("a",{directives:[{name:"action",rawName:"v-action:delete",arg:"delete"}],on:{click:function(t){return e.handleDelete(a)}}},[e._v("删除")])]],2)}}],null,!1,3241514144)}),t("AddForm",{ref:"AddForm",attrs:{roleList:e.roleList,menuList:e.menuList},on:{handleSubmit:e.handleRefresh}}),t("EditForm",{ref:"EditForm",attrs:{roleList:e.roleList,menuList:e.menuList},on:{handleSubmit:e.handleRefresh}})],1)},n=[],i=r(69870),o=r(17654),s=(r(26099),r(37280)),l=r(76471),u={list:"/store.menu/list"};function d(e){return(0,l.p)({url:u.list,method:"get",params:e})}var c=r(12448),m=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"新增角色",width:720,visible:e.visible,confirmLoading:e.confirmLoading,maskClosable:!1},on:{ok:e.handleSubmit,cancel:e.handleCancel}},[t("a-spin",{attrs:{spinning:e.confirmLoading}},[t("a-form",{attrs:{form:e.form}},[t("a-form-item",{attrs:{label:"角色名称",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["role_name",{rules:[{required:!0,min:2,message:"请输入至少2个字符"}]}],expression:"['role_name', {rules: [{required: true, min: 2, message: '请输入至少2个字符'}]}]"}]})],1),t("a-form-item",{attrs:{label:"上级角色",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-tree-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["parent_id"],expression:"['parent_id']"}],attrs:{treeData:e.roleListTree,dropdownStyle:{maxHeight:"400px",overflow:"auto"},allowClear:""}})],1),t("a-form-item",{attrs:{label:"菜单权限",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"设置该角色有权操作的功能"}},[t("a-tree",{ref:"MenuTree",attrs:{checkable:"",checkStrictly:"",treeData:e.menuListTreeData,autoExpandParent:!1},on:{check:e.onCheckedMenu},model:{value:e.checkedKeys,callback:function(t){e.checkedKeys=t},expression:"checkedKeys"}})],1),t("a-form-item",{attrs:{label:"排序",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"数字越小越靠前"}},[t("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["sort",{initialValue:100,rules:[{required:!0,message:"请输入至少1个数字"}]}],expression:"['sort', {initialValue: 100, rules: [{required: true, message: '请输入至少1个数字'}]}]"}],attrs:{min:0}})],1)],1)],1)],1)},h=[],p=r(9133),f=r(57888),v=(r(28706),r(62010),r(23500),r(2543)),g=r.n(v),w={props:{roleList:{type:Array,required:!0},menuList:{type:Array,required:!0}},data:function(){return{title:"",labelCol:{span:7},wrapperCol:{span:13},visible:!1,confirmLoading:!1,form:this.$form.createForm(this),roleListTree:[],menuListTreeData:[],checkedKeys:{checked:[],halfChecked:[]}}},methods:{add:function(){this.visible=!0,this.getRoleList(),this.getMenuList()},getMenuList:function(){var e=this.menuList;this.menuListTreeData=this.formatTreeDataForMenuList(e)},onCheckedMenu:function(e,t){var r=t.checked,a=t.node,n=this.menuListTreeData,i=this.findNode(a.eventKey,n);this.onCheckChilds(r,i),this.onCheckParents(r,i)},findNode:function(e,t){for(var r=0;r<t.length;r++){var a=t[r];if(a.key===e)return a;if(a.children){var n=this.findNode(e,a.children);if(n)return n}}return!1},onCheckParents:function(e,t){var r=this,a=this.menuListTreeData,n=function e(t){var n=[],i=r.findNode(t,a);if(!i)return n;if(n.push(i.key),i.children){var o=e(i.parentKey);o.length&&(n=n.concat(o))}return n},i=n(t.parentKey);e&&i.length&&(this.checkedKeys.checked=g().union(this.checkedKeys.checked,i))},onCheckChilds:function(e,t){var r=t.children?this.getAllMenuKeys(t.children):[];r.length&&(this.checkedKeys.checked=e?g().union(this.checkedKeys.checked,r):g().difference(this.checkedKeys.checked,r))},getAllMenuKeys:function(e){var t=this,r=[];return e.forEach((function(e){if(r.push(e.key),e.children&&e.children.length){var a=t.getAllMenuKeys(e.children);a.length&&(r=r.concat(a))}})),r},getRoleList:function(){var e=this.roleList,t=this.formatTreeForRoleList(e);t.unshift({title:"顶级角色",key:0,value:0}),this.roleListTree=t},formatTreeForRoleList:function(e){var t=this,r=[];return e.forEach((function(e){var a={title:e.role_name,key:e.role_id,value:e.role_id};e.children&&e.children.length&&(a["children"]=t.formatTreeForRoleList(e["children"])),r.push(a)})),r},formatTreeDataForMenuList:function(e){var t=this,r=[];return e.forEach((function(e){var a={title:e.name,key:e.menu_id,parentKey:e.parent_id};e.children&&e.children.length&&(a["children"]=t.formatTreeDataForMenuList(e["children"])),r.push(a)})),r},handleSubmit:function(e){var t=this;e.preventDefault();var r=this.form.validateFields;r((function(e,r){e||t.onFormSubmit((0,f.A)((0,f.A)({},r),{},{menus:t.getCheckedKeys()}))}))},getCheckedKeys:function(){var e=this.$refs.MenuTree;return[].concat((0,p.A)(e.getCheckedKeys()),(0,p.A)(e.getHalfCheckedKeys()))},handleCancel:function(){this.visible=!1,this.form.resetFields();var e=this.$refs.MenuTree;e.clearExpandedKeys(),this.checkedKeys.checked=[]},onFormSubmit:function(e){var t=this;this.confirmLoading=!0,s.WQ({form:e}).then((function(r){t.$message.success(r.message,1.5),t.handleCancel(),t.$emit("handleSubmit",e)})).finally((function(e){t.confirmLoading=!1}))}}},b=w,C=r(81656),L=(0,C.A)(b,m,h,!1,null,null,null),k=L.exports,y=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"编辑角色",width:720,visible:e.visible,confirmLoading:e.confirmLoading,maskClosable:!1},on:{ok:e.handleSubmit,cancel:e.handleCancel}},[t("a-spin",{attrs:{spinning:e.confirmLoading}},[t("a-form",{attrs:{form:e.form}},[t("a-form-item",{attrs:{label:"角色名称",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["role_name",{rules:[{required:!0,min:2,message:"请输入至少2个字符"}]}],expression:"['role_name', {rules: [{required: true, min: 2, message: '请输入至少2个字符'}]}]"}]})],1),t("a-form-item",{attrs:{label:"上级角色",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-tree-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["parent_id"],expression:"['parent_id']"}],attrs:{treeData:e.roleListTree,dropdownStyle:{maxHeight:"400px",overflow:"auto"},allowClear:""}})],1),t("a-form-item",{attrs:{label:"菜单权限",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"设置该角色有权操作的功能"}},[t("a-tree",{ref:"MenuTree",attrs:{checkable:"",checkStrictly:"",treeData:e.menuListTreeData,autoExpandParent:!1},on:{check:e.onCheckedMenu},model:{value:e.checkedKeys,callback:function(t){e.checkedKeys=t},expression:"checkedKeys"}})],1),t("a-form-item",{attrs:{label:"排序",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"数字越小越靠前"}},[t("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["sort",{initialValue:100,rules:[{required:!0,message:"请输入至少1个数字"}]}],expression:"['sort', {initialValue: 100, rules: [{required: true, message: '请输入至少1个数字'}]}]"}],attrs:{min:0}})],1)],1)],1)],1)},_=[],x=(r(74423),r(21699),{props:{roleList:{type:Array,required:!0},menuList:{type:Array,required:!0}},data:function(){return{title:"",labelCol:{span:7},wrapperCol:{span:13},visible:!1,confirmLoading:!1,form:this.$form.createForm(this),record:{},roleListTree:[],menuListTreeData:[],checkedKeys:{checked:[],halfChecked:[]}}},methods:{edit:function(e){this.visible=!0,this.record=e,this.getRoleList(),this.getMenuList(),this.setMenuChecked(),this.setFieldsValue()},setFieldsValue:function(){var e=this,t=this.$nextTick,r=this.form.setFieldsValue;t((function(){r(g().pick(e.record,["role_name","parent_id","sort"]))}))},getMenuList:function(){var e=this.menuList;this.menuListTreeData=this.formatTreeDataForMenuList(e)},onCheckedMenu:function(e,t){var r=t.checked,a=t.node,n=this.menuListTreeData,i=this.findNode(a.eventKey,n);this.onCheckChilds(r,i),this.onCheckParents(r,i)},findNode:function(e,t){for(var r=0;r<t.length;r++){var a=t[r];if(a.key===e)return a;if(a.children){var n=this.findNode(e,a.children);if(n)return n}}return!1},onCheckParents:function(e,t){var r=this,a=this.menuListTreeData,n=function e(t){var n=[],i=r.findNode(t,a);if(!i)return n;if(n.push(i.key),i.children){var o=e(i.parentKey);o.length&&(n=n.concat(o))}return n},i=n(t.parentKey);e&&i.length&&(this.checkedKeys.checked=g().union(this.checkedKeys.checked,i))},onCheckChilds:function(e,t){var r=t.children?this.getAllMenuKeys(t.children):[];r.length&&(this.checkedKeys.checked=e?g().union(this.checkedKeys.checked,r):g().difference(this.checkedKeys.checked,r))},getAllMenuKeys:function(e){var t=this,r=[];return e.forEach((function(e){if(r.push(e.key),e.children&&e.children.length){var a=t.getAllMenuKeys(e.children);a.length&&(r=r.concat(a))}})),r},setMenuChecked:function(){var e=this.menuListTreeData,t=this.record,r=this.getAllMenuKeys(e);this.checkedKeys.checked=g().intersection(t.menuIds,r)},getRoleList:function(){var e=this.roleList,t=this.formatTreeForRoleList(e);t.unshift({title:"顶级角色",key:0,value:0}),this.roleListTree=t},formatTreeForRoleList:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=[];return e.forEach((function(e){var n={title:e.role_name,key:e.role_id,value:e.role_id};([e.role_id,e.parent_id].includes(t.record.role_id)||!0===r)&&(n.disabled=!0),e.children&&e.children.length&&(n["children"]=t.formatTreeForRoleList(e["children"],n.disabled)),a.push(n)})),a},formatTreeDataForMenuList:function(e){var t=this,r=[];return e.forEach((function(e){var a={title:e.name,key:e.menu_id,parentKey:e.parent_id};e.children&&e.children.length&&(a["children"]=t.formatTreeDataForMenuList(e["children"])),r.push(a)})),r},handleSubmit:function(e){var t=this;e.preventDefault();var r=this.form.validateFields;r((function(e,r){e||t.onFormSubmit((0,f.A)((0,f.A)({},r),{},{menus:t.getCheckedKeys()}))}))},getCheckedKeys:function(){var e=this.$refs.MenuTree;return[].concat((0,p.A)(e.getCheckedKeys()),(0,p.A)(e.getHalfCheckedKeys()))},handleCancel:function(){this.visible=!1,this.form.resetFields();var e=this.$refs.MenuTree;e.clearExpandedKeys(),this.checkedKeys.checked=[]},onFormSubmit:function(e){var t=this;this.confirmLoading=!0,s.hc({roleId:this.record["role_id"],form:e}).then((function(r){t.$message.success(r.message,1.5),t.handleCancel(),t.$emit("handleSubmit",e)})).finally((function(e){t.confirmLoading=!1}))}}}),A=x,F=(0,C.A)(A,y,_,!1,null,null,null),S=F.exports,T={name:"Index",components:{STable:c.Wd,AddForm:k,EditForm:S},data:function(){return{roleList:[],queryParam:{},isLoading:!0,columns:[{title:"角色ID",dataIndex:"id"},{title:"角色名称",dataIndex:"name"},{title:"添加时间",dataIndex:"created_at"},{title:"操作",dataIndex:"action",width:"180px",scopedSlots:{customRender:"action"}}],menuList:[]}},created:function(){this.getRoleList()},methods:{getRoleList:function(){var e=this;this.isLoading=!0,s.p_().then((function(t){e.roleList=t.data})).finally((function(t){e.isLoading=!1}))},getMenuList:function(){var e=this;return(0,o.A)((0,i.A)().mark((function t(){return(0,i.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.menuList.length){t.next=4;break}return e.isLoading=!0,t.next=4,d().then((function(t){e.menuList=t.data.list})).finally((function(){e.isLoading=!1}));case 4:case"end":return t.stop()}}),t)})))()},handleAdd:function(){var e=this;return(0,o.A)((0,i.A)().mark((function t(){return(0,i.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getMenuList();case 2:e.$refs.AddForm.add();case 3:case"end":return t.stop()}}),t)})))()},handleEdit:function(e){var t=this;return(0,o.A)((0,i.A)().mark((function r(){return(0,i.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.getMenuList();case 2:t.$refs.EditForm.edit(e);case 3:case"end":return r.stop()}}),r)})))()},handleDelete:function(e){var t=this,r=this.$confirm({title:"您确定要删除该记录吗?",content:"删除后不可恢复",onOk:function(){return s.KF({roleId:e["id"]}).then((function(e){t.$message.success(e.message,1.5),t.handleRefresh()})).finally((function(e){r.destroy()}))}})},handleRefresh:function(){this.getRoleList()}}},K=T,D=(0,C.A)(K,a,n,!1,null,null,null),q=D.exports},80684:function(e,t,r){r.r(t),r.d(t,{default:function(){return E}});r(62010),r(27495),r(5746);var a=function(){var e=this,t=e._self._c;return t("a-card",{attrs:{bordered:!1}},[t("div",{staticClass:"card-title"},[e._v(e._s(e.$route.meta.title))]),t("div",{staticClass:"table-operator"},[t("a-row",[t("a-col",{attrs:{span:6}},[t("a-button",{directives:[{name:"action",rawName:"v-action:create",arg:"create"}],attrs:{type:"primary",icon:"plus"},on:{click:e.handleAdd}},[e._v("新增")])],1),t("a-col",{attrs:{span:8,offset:10}},[t("a-input-search",{staticStyle:{"max-width":"300px","min-width":"150px",float:"right"},attrs:{placeholder:"请输入用户名/姓名"},on:{search:e.onSearch},model:{value:e.queryParam.search,callback:function(t){e.$set(e.queryParam,"search",t)},expression:"queryParam.search"}})],1)],1)],1),t("s-table",{ref:"table",attrs:{rowKey:"id",loading:e.isLoading,columns:e.columns,data:e.loadData,pageSize:15},scopedSlots:e._u([{key:"username",fn:function(r,a){return t("div",{},[t("span",{staticStyle:{"margin-right":"6px"}},[e._v(e._s(r))]),a.role&&"超级管理员"==a.role.name?t("a-tag",{attrs:{color:"green"}},[e._v("超级管理员")]):e._e()],1)}},{key:"roles",fn:function(r,a){return t("div",{},[e._l(r,(function(a,n){return[t("a-tag",{key:n,attrs:{color:"超级管理员"==a.name?"green":""}},[e._v(" "+e._s(a.name)+" "),"仓储管理员"==a.name&&e.storeListById[a.store_id]?t("span",[e._v(" ("+e._s(e.storeListById[a.store_id].name)+")")]):e._e(),"区域管理员"==a.name&&e.areaListById[a.area_id]?t("span",[e._v(" ("+e._s(e.areaListById[a.area_id].name)+")")]):e._e()]),"仓储管理员"==a.name&&n<r.length-1&&"仓储管理员"==r[n+1].name?t("br",{key:"br-"+n}):e._e()]})),a.managed_agents_count>0?t("div",{staticStyle:{"margin-top":"4px","font-size":"12px",color:"#666"}},[e._v(" 管理 "+e._s(a.managed_agents_count)+" 个分销员 ")]):e._e()],2)}},{key:"action",fn:function(r,a){return t("div",{staticClass:"actions"},[t("a",{directives:[{name:"action",rawName:"v-action:update",arg:"update"}],on:{click:function(t){return e.handleEdit(a)}}},[e._v("编辑")]),a.role&&"超级管理员"==a.role.name?e._e():[t("a",{directives:[{name:"action",rawName:"v-action:update",arg:"update"}],on:{click:function(t){return e.handleAssign(a)}}},[e._v("分配角色")]),t("a",{directives:[{name:"action",rawName:"v-action:delete",arg:"delete"}],on:{click:function(t){return e.handleDelete(a)}}},[e._v("删除")])]],2)}}])}),t("AddForm",{ref:"AddForm",on:{handleSubmit:e.handleRefresh}}),t("EditForm",{ref:"EditForm",on:{handleSubmit:e.handleRefresh}}),t("AssignForm",{ref:"AssignForm",attrs:{roleList:e.roleList,storeList:e.storeList,areaList:e.areaList},on:{handleSubmit:e.handleRefresh}})],1)},n=[],i=r(69870),o=r(17654),s=r(57888),l=(r(26099),r(74123)),u=r(37280),d=r(12448),c=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:e.title,width:720,visible:e.visible,confirmLoading:e.confirmLoading,maskClosable:!1},on:{ok:e.handleSubmit,cancel:e.handleCancel}},[t("a-spin",{attrs:{spinning:e.confirmLoading}},[t("a-form",{attrs:{form:e.form}},[t("a-form-item",{attrs:{label:"管理员姓名",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,min:2,message:"请输入至少2个字符"}]}],expression:"['name', {rules: [{required: true, min: 2, message: '请输入至少2个字符'}]}]"}]})],1),t("a-form-item",{attrs:{label:"用户名",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"后台登录用户名"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["username",{rules:[{required:!0,min:3,message:"请输入至少4个字符"}]}],expression:"['username', {rules: [{required: true, min: 3, message: '请输入至少4个字符'}]}]"}]})],1),t("a-form-item",{attrs:{label:"用户密码",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"后台登录密码"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["password",{rules:[{required:!0,min:6,message:"请输入至少6个字符"}]}],expression:"['password', {rules: [\n            {required: true, min: 6, message: '请输入至少6个字符'}\n          ]}]"}],attrs:{type:"password"}})],1),t("a-form-item",{attrs:{label:"确认密码",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["password_confirm",{rules:[{required:!0,message:"请输入确认密码"},{validator:e.compareToFirstPassword}]}],expression:"['password_confirm', {rules: [\n            {required: true, message: '请输入确认密码'},\n            {validator: compareToFirstPassword}\n          ]}]"}],attrs:{type:"password"}})],1),t("a-form-item",{attrs:{label:"手机",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["phone",{rules:[{required:!0,message:"请输入手机号"}]}],expression:"['phone', {rules: [{required: true, message: '请输入手机号'}]}]"}]})],1),t("a-form-item",{attrs:{label:"邮箱",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["email",{initialValue:null}],expression:"['email', {initialValue: null}]"}]})],1)],1)],1)],1)},m=[],h=(r(62062),{data:function(){return{title:"",labelCol:{span:7},wrapperCol:{span:13},visible:!1,confirmLoading:!1,form:this.$form.createForm(this)}},methods:{add:function(){this.title="新增管理员",this.visible=!0},handleSubmit:function(e){var t=this;e.preventDefault();var r=this.form.validateFields;r((function(e,r){r.roles&&(r.roles=r.roles.map((function(e){return e.value}))),!e&&t.onFormSubmit(r)}))},handleCancel:function(){this.visible=!1,this.form.resetFields()},compareToFirstPassword:function(e,t,r){var a=this.form;return!t||t===a.getFieldValue("password")||new Error("您输入的确认密码不一致")},onFormSubmit:function(e){var t=this;this.confirmLoading=!0,l.WQ(e).then((function(r){t.$message.success("添加成功",1.5),t.handleCancel(),t.$emit("handleSubmit",e)})).catch((function(e){return t.$message.success(e.message,1.5)})).finally((function(e){t.confirmLoading=!1}))}}}),p=h,f=r(81656),v=(0,f.A)(p,c,m,!1,null,null,null),g=v.exports,w=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:e.title,width:720,visible:e.visible,confirmLoading:e.confirmLoading,maskClosable:!1},on:{ok:e.handleSubmit,cancel:e.handleCancel}},[t("a-spin",{attrs:{spinning:e.confirmLoading}},[t("a-form",{attrs:{form:e.form}},[t("a-form-item",{attrs:{label:"管理员姓名",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,min:2,message:"请输入至少2个字符"}]}],expression:"['name', {rules: [{required: true, min: 2, message: '请输入至少2个字符'}]}]"}]})],1),t("a-form-item",{attrs:{label:"用户名",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"后台登录用户名"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["username",{rules:[{required:!0,min:3,message:"请输入至少3个字符"}]}],expression:"['username', {rules: [{required: true, min: 3, message: '请输入至少3个字符'}]}]"}]})],1),t("a-form-item",{attrs:{label:"用户密码",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"后台登录密码"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["password",{rules:[{min:6,message:"请输入至少6个字符"}]}],expression:"['password', {rules: [{min: 6, message: '请输入至少6个字符'}]}]"}],attrs:{type:"password"}})],1),t("a-form-item",{attrs:{label:"确认密码",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["password_confirm",{rules:[{message:"请输入确认密码"},{validator:e.compareToFirstPassword}]}],expression:"['password_confirm', {rules: [\n            { message: '请输入确认密码'},\n            {validator: compareToFirstPassword}\n          ]}]"}],attrs:{type:"password"}})],1),t("a-form-item",{attrs:{label:"手机",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["phone"],expression:"['phone']"}]})],1),t("a-form-item",{attrs:{label:"邮箱",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["email"],expression:"['email']"}]})],1)],1)],1)],1)},b=[],C=r(2543),L=r.n(C),k={props:{},data:function(){return{title:"",labelCol:{span:7},wrapperCol:{span:13},visible:!1,confirmLoading:!1,form:this.$form.createForm(this),record:{}}},methods:{edit:function(e){this.title="编辑管理员",this.visible=!0,this.record=e,this.setFieldsValue()},setFieldsValue:function(){var e=this,t=this.form.setFieldsValue;this.$nextTick((function(){var r=L().pick(e.record,["username","name","phone","email"]);t(r)}))},handleSubmit:function(e){var t=this;e.preventDefault();var r=this.form.validateFields;r((function(e,r){r.roles&&(r.roles=r.roles.map((function(e){return e.value}))),!e&&t.onFormSubmit(r)}))},handleCancel:function(){this.visible=!1,this.form.resetFields()},compareToFirstPassword:function(e,t,r){var a=this.form;return!t||t===a.getFieldValue("password")||new Error("您输入的确认密码不一致")},onFormSubmit:function(e){var t=this;this.confirmLoading=!0,l.hc(this.record["id"],e).then((function(r){t.$message.success("编辑成功",1.5),t.handleCancel(),t.$emit("handleSubmit",e)})).finally((function(e){t.confirmLoading=!1}))}}},y=k,_=(0,f.A)(y,w,b,!1,null,null,null),x=_.exports,A=(r(28706),function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:e.title,width:720,visible:e.visible,confirmLoading:e.confirmLoading,maskClosable:!1},on:{ok:e.handleSubmit,cancel:e.handleCancel}},[t("a-spin",{attrs:{spinning:e.confirmLoading}},[t("a-form",{attrs:{form:e.form}},[t("a-form-item",{attrs:{label:"仓储角色",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"后台管理员角色"}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["role",{rules:[{required:!0,message:"请至少选择一个角色"}]}],expression:"['role', {rules: [{required: true, message: '请至少选择一个角色'}]}]"}],attrs:{options:e.roleList.map((function(e){return{label:e.name,value:e.name}})),dropdownStyle:{maxHeight:"500px",overflow:"auto"},allowClear:""}})],1),t("a-form-item",{directives:[{name:"show",rawName:"v-show",value:"仓储管理员"==e.form.getFieldValue("role"),expression:"form.getFieldValue('role') == '仓储管理员'"}],attrs:{label:"选择对应仓储",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"可以选择多个仓储，该管理员将管理所选的所有仓储"}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["store_ids",{rules:[{required:"仓储管理员"==e.form.getFieldValue("role"),message:"请至少选择一个仓储",type:"array"}]}],expression:"['store_ids', {rules: [{required: form.getFieldValue('role') == '仓储管理员', message: '请至少选择一个仓储', type: 'array'}]}]"}],attrs:{mode:"multiple",options:e.storeList.map((function(e){return{label:e.name,value:e.id}})),dropdownStyle:{maxHeight:"500px",overflow:"auto"},placeholder:"请选择一个或多个仓储",allowClear:"",showSearch:"",filterOption:function(e,t){return t.componentOptions.children[0].text.toLowerCase().indexOf(e.toLowerCase())>=0}}})],1),t("a-form-item",{directives:[{name:"show",rawName:"v-show",value:"区域管理员"==e.form.getFieldValue("role"),expression:"form.getFieldValue('role') == '区域管理员'"}],attrs:{label:"选择对应区域",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"后台登录密码"}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["area_id",{rules:[{required:"区域管理员"==e.form.getFieldValue("role"),message:"请至少选择一个对应仓储"}]}],expression:"['area_id', {rules: [{required: form.getFieldValue('role') == '区域管理员', message: '请至少选择一个对应仓储'}]}]"}],attrs:{options:e.areaList.map((function(e){return{label:e.name,value:e.id}})),dropdownStyle:{maxHeight:"500px",overflow:"auto"},allowClear:""}})],1),t("a-form-item",{directives:[{name:"show",rawName:"v-show",value:"分销管理员"==e.form.getFieldValue("role"),expression:"form.getFieldValue('role') == '分销管理员'"}],attrs:{label:"可管理的分销员",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"可以选择多个最上级分销员，该管理员将管理所选的分销员及其团队；不选择则管理全部分销员"}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["agent_ids",{rules:[{type:"array"}]}],expression:"['agent_ids', {rules: [{type: 'array'}]}]"}],attrs:{mode:"multiple",options:e.agentList.map((function(e){return{label:"".concat(e.user_nickname||"未命名"," (ID: ").concat(e.user_id,")"),value:e.user_id}})),dropdownStyle:{maxHeight:"500px",overflow:"auto"},placeholder:"全部",allowClear:"",showSearch:"",loading:e.agentLoading,filterOption:function(e,t){return t.componentOptions.children[0].text.toLowerCase().indexOf(e.toLowerCase())>=0},notFoundContent:e.agentLoading?"正在加载分销员列表...":0===e.agentList.length?"还没有最上级分销员":"未找到匹配的分销员"}})],1)],1)],1)],1)}),F=[],S=(r(2008),r(50113),r(74423),r(38781),r(21699),r(23500),r(35491)),T={props:{roleList:{type:Array,required:!0},storeList:{type:Array,required:!0},areaList:{type:Array,required:!0}},data:function(){var e=this;return{title:"",labelCol:{span:7},wrapperCol:{span:13},visible:!1,confirmLoading:!1,form:this.$form.createForm(this,{onValuesChange:function(t,r){"分销管理员"===r.role&&0===e.agentList.length&&e.loadAgents()}}),roleListTreeData:[],storeListTreeData:[],record:{},agentList:[],agentLoading:!1}},methods:{edit:function(e){var t=this;return(0,o.A)((0,i.A)().mark((function r(){var a;return(0,i.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(t.title="编辑管理员",t.visible=!0,t.record=e,e.role&&"超级管理员"!=e.role["name"]&&t.getRoleList(),null===(a=e.roles)||void 0===a||!a.some((function(e){return"分销管理员"===e.name}))){r.next=9;break}return r.next=7,t.loadAgents();case 7:return r.next=9,t.loadAssignedAgents(e.id);case 9:t.setFieldsValue();case 10:case"end":return r.stop()}}),r)})))()},handleCancel:function(){this.visible=!1,this.form.resetFields(),this.agentList=[]},setFieldsValue:function(){var e=this,t=this.form.setFieldsValue;this.getCheckedRoleKeys;this.$nextTick((function(){var r,a=L().pick(e.record,["username","name","sort"]),n=null===(r=e.record.roles)||void 0===r?void 0:r.find((function(e){return["仓储管理员","区域管理员","分销管理员"].includes(e.name)}));if(n){if(a.role=n.name,"仓储管理员"===n.name){var i,o=null===(i=e.record.roles)||void 0===i?void 0:i.filter((function(e){return"仓储管理员"===e.name})).map((function(e){return e.store_id})).filter((function(e){return null!=e}));o&&o.length>0&&(a.store_ids=o)}"区域管理员"===n.name&&n.area_id&&(a.area_id=n.area_id),"分销管理员"===n.name&&e.record.agent_ids&&(a.agent_ids=e.record.agent_ids)}t(a)}))},getRoleList:function(){this.roleList},getCheckedRoleKeys:function(){var e=this.roleList,t=this.record,r=function e(r){var a=[];return r.forEach((function(r){if(t["roleIds"].includes(r["id"])&&a.push({label:r["name"],value:r["id"]}),r.children&&r.children.length){var n=e(r.children);n.length&&(a=a.concat(n))}})),a};return r(e)},formatTreeData:function(e){var t=this,r=[];return e.forEach((function(e){var a={title:e.name,key:e.id,value:e.id};e.children&&e.children.length&&(a["children"]=t.formatTreeData(e["children"])),r.push(a)})),r},handleSubmit:function(e){var t=this;e.preventDefault();var r=this.form.validateFields;r((function(e,r){r.roles&&(r.roles=r.roles.map((function(e){return e.value}))),!e&&t.onFormSubmit(r)}))},compareToFirstPassword:function(e,t,r){var a=this.form;return!t||t===a.getFieldValue("password")||new Error("您输入的确认密码不一致")},onFormSubmit:function(e){var t=this;return(0,o.A)((0,i.A)().mark((function r(){return(0,i.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t.confirmLoading=!0,r.prev=1,r.next=4,l.kp(t.record["id"],e);case 4:if("分销管理员"!==e.role){r.next=7;break}return r.next=7,(0,S.oQ)(t.record["id"],{agent_ids:e.agent_ids||[]});case 7:t.$message.success("已分配角色",1.5),t.handleCancel(),t.$emit("handleSubmit",e),r.next=15;break;case 12:r.prev=12,r.t0=r["catch"](1),t.$message.error((null===r.t0||void 0===r.t0?void 0:r.t0.msg)||"分配失败");case 15:return r.prev=15,t.confirmLoading=!1,r.finish(15);case 18:case"end":return r.stop()}}),r,null,[[1,12,15,18]])})))()},loadAgents:function(){var e=this;return(0,o.A)((0,i.A)().mark((function t(){var r;return(0,i.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.agentLoading=!0,t.prev=1,t.next=4,(0,S.pQ)({top_level_only:1,per_page:999});case 4:r=t.sent,e.agentList=(r.data||[]).map((function(e){return{key:e.user_id.toString(),user_id:e.user_id,user_nickname:e.user_nickname,level:e.level,first_members_count:e.first_members_count||0}})),t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](1),e.$message.error("加载分销员列表失败");case 11:return t.prev=11,e.agentLoading=!1,t.finish(11);case 14:case"end":return t.stop()}}),t,null,[[1,8,11,14]])})))()},loadAssignedAgents:function(e){var t=this;return(0,o.A)((0,i.A)().mark((function r(){var a,n;return(0,i.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,(0,S.Gg)(e,{per_page:999});case 3:a=r.sent,n=(a.data||[]).map((function(e){return e.agent_id})),t.record.agent_ids=n,r.next=11;break;case 8:r.prev=8,r.t0=r["catch"](0),t.record.agent_ids=[];case 11:case"end":return r.stop()}}),r,null,[[0,8]])})))()}}},K=T,D=(0,f.A)(K,A,F,!1,null,null,null),q=D.exports,N=r(3238),R=r(55472),$={name:"Index",components:{STable:d.Wd,AddForm:g,EditForm:x,AssignForm:q},data:function(){var e=this;return{roleList:[],storeList:[],storeListById:[],areaList:[],areaListById:[],queryParam:{},isLoading:!1,columns:[{title:"管理员ID",dataIndex:"id"},{title:"用户名",dataIndex:"username",scopedSlots:{customRender:"username"}},{title:"姓名",dataIndex:"name"},{title:"角色",dataIndex:"roles",scopedSlots:{customRender:"roles"}},{title:"添加时间",dataIndex:"created_at"},{title:"操作",dataIndex:"action",width:"180px",scopedSlots:{customRender:"action"}}],loadData:function(t){return l.p_((0,s.A)((0,s.A)({},t),e.queryParam)).then((function(e){return e}))}}},created:function(){this.getRoleList(),this.getStoreList(),this.getAreaList()},methods:{handleAdd:function(){this.$refs.AddForm.add()},handleEdit:function(e){this.$refs.EditForm.edit(e)},handleAssign:function(e){this.$refs.AssignForm.edit(e)},getRoleList:function(){var e=this;this.isLoading=!0,u.p_().then((function(t){e.roleList=t.data})).finally((function(){e.isLoading=!1}))},getStoreList:function(){var e=this;return(0,o.A)((0,i.A)().mark((function t(){return(0,i.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,N.p_();case 2:e.storeList=t.sent.data,e.storeListById=L()(e.storeList).keyBy("id").value();case 4:case"end":return t.stop()}}),t)})))()},getAreaList:function(){var e=this;return(0,o.A)((0,i.A)().mark((function t(){return(0,i.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,R.p_();case 2:e.areaList=t.sent.data,e.areaListById=L()(e.areaList).keyBy("id").value();case 4:case"end":return t.stop()}}),t)})))()},handleDelete:function(e){var t=this,r=this.$confirm({title:"您确定要删除该记录吗?",content:"删除后不可恢复",onOk:function(){return l.KF({userId:e["id"]}).then((function(e){t.$message.success(e.message,1.5),t.handleRefresh()})).finally((function(e){r.destroy()}))}})},handleRefresh:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.$refs.table.refresh(e)},onSearch:function(){this.handleRefresh(!0)}}},M=$,V=(0,f.A)(M,a,n,!1,null,null,null),E=V.exports},55472:function(e,t,r){r.d(t,{WQ:function(){return o},bW:function(){return l},hc:function(){return s},mW:function(){return u},p_:function(){return i}});r(27495),r(25440);var a=r(76471),n={list:"/areas",add:"/areas",edit:"/areas/{id}",getCategories:"/areas/{id}/categories",setCategories:"/areas/{id}/categorize",setDefault:"/areas/{id}/set_default"};function i(e){return(0,a.p)({url:n.list,method:"get",params:e})}function o(e){return(0,a.p)({url:n.add,method:"post",data:e})}function s(e,t){return(0,a.p)({url:n.edit.replace("{id}",e),method:"patch",data:t})}function l(e){return(0,a.p)({url:n.getCategories.replace("{id}",e),method:"get"})}function u(e){return(0,a.p)({url:n.setDefault.replace("{id}",e),method:"post"})}},35491:function(e,t,r){r.d(t,{$X:function(){return m},Gg:function(){return c},Gk:function(){return S},L_:function(){return u},M0:function(){return y},RS:function(){return p},RV:function(){return x},SE:function(){return b},Sm:function(){return F},Sn:function(){return s},Tb:function(){return g},UF:function(){return L},Vm:function(){return v},dE:function(){return A},gF:function(){return k},oQ:function(){return d},pQ:function(){return o},tl:function(){return C},v7:function(){return f},vt:function(){return h},x4:function(){return l},xY:function(){return w},xc:function(){return _}});var a=r(57888),n=(r(27495),r(25440),r(76471)),i={agents:"/agents",agentDetail:"/agents/{id}",agentStats:"/agents/{id}/stats",createAgent:"/agents",updateAgent:"/agents/{id}",managerAgents:"/members/{id}/agents",assignAgents:"/members/{id}/assign_agents",managers:"/members",rebates:"/rebates",rebateApprove:"/rebates/{id}/approve",rebateReject:"/rebates/{id}/reject",withdrawals:"/withdrawals",withdrawalApprove:"/withdrawals/{id}/approve",withdrawalReject:"/withdrawals/{id}/reject",withdrawalMarkPaid:"/withdrawals/{id}/mark_paid",withdrawalConfig:"/settings/withdrawal",withdrawalStats:"/withdrawals/stats",withdrawalExport:"/withdrawals/export",withdrawalBatchApprove:"/withdrawals/batch_approve",withdrawalBatchMarkPaid:"/withdrawals/batch_mark_paid",statsDaily:"/agents/stats/daily",statsRanking:"/agents/stats/ranking",statsOverall:"/agents/stats/overall",statsTeam:"/agents/stats/team",statsDetail:"/agents/stats/detail"};function o(e){return(0,n.p)({url:i.agents,method:"get",params:e})}function s(e){return(0,n.p)({url:i.createAgent,method:"post",data:e})}function l(e,t){return(0,n.p)({url:i.updateAgent.replace("{id}",e),method:"patch",data:t})}function u(e){return(0,n.p)({url:i.managers,method:"get",params:(0,a.A)((0,a.A)({},e),{},{role:"分销管理员"})})}function d(e,t){return(0,n.p)({url:i.assignAgents.replace("{id}",e),method:"post",data:t})}function c(e,t){return(0,n.p)({url:i.managerAgents.replace("{id}",e),method:"get",params:t})}function m(e){return(0,n.p)({url:i.rebates,method:"get",params:e})}function h(e,t){return(0,n.p)({url:i.rebateApprove.replace("{id}",e),method:"patch",data:t})}function p(e,t){return(0,n.p)({url:i.rebateReject.replace("{id}",e),method:"patch",data:t})}function f(e){return(0,n.p)({url:i.withdrawals,method:"get",params:e})}function v(e,t){return(0,n.p)({url:i.withdrawalApprove.replace("{id}",e),method:"patch",data:t})}function g(e,t){return(0,n.p)({url:i.withdrawalReject.replace("{id}",e),method:"patch",data:t})}function w(e,t){return(0,n.p)({url:i.withdrawalMarkPaid.replace("{id}",e),method:"patch",data:t})}function b(e){return(0,n.p)({url:i.statsDaily,method:"get",params:e})}function C(e){return(0,n.p)({url:i.statsRanking,method:"get",params:e})}function L(e){return(0,n.p)({url:i.statsOverall,method:"get",params:e})}function k(e){return(0,n.p)({url:i.statsDetail,method:"get",params:e})}function y(){return(0,n.p)({url:i.withdrawalConfig,method:"get"})}function _(e){return(0,n.p)({url:i.withdrawalConfig,method:"put",data:{values:e}})}function x(e){return(0,n.p)({url:i.withdrawalStats,method:"get",params:e})}function A(e){return(0,n.p)({url:i.withdrawalExport,method:"get",params:e})}function F(e){return(0,n.p)({url:i.withdrawalBatchApprove,method:"post",data:{ids:e}})}function S(e){return(0,n.p)({url:i.withdrawalBatchMarkPaid,method:"post",data:{ids:e}})}},3238:function(e,t,r){r.d(t,{KF:function(){return u},Q7:function(){return o},WQ:function(){return s},hc:function(){return l},p_:function(){return i}});r(27495),r(25440);var a=r(76471),n={list:"/stores",all:"/stores",add:"/stores",edit:"/stores/{id}",delete:"/stores/{id}"};function i(e){return(0,a.p)({url:n.list,method:"get",params:e})}function o(e){return(0,a.p)({url:n.all,method:"get",params:e})}function s(e){return(0,a.p)({url:n.add,method:"post",data:e})}function l(e,t){return(0,a.p)({url:n.edit.replace("{id}",e),method:"patch",data:t})}function u(e){return(0,a.p)({url:n.delete.replace("{id}",e),method:"delete"})}},37280:function(e,t,r){r.d(t,{KF:function(){return l},WQ:function(){return o},hc:function(){return s},p_:function(){return i}});var a=r(76471),n={list:"/roles",add:"/roles",edit:"/roles/{id}",delete:"/roles/{id}"};function i(e){return(0,a.p)({url:n.list,method:"get",params:e})}function o(e){return(0,a.p)({url:n.add,method:"post",data:e})}function s(e){return(0,a.p)({url:n.edit,method:"patch",data:e})}function l(e){return(0,a.p)({url:n.delete,method:"delete",data:e})}}}]);
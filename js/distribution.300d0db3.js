"use strict";(self["webpackChunkvue_antd_pro"]=self["webpackChunkvue_antd_pro"]||[]).push([[113],{90936:function(e,t,a){a.r(t),a.d(t,{default:function(){return f}});var n=function(){var e=this,t=e._self._c;return t("div",[t("a-card",{attrs:{bordered:"false"}},[t("div",{staticClass:"table-search"},[t("a-form",{attrs:{layout:"inline"}},[t("a-form-item",{attrs:{label:"关键词"}},[t("a-input",{staticStyle:{width:"200px"},attrs:{placeholder:"昵称或用户ID",allowClear:""},model:{value:e.query.keyword,callback:function(t){e.$set(e.query,"keyword",t)},expression:"query.keyword"}})],1),t("a-form-item",{attrs:{label:"等级"}},[t("a-select",{staticStyle:{width:"120px"},attrs:{placeholder:"全部",allowClear:""},model:{value:e.query.level,callback:function(t){e.$set(e.query,"level",t)},expression:"query.level"}},[t("a-select-option",{attrs:{value:1}},[e._v("LV1")]),t("a-select-option",{attrs:{value:2}},[e._v("LV2")]),t("a-select-option",{attrs:{value:3}},[e._v("LV3")]),t("a-select-option",{attrs:{value:4}},[e._v("LV4")]),t("a-select-option",{attrs:{value:5}},[e._v("LV5")])],1)],1),t("a-form-item",{attrs:{label:"负责人"}},[t("a-select",{staticStyle:{width:"200px"},attrs:{placeholder:"全部",allowClear:"",showSearch:"",filterOption:!1,loading:e.managerLoading},on:{search:e.handleManagerSearch},model:{value:e.query.manager_id,callback:function(t){e.$set(e.query,"manager_id",t)},expression:"query.manager_id"}},e._l(e.managerOptions,(function(a){return t("a-select-option",{key:a.id,attrs:{value:a.id}},[e._v(" "+e._s(a.name||a.username||"#"+a.id)+" ")])})),1)],1),t("a-form-item",[t("a-button",{attrs:{type:"primary",icon:"search"},on:{click:function(t){return e.loadData(!0)}}},[e._v("查询")]),t("a-button",{staticStyle:{"margin-left":"8px"},attrs:{icon:"reload"},on:{click:e.reset}},[e._v("重置")])],1)],1),t("div",{staticStyle:{"margin-top":"16px"}},[t("a-button",{attrs:{type:"primary",icon:"user-add"},on:{click:e.openPromoteModal}},[e._v(" 从用户提升为分销员 ")])],1)],1),t("a-table",{attrs:{columns:e.columns,dataSource:e.list,loading:e.loading,pagination:e.pagination,rowKey:"user_id"},on:{change:e.handleTableChange},scopedSlots:e._u([{key:"commission",fn:function(a,n){return t("span",{},[e._v(" ￥"+e._s(e.toAmount(n.share_member_commission_amount+n.first_member_commission_amount+n.second_member_commission_amount+n.third_member_commission_amount))+" ")])}},{key:"teamMembers",fn:function(a,n){return t("span",{},[e._v(" "+e._s((n.first_members_count||0)+(n.second_members_count||0)+(n.third_members_count||0))+" ")])}},{key:"managers",fn:function(a,n){return t("span",{},[n.managerScopes&&n.managerScopes.length?[e._v(" "+e._s(n.managerScopes.map((function(e){var t,a;return(null===(t=e.manager)||void 0===t?void 0:t.name)||(null===(a=e.manager)||void 0===a?void 0:a.username)||"#"+e.member_id})).join("、"))+" ")]:[e._v("-")]],2)}},{key:"levelSelect",fn:function(a,n){return t("span",{},[t("a-select",{staticStyle:{width:"100px"},attrs:{size:"small",value:n.level||1},on:{change:function(t){return e.handleLevelChange(n,t)}}},e._l([1,2,3,4,5],(function(a){return t("a-select-option",{key:a,attrs:{value:a}},[e._v("LV"+e._s(a))])})),1)],1)}},{key:"actions",fn:function(a,n){return t("span",{},[t("a",{on:{click:function(t){return e.openDetail(n)}}},[e._v("查看数据")])])}}])})],1),t("a-drawer",{attrs:{visible:e.detailVisible,width:720,title:e.detailTitle,destroyOnClose:""},on:{close:e.closeDetail}},[e.currentAgent?[t("div",{staticClass:"detail-toolbar"},[t("span",[e._v("统计范围：")]),t("a-select",{staticStyle:{width:"120px"},on:{change:e.handleDetailRangeChange},model:{value:e.detailRange,callback:function(t){e.detailRange=t},expression:"detailRange"}},[t("a-select-option",{attrs:{value:"7d"}},[e._v("近7天")]),t("a-select-option",{attrs:{value:"30d"}},[e._v("近30天")]),t("a-select-option",{attrs:{value:"90d"}},[e._v("近90天")])],1)],1),t("a-spin",{attrs:{spinning:e.detailLoading}},[e.detailSummary?t("div",{staticClass:"summary-grid"},[t("div",{staticClass:"summary-card"},[t("div",{staticClass:"label"},[e._v("收入合计")]),t("div",{staticClass:"value"},[e._v("￥"+e._s(e.toAmount(e.detailSummary.income)))])]),t("div",{staticClass:"summary-card"},[t("div",{staticClass:"label"},[e._v("已入账")]),t("div",{staticClass:"value"},[e._v("￥"+e._s(e.toAmount(e.detailSummary.accounted)))])]),t("div",{staticClass:"summary-card"},[t("div",{staticClass:"label"},[e._v("团队流水")]),t("div",{staticClass:"value"},[e._v("￥"+e._s(e.toAmount(e.detailSummary.turnover)))])]),t("div",{staticClass:"summary-card"},[t("div",{staticClass:"label"},[e._v("订单数")]),t("div",{staticClass:"value"},[e._v(e._s(e.detailSummary.order_count||0))])]),t("div",{staticClass:"summary-card"},[t("div",{staticClass:"label"},[e._v("分享次数")]),t("div",{staticClass:"value"},[e._v(e._s(e.detailSummary.share_count||0))])]),t("div",{staticClass:"summary-card"},[t("div",{staticClass:"label"},[e._v("团队人数")]),t("div",{staticClass:"value"},[e._v(e._s(e.detailSummary.member_total||0))])])]):e._e(),e.detailSeries.length?t("a-table",{staticStyle:{"margin-top":"16px"},attrs:{columns:e.detailColumns,dataSource:e.detailSeries,pagination:!1,size:"small",rowKey:"date"}}):t("a-empty",{attrs:{description:"暂无数据"}})],1)]:e._e()],2),t("a-modal",{attrs:{title:"提升用户为分销员",visible:e.promoteVisible,confirmLoading:e.promoteLoading,maskClosable:!1,width:"600px"},on:{ok:e.handlePromote,cancel:e.closePromoteModal}},[t("a-form",{attrs:{layout:"vertical"}},[t("a-form-item",{attrs:{label:"选择用户",required:""}},[t("a-select",{staticStyle:{width:"100%"},attrs:{showSearch:"",placeholder:"搜索用户昵称/ID/手机号",filterOption:!1,loading:e.userSearchLoading,notFoundContent:e.userSearchLoading?void 0:"输入关键词搜索用户"},on:{search:e.handleUserSearch},model:{value:e.promoteForm.user_id,callback:function(t){e.$set(e.promoteForm,"user_id",t)},expression:"promoteForm.user_id"}},e._l(e.userOptions,(function(a){return t("a-select-option",{key:a.id,attrs:{value:a.id}},[t("div",{staticStyle:{display:"flex","align-items":"center"}},[t("a-avatar",{staticStyle:{"margin-right":"8px"},attrs:{src:a.avatar_url,size:"small"}},[e._v(" "+e._s(a.nickname?a.nickname.charAt(0):"U")+" ")]),t("span",[e._v(e._s(a.nickname||"未设置昵称")+" (ID: "+e._s(a.id)+")")])],1)])})),1)],1),t("a-form-item",{attrs:{label:"推荐人（可选）"}},[t("a-select",{staticStyle:{width:"100%"},attrs:{showSearch:"",allowClear:"",placeholder:"可选，搜索已有分销员作为推荐人",filterOption:!1,loading:e.referrerSearchLoading},on:{search:e.handleReferrerSearch},model:{value:e.promoteForm.referrer_id,callback:function(t){e.$set(e.promoteForm,"referrer_id",t)},expression:"promoteForm.referrer_id"}},e._l(e.referrerOptions,(function(a){return t("a-select-option",{key:a.user_id,attrs:{value:a.user_id}},[e._v(" "+e._s(a.user_nickname)+" (ID: "+e._s(a.user_id)+") - LV"+e._s(a.level)+" ")])})),1),t("div",{staticStyle:{"margin-top":"8px",color:"#999","font-size":"12px"}},[e._v(" 如果不选择推荐人，该用户将成为顶级分销员 ")])],1),e.selectedUser?t("a-alert",{staticStyle:{"margin-top":"16px"},attrs:{type:"info",showIcon:""}},[t("template",{slot:"message"},[t("div",[t("strong",[e._v("即将提升用户：")]),t("div",{staticStyle:{"margin-top":"8px"}},[e._v(" "+e._s(e.selectedUser.nickname||"未设置昵称")+" (ID: "+e._s(e.selectedUser.id)+") ")]),e.selectedUser.phone?t("div",{staticStyle:{"margin-top":"4px"}},[e._v(" 手机："+e._s(e.selectedUser.phone)+" ")]):e._e()])])],2):e._e()],1)],1)],1)},r=[],i=a(69870),s=a(57888),o=a(17654),c=a(9133),u=a(95093),l=a.n(u),d=a(26222),m=a(35491),p={data:function(){var e=this;return{loading:!1,list:[],query:{page:1,per_page:10,keyword:void 0,level:void 0,manager_id:void 0},pagination:{current:1,pageSize:10,total:0,showTotal:function(e){return"共 ".concat(e," 条")}},columns:[{title:"用户ID",dataIndex:"user_id"},{title:"昵称",dataIndex:"user_nickname"},{title:"等级",dataIndex:"level",scopedSlots:{customRender:"levelSelect"}},{title:"直属成员",dataIndex:"first_members_count"},{title:"团队成员",scopedSlots:{customRender:"teamMembers"}},{title:"负责人",scopedSlots:{customRender:"managers"}},{title:"累计佣金",scopedSlots:{customRender:"commission"}},{title:"创建时间",dataIndex:"created_at",customRender:function(t){return e.formatDate(t)}},{title:"操作",scopedSlots:{customRender:"actions"},width:120}],detailColumns:[{title:"日期",dataIndex:"date"},{title:"收入",dataIndex:"income",customRender:function(e){return"￥".concat(Number(e||0).toFixed(2))}},{title:"已入账",dataIndex:"accounted",customRender:function(e){return"￥".concat(Number(e||0).toFixed(2))}},{title:"流水",dataIndex:"turnover",customRender:function(e){return"￥".concat(Number(e||0).toFixed(2))}},{title:"订单数",dataIndex:"order_count"},{title:"分享数",dataIndex:"share_count"},{title:"团队人数",dataIndex:"member_total"}],managerOptions:[],managerCache:{},managerLoading:!1,managerSearchKeyword:"",detailVisible:!1,detailLoading:!1,detailSummary:null,detailSeries:[],detailRange:"30d",currentAgent:null,promoteVisible:!1,promoteLoading:!1,promoteForm:{user_id:void 0,referrer_id:void 0},userOptions:[],referrerOptions:[],userSearchLoading:!1,referrerSearchLoading:!1}},computed:{detailTitle:function(){if(!this.currentAgent)return"分销员数据";var e=this.currentAgent.user_nickname||"";return e?"分销员 #".concat(this.currentAgent.user_id,"（").concat(e,"）"):"分销员 #".concat(this.currentAgent.user_id)},selectedUser:function(){var e=this;return this.userOptions.find((function(t){return t.id===e.promoteForm.user_id}))}},mounted:function(){this.loadData(!0),this.loadManagers()},methods:{normalizeManagerInfo:function(e){if(!e||void 0===e.id||null===e.id)return null;var t=Number(e.id);return!Number.isFinite(t)||t<=0?null:{id:t,name:e.name,username:e.username}},cacheManagerOption:function(e){var t=this.normalizeManagerInfo(e);return t?(this.managerCache[t.id]=t,t):null},ensureSelectedManagerOption:function(){var e=this.query.manager_id;if(void 0!==e&&null!==e){var t=Number(e);if(Number.isFinite(t)){this.query.manager_id!==t&&(this.query.manager_id=t);var a=this.managerOptions.find((function(e){return e.id===t}));if(!a){var n=this.managerCache[t];n&&(this.managerOptions=[n].concat((0,c.A)(this.managerOptions)))}}else this.query.manager_id=void 0}},loadData:function(){var e=arguments,t=this;return(0,o.A)((0,i.A)().mark((function a(){var n,r,o,c,u;return(0,i.A)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=e.length>0&&void 0!==e[0]&&e[0],n&&(t.query.page=1,t.pagination.current=1),t.loading=!0,a.prev=3,r=(0,s.A)({},t.query),void 0!==r.manager_id&&null!==r.manager_id&&(o=Number(r.manager_id),Number.isFinite(o)?(r.manager_id=o,t.query.manager_id=o):(delete r.manager_id,t.query.manager_id=void 0)),a.next=8,(0,m.pQ)(r);case 8:c=a.sent,u=(c.data||[]).map((function(e){return(0,s.A)((0,s.A)({},e),{},{managerScopes:e.managerScopes||[]})})),t.list=u,t.pagination=(0,s.A)((0,s.A)({},t.pagination),{},{current:c.current_page||1,pageSize:c.per_page||t.query.per_page,total:c.total||0}),t.syncManagerOptionsFromList(),a.next=18;break;case 15:a.prev=15,a.t0=a["catch"](3),t.$message.error((null===a.t0||void 0===a.t0?void 0:a.t0.msg)||"加载失败");case 18:return a.prev=18,t.loading=!1,a.finish(18);case 21:case"end":return a.stop()}}),a,null,[[3,15,18,21]])})))()},loadManagers:function(e){var t=this;return(0,o.A)((0,i.A)().mark((function a(){var n,r,s;return(0,i.A)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.managerLoading=!0,t.managerSearchKeyword=e||"",a.prev=2,a.next=5,(0,m.L_)({per_page:50,page:1,keyword:e});case 5:n=a.sent,r=[],s=n.data||[],s.forEach((function(e){var a=t.cacheManagerOption(e);a&&r.push(a)})),t.managerOptions=r,t.ensureSelectedManagerOption(),a.next=16;break;case 13:a.prev=13,a.t0=a["catch"](2),t.$message.error((null===a.t0||void 0===a.t0?void 0:a.t0.msg)||"负责人加载失败");case 16:return a.prev=16,t.managerLoading=!1,a.finish(16);case 19:case"end":return a.stop()}}),a,null,[[2,13,16,19]])})))()},syncManagerOptionsFromList:function(){var e=this;this.list.forEach((function(t){(t.managerScopes||[]).forEach((function(t){var a,n,r=e.cacheManagerOption({id:t.member_id,name:null===(a=t.manager)||void 0===a?void 0:a.name,username:null===(n=t.manager)||void 0===n?void 0:n.username});if(r&&!e.managerSearchKeyword){var i=e.managerOptions.find((function(e){return e.id===r.id}));i||(e.managerOptions=[].concat((0,c.A)(e.managerOptions),[r]))}}))})),this.ensureSelectedManagerOption()},handleManagerSearch:function(e){this.loadManagers(e)},handleTableChange:function(e){this.query.page=e.current,this.query.per_page=e.pageSize,this.loadData()},reset:function(){this.query.keyword=void 0,this.query.level=void 0,this.query.manager_id=void 0,this.loadData(!0)},handleLevelChange:function(e,t){var a=this;return(0,o.A)((0,i.A)().mark((function n(){var r;return(0,i.A)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=Number(t),r&&r!==e.level){n.next=3;break}return n.abrupt("return");case 3:return n.prev=3,n.next=6,(0,m.x4)(e.user_id,{level:r});case 6:a.$message.success("等级已更新"),e.level=r,n.next=13;break;case 10:n.prev=10,n.t0=n["catch"](3),a.$message.error((null===n.t0||void 0===n.t0?void 0:n.t0.msg)||"更新失败");case 13:case"end":return n.stop()}}),n,null,[[3,10]])})))()},formatDate:function(e){return e?l()(e).format("YYYY-MM-DD HH:mm"):"-"},toAmount:function(e){return Number(e||0).toFixed(2)},openDetail:function(e){this.currentAgent=e,this.detailVisible=!0,this.detailRange="30d",this.loadAgentDetail()},loadAgentDetail:function(){var e=this;return(0,o.A)((0,i.A)().mark((function t(){var a;return(0,i.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.currentAgent){t.next=2;break}return t.abrupt("return");case 2:return e.detailLoading=!0,t.prev=3,t.next=6,(0,m.gF)({agent_id:e.currentAgent.user_id,range:e.detailRange});case 6:a=t.sent,e.detailSummary=null!==a&&void 0!==a&&a.summary?(0,s.A)({},a.summary):null,e.detailSeries=((null===a||void 0===a?void 0:a.series)||[]).map((function(e){return{date:e.date,income:Number(e.income||0),accounted:Number(e.accounted||0),turnover:Number(e.turnover||0),order_count:Number(e.order_count||0),share_count:Number(e.share_count||0),member_total:Number(e.member_total||0)}})),t.next=16;break;case 11:t.prev=11,t.t0=t["catch"](3),e.$message.error((null===t.t0||void 0===t.t0?void 0:t.t0.msg)||"统计数据获取失败"),e.detailSummary=null,e.detailSeries=[];case 16:return t.prev=16,e.detailLoading=!1,t.finish(16);case 19:case"end":return t.stop()}}),t,null,[[3,11,16,19]])})))()},handleDetailRangeChange:function(e){this.detailRange=e,this.loadAgentDetail()},closeDetail:function(){this.detailVisible=!1,this.detailLoading=!1,this.currentAgent=null,this.detailSummary=null,this.detailSeries=[],this.detailRange="30d"},openPromoteModal:function(){this.promoteVisible=!0,this.promoteForm={user_id:void 0,referrer_id:void 0},this.userOptions=[],this.referrerOptions=[]},closePromoteModal:function(){this.promoteVisible=!1,this.promoteForm={user_id:void 0,referrer_id:void 0},this.userOptions=[],this.referrerOptions=[]},handleUserSearch:function(e){var t=this;return(0,o.A)((0,i.A)().mark((function a(){var n;return(0,i.A)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(e&&!(e.trim().length<2)){a.next=3;break}return t.userOptions=[],a.abrupt("return");case 3:return t.userSearchLoading=!0,a.prev=4,a.next=7,d.p.get("/admin/users",{params:{keyword:e.trim(),per_page:20}});case 7:n=a.sent,t.userOptions=n.data||[],a.next=15;break;case 11:a.prev=11,a.t0=a["catch"](4),t.$message.error("搜索用户失败: "+((null===a.t0||void 0===a.t0?void 0:a.t0.msg)||"")),t.userOptions=[];case 15:return a.prev=15,t.userSearchLoading=!1,a.finish(15);case 18:case"end":return a.stop()}}),a,null,[[4,11,15,18]])})))()},handleReferrerSearch:function(e){var t=this;return(0,o.A)((0,i.A)().mark((function a(){var n;return(0,i.A)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.referrerSearchLoading=!0,a.prev=1,a.next=4,(0,m.pQ)({keyword:e||void 0,per_page:50});case 4:n=a.sent,t.referrerOptions=n.data||[],a.next=12;break;case 8:a.prev=8,a.t0=a["catch"](1),t.$message.error("搜索推荐人失败"),t.referrerOptions=[];case 12:return a.prev=12,t.referrerSearchLoading=!1,a.finish(12);case 15:case"end":return a.stop()}}),a,null,[[1,8,12,15]])})))()},handlePromote:function(){var e=this;return(0,o.A)((0,i.A)().mark((function t(){var a;return(0,i.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.promoteForm.user_id){t.next=3;break}return e.$message.warning("请选择要提升的用户"),t.abrupt("return");case 3:return e.promoteLoading=!0,t.prev=4,a={user_id:e.promoteForm.user_id},e.promoteForm.referrer_id&&(a.referrer_id=e.promoteForm.referrer_id),t.next=9,(0,m.Sn)(a);case 9:e.$message.success("提升成功！该用户已成为分销员"),e.closePromoteModal(),e.loadData(!0),t.next=17;break;case 14:t.prev=14,t.t0=t["catch"](4),e.$message.error((null===t.t0||void 0===t.t0?void 0:t.t0.msg)||"提升失败，该用户可能已经是分销员");case 17:return t.prev=17,e.promoteLoading=!1,t.finish(17);case 20:case"end":return t.stop()}}),t,null,[[4,14,17,20]])})))()}}},g=p,v=a(81656),h=(0,v.A)(g,n,r,!1,null,"4a094afc",null),f=h.exports},44949:function(e,t,a){a.r(t),a.d(t,{default:function(){return h}});var n=function(){var e=this,t=e._self._c;return t("div",[t("a-card",{attrs:{bordered:"false"}},[t("div",{staticClass:"table-search"},[t("a-form",{attrs:{layout:"inline"}},[t("a-form-item",{attrs:{label:"关键词"}},[t("a-input",{staticStyle:{width:"220px"},attrs:{placeholder:"姓名或账号",allowClear:""},model:{value:e.query.keyword,callback:function(t){e.$set(e.query,"keyword",t)},expression:"query.keyword"}})],1),t("a-form-item",[t("a-button",{attrs:{type:"primary",icon:"search"},on:{click:function(t){return e.loadData(!0)}}},[e._v("查询")]),t("a-button",{staticStyle:{"margin-left":"8px"},attrs:{icon:"reload"},on:{click:e.reset}},[e._v("重置")])],1)],1)],1),t("a-table",{attrs:{columns:e.columns,dataSource:e.list,loading:e.loading,pagination:e.pagination,rowKey:"id"},on:{change:e.handleTableChange},scopedSlots:e._u([{key:"agents",fn:function(a,n){return t("span",{},[e._v(" "+e._s(n.managed_agent_count||0)+" ")])}},{key:"actions",fn:function(a,n){return t("span",{},[t("a",{on:{click:function(t){return e.openAssignModal(n)}}},[e._v("分配分销员")]),t("a-divider",{attrs:{type:"vertical"}}),t("a",{on:{click:function(t){return e.openDrawer(n)}}},[e._v("查看分销员")])],1)}}])})],1),t("a-modal",{attrs:{visible:e.assignVisible,title:e.modalTitle,confirmLoading:e.assignSubmitting,width:"640",destroyOnClose:""},on:{ok:e.handleAssignSubmit,cancel:e.closeAssignModal}},[t("a-form",{attrs:{layout:"vertical"}},[t("a-form-item",{attrs:{label:"选择分销员"}},[t("a-select",{staticStyle:{width:"100%"},attrs:{mode:"multiple",showSearch:"",filterOption:!1,loading:e.agentsLoading,placeholder:"输入昵称或ID搜索一级分销员"},on:{search:e.handleAgentSearch},model:{value:e.selectedAgentIds,callback:function(t){e.selectedAgentIds=t},expression:"selectedAgentIds"}},e._l(e.agentOptions,(function(a){return t("a-select-option",{key:a.value,attrs:{value:a.value}},[e._v(" "+e._s(a.label)+" ")])})),1)],1)],1),e.selectedAgentDetails.length?t("div",{staticClass:"selected-list"},[t("div",{staticClass:"selected-list__title"},[e._v("已选择 "+e._s(e.selectedAgentDetails.length)+" 位：")]),t("a-table",{attrs:{columns:e.selectedColumns,dataSource:e.selectedAgentDetails,pagination:!1,size:"small",rowKey:"user_id"}})],1):e._e()],1),t("a-drawer",{attrs:{visible:e.drawerVisible,title:e.drawerTitle,width:720,destroyOnClose:""},on:{close:e.closeDrawer}},[t("a-table",{attrs:{columns:e.drawerColumns,dataSource:e.drawerData,loading:e.drawerLoading,pagination:e.drawerPagination,rowKey:"user_id",size:"middle"},on:{change:e.handleDrawerChange}})],1)],1)},r=[],i=a(9133),s=a(69870),o=a(57888),c=a(17654),u=a(95093),l=a.n(u),d=a(35491),m={data:function(){return{loading:!1,list:[],query:{page:1,per_page:10,keyword:void 0},pagination:{current:1,pageSize:10,total:0,showTotal:function(e){return"共 ".concat(e," 条")}},columns:[{title:"ID",dataIndex:"id",width:80},{title:"姓名",dataIndex:"name"},{title:"账号",dataIndex:"username"},{title:"手机号",dataIndex:"phone"},{title:"负责分销员",scopedSlots:{customRender:"agents"},width:120},{title:"操作",scopedSlots:{customRender:"actions"},width:200}],assignVisible:!1,assignSubmitting:!1,currentManager:null,selectedAgentIds:[],selectedColumns:[{title:"用户ID",dataIndex:"user_id",width:100},{title:"昵称",dataIndex:"user_nickname"},{title:"等级",dataIndex:"level",customRender:function(e){return"LV".concat(e||1)}},{title:"加入时间",dataIndex:"created_at",customRender:function(e){return e?l()(e).format("YYYY-MM-DD HH:mm"):"-"}}],agentOptions:[],agentCache:{},agentsLoading:!1,agentSearchKeyword:"",assignedAgents:[],drawerVisible:!1,drawerLoading:!1,drawerData:[],drawerPagination:{current:1,pageSize:10,total:0,showTotal:function(e){return"共 ".concat(e," 条")}},drawerColumns:[{title:"用户ID",dataIndex:"user_id",width:100},{title:"昵称",dataIndex:"user_nickname"},{title:"等级",dataIndex:"level",customRender:function(e){return"LV".concat(e||1)}},{title:"直属成员",dataIndex:"first_members_count"},{title:"团队成员",dataIndex:"team_members",customRender:function(e,t){return(t.first_members_count||0)+(t.second_members_count||0)+(t.third_members_count||0)}},{title:"创建时间",dataIndex:"created_at",customRender:function(e){return e?l()(e).format("YYYY-MM-DD HH:mm"):"-"}}]}},computed:{selectedAgentDetails:function(){var e=this;return this.selectedAgentIds.map((function(t){return e.agentCache[t]})).filter((function(e){return!!e}))},modalTitle:function(){if(!this.currentManager)return"分配分销员";var e=this.currentManager.name||this.currentManager.username||"#".concat(this.currentManager.id);return"分配分销员 - ".concat(e)},drawerTitle:function(){if(!this.currentManager)return"分销员列表";var e=this.currentManager.name||this.currentManager.username||"#".concat(this.currentManager.id);return"分销员列表 - ".concat(e)}},mounted:function(){this.loadData(!0)},methods:{loadData:function(){var e=arguments,t=this;return(0,c.A)((0,s.A)().mark((function a(){var n,r;return(0,s.A)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=e.length>0&&void 0!==e[0]&&e[0],n&&(t.query.page=1,t.pagination.current=1),t.loading=!0,a.prev=3,a.next=6,(0,d.L_)((0,o.A)({},t.query));case 6:r=a.sent,t.list=r.data||[],t.pagination=(0,o.A)((0,o.A)({},t.pagination),{},{current:r.current_page||1,pageSize:r.per_page||t.query.per_page,total:r.total||0}),a.next=14;break;case 11:a.prev=11,a.t0=a["catch"](3),t.$message.error((null===a.t0||void 0===a.t0?void 0:a.t0.msg)||"加载失败");case 14:return a.prev=14,t.loading=!1,a.finish(14);case 17:case"end":return a.stop()}}),a,null,[[3,11,14,17]])})))()},reset:function(){this.query.keyword=void 0,this.loadData(!0)},handleTableChange:function(e){this.query.page=e.current,this.query.per_page=e.pageSize,this.loadData()},addAgentsToCache:function(e){var t=this;(e||[]).forEach((function(e){if(e){var a=Number(e.user_id||e.id);!Number.isFinite(a)||a<=0||(t.agentCache[a]=(0,o.A)((0,o.A)((0,o.A)({},t.agentCache[a]),e),{},{user_id:a}))}}))},buildAgentOption:function(e){if(!e)return null;var t=Number(e.user_id);if(!Number.isFinite(t)||t<=0)return null;var a=e.user_nickname?"".concat(e.user_nickname," (#").concat(t,")"):"分销员 #".concat(t);return{value:t,label:a}},ensureSelectedAgentsOption:function(){var e=this,t=new Set(this.agentOptions.map((function(e){return e.value})));this.selectedAgentIds.forEach((function(a){if(!t.has(a)){var n=e.agentCache[a],r=e.buildAgentOption(n);r&&(e.agentOptions=[].concat((0,i.A)(e.agentOptions),[r]),t.add(a))}}))},openAssignModal:function(e){var t=this;return(0,c.A)((0,s.A)().mark((function a(){var n;return(0,s.A)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.currentManager=e,t.assignVisible=!0,t.assignSubmitting=!1,t.agentOptions=[],t.agentSearchKeyword="",n=(e.agent_ids||[]).map((function(e){return Number(e)})).filter((function(e){return Number.isFinite(e)})),t.selectedAgentIds=n,a.next=9,t.loadAssignedAgents(e.id);case 9:return a.next=11,t.loadAgentOptions();case 11:t.ensureSelectedAgentsOption();case 12:case"end":return a.stop()}}),a)})))()},closeAssignModal:function(){this.assignVisible=!1,this.assignSubmitting=!1,this.currentManager=null,this.selectedAgentIds=[],this.agentOptions=[],this.assignedAgents=[]},loadAssignedAgents:function(e){var t=this;return(0,c.A)((0,s.A)().mark((function a(){var n,r,i;return(0,s.A)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.agentsLoading=!0,a.prev=1,a.next=4,(0,d.Gg)(e,{per_page:200,page:1});case 4:n=a.sent,r=(n.data||[]).map((function(e){return e.agent||e})),t.assignedAgents=r,t.addAgentsToCache(r),t.selectedAgentIds.length||(i=r.map((function(e){return Number(e.user_id)})).filter((function(e){return Number.isFinite(e)})),t.selectedAgentIds=i),t.ensureSelectedAgentsOption(),a.next=15;break;case 12:a.prev=12,a.t0=a["catch"](1),t.$message.error((null===a.t0||void 0===a.t0?void 0:a.t0.msg)||"加载当前分销员失败");case 15:return a.prev=15,t.agentsLoading=!1,a.finish(15);case 18:case"end":return a.stop()}}),a,null,[[1,12,15,18]])})))()},loadAgentOptions:function(e){var t=this;return(0,c.A)((0,s.A)().mark((function a(){var n,r;return(0,s.A)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.agentsLoading=!0,t.agentSearchKeyword=e||"",a.prev=2,a.next=5,(0,d.pQ)({per_page:100,page:1,level:1,keyword:e});case 5:n=a.sent,r=n.data||[],t.addAgentsToCache(r),t.agentOptions=r.map((function(e){return t.buildAgentOption(e)})).filter((function(e){return!!e})),t.ensureSelectedAgentsOption(),a.next=15;break;case 12:a.prev=12,a.t0=a["catch"](2),t.$message.error((null===a.t0||void 0===a.t0?void 0:a.t0.msg)||"分销员搜索失败");case 15:return a.prev=15,t.agentsLoading=!1,a.finish(15);case 18:case"end":return a.stop()}}),a,null,[[2,12,15,18]])})))()},handleAgentSearch:function(e){this.loadAgentOptions(e)},handleAssignSubmit:function(){var e=this;return(0,c.A)((0,s.A)().mark((function t(){var a;return(0,s.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.currentManager){t.next=2;break}return t.abrupt("return");case 2:return e.assignSubmitting=!0,t.prev=3,a=e.selectedAgentIds.map((function(e){return Number(e)})).filter((function(e){return Number.isFinite(e)})),t.next=7,(0,d.oQ)(e.currentManager.id,{agent_ids:a});case 7:e.$message.success("分配成功"),e.closeAssignModal(),e.loadData(),t.next=15;break;case 12:t.prev=12,t.t0=t["catch"](3),e.$message.error((null===t.t0||void 0===t.t0?void 0:t.t0.msg)||"分配失败");case 15:return t.prev=15,e.assignSubmitting=!1,t.finish(15);case 18:case"end":return t.stop()}}),t,null,[[3,12,15,18]])})))()},openDrawer:function(e){var t=this;return(0,c.A)((0,s.A)().mark((function a(){return(0,s.A)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.currentManager=e,t.drawerVisible=!0,t.drawerPagination.current=1,a.next=5,t.loadDrawerData(1);case 5:case"end":return a.stop()}}),a)})))()},closeDrawer:function(){this.drawerVisible=!1,this.drawerData=[],this.drawerLoading=!1},loadDrawerData:function(){var e=arguments,t=this;return(0,c.A)((0,s.A)().mark((function a(){var n,r,i;return(0,s.A)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(n=e.length>0&&void 0!==e[0]?e[0]:1,t.currentManager){a.next=3;break}return a.abrupt("return");case 3:return t.drawerLoading=!0,a.prev=4,a.next=7,(0,d.Gg)(t.currentManager.id,{per_page:t.drawerPagination.pageSize,page:n});case 7:r=a.sent,i=(r.data||[]).map((function(e){return e.agent||e})),t.drawerData=i,t.addAgentsToCache(i),t.drawerPagination=(0,o.A)((0,o.A)({},t.drawerPagination),{},{current:r.current_page||n,total:r.total||0}),a.next=17;break;case 14:a.prev=14,a.t0=a["catch"](4),t.$message.error((null===a.t0||void 0===a.t0?void 0:a.t0.msg)||"分销员列表加载失败");case 17:return a.prev=17,t.drawerLoading=!1,a.finish(17);case 20:case"end":return a.stop()}}),a,null,[[4,14,17,20]])})))()},handleDrawerChange:function(e){this.loadDrawerData(e.current)}}},p=m,g=a(81656),v=(0,g.A)(p,n,r,!1,null,"3a4cbfd0",null),h=v.exports},31925:function(e,t,a){a.r(t),a.d(t,{default:function(){return h}});var n=function(){var e=this,t=e._self._c;return t("a-card",{attrs:{bordered:"false"}},[t("div",{staticClass:"table-search"},[t("a-form",{attrs:{layout:"inline"}},[t("a-form-item",{attrs:{label:"状态"}},[t("a-select",{staticStyle:{width:"140px"},attrs:{allowClear:"",placeholder:"全部"},model:{value:e.query.status,callback:function(t){e.$set(e.query,"status",t)},expression:"query.status"}},[t("a-select-option",{attrs:{value:"pending"}},[e._v("待审核")]),t("a-select-option",{attrs:{value:"valid"}},[e._v("有效")]),t("a-select-option",{attrs:{value:"done"}},[e._v("已入账")]),t("a-select-option",{attrs:{value:"canceled"}},[e._v("已取消")])],1)],1),t("a-form-item",[t("a-button",{attrs:{type:"primary",icon:"search"},on:{click:function(t){return e.loadData(!0)}}},[e._v("查询")]),t("a-button",{staticStyle:{"margin-left":"8px"},attrs:{icon:"reload"},on:{click:e.reset}},[e._v("重置")])],1)],1)],1),t("a-table",{attrs:{columns:e.columns,dataSource:e.list,loading:e.loading,pagination:e.pagination,rowKey:"id"},on:{change:e.handleTableChange},scopedSlots:e._u([{key:"type",fn:function(a){return t("span",{},[e._v(" "+e._s(e.typeText(a))+" ")])}},{key:"status",fn:function(a){return t("span",{},[t("a-tag",{attrs:{color:e.statusColor(a)}},[e._v(e._s(e.statusText(a)))])],1)}},{key:"commission",fn:function(a){return t("span",{},[e._v(" ￥"+e._s(Number(a||0).toFixed(2))+" ")])}},{key:"actions",fn:function(a,n){return t("span",{},["pending"===n.status?t("a-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.handleApprove(n)}}},[e._v("通过")]):e._e(),"pending"===n.status?t("a-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"danger",size:"small"},on:{click:function(t){return e.handleReject(n)}}},[e._v("拒绝")]):t("span",[e._v("-")])],1)}}])})],1)},r=[],i=(a(96305),a(43898)),s=a(69870),o=a(57888),c=a(17654),u=a(95093),l=a.n(u),d=a(35491),m={data:function(){var e=this;return{loading:!1,list:[],query:{page:1,per_page:10,status:void 0},pagination:{current:1,pageSize:10,total:0,showTotal:function(e){return"共 ".concat(e," 条")}},columns:[{title:"ID",dataIndex:"id"},{title:"分销员",dataIndex:"user_nickname"},{title:"等级",dataIndex:"user_level",customRender:function(e){return e?"LV".concat(e):"-"}},{title:"佣金金额",dataIndex:"commission",scopedSlots:{customRender:"commission"}},{title:"类型",dataIndex:"type",scopedSlots:{customRender:"type"}},{title:"状态",dataIndex:"status",scopedSlots:{customRender:"status"}},{title:"创建时间",dataIndex:"created_at",customRender:function(t){return e.formatDate(t)}},{title:"入账时间",dataIndex:"accounted_at",customRender:function(t){return e.formatDate(t)}},{title:"操作",scopedSlots:{customRender:"actions"}}]}},mounted:function(){this.loadData(!0)},methods:{loadData:function(){var e=arguments,t=this;return(0,c.A)((0,s.A)().mark((function a(){var n,r;return(0,s.A)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=e.length>0&&void 0!==e[0]&&e[0],n&&(t.query.page=1,t.pagination.current=1),t.loading=!0,a.prev=3,a.next=6,(0,d.$X)((0,o.A)({},t.query));case 6:r=a.sent,t.list=r.data||[],t.pagination=(0,o.A)((0,o.A)({},t.pagination),{},{current:r.current_page||1,pageSize:r.per_page||t.query.per_page,total:r.total||0}),a.next=14;break;case 11:a.prev=11,a.t0=a["catch"](3),t.$message.error((null===a.t0||void 0===a.t0?void 0:a.t0.msg)||"加载失败");case 14:return a.prev=14,t.loading=!1,a.finish(14);case 17:case"end":return a.stop()}}),a,null,[[3,11,14,17]])})))()},handleTableChange:function(e){this.query.page=e.current,this.query.per_page=e.pageSize,this.loadData()},reset:function(){this.query.status=void 0,this.loadData(!0)},typeText:function(e){return"share_buy"===e?"分享下单":"团队订单"},statusText:function(e){switch(e){case"pending":return"待审核";case"paid":return"已支付";case"received":return"已收货";case"done":return"已入账";case"canceled":return"已取消";default:return e}},statusColor:function(e){switch(e){case"pending":return"orange";case"done":return"green";case"canceled":return"red";default:return"blue"}},formatDate:function(e){return e?l()(e).format("YYYY-MM-DD HH:mm"):"-"},handleApprove:function(e){var t=this;return(0,c.A)((0,s.A)().mark((function a(){return(0,s.A)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,(0,d.vt)(e.id);case 3:t.$message.success("审核通过"),t.loadData(),a.next=10;break;case 7:a.prev=7,a.t0=a["catch"](0),t.$message.error((null===a.t0||void 0===a.t0?void 0:a.t0.msg)||"操作失败");case 10:case"end":return a.stop()}}),a,null,[[0,7]])})))()},handleReject:function(e){var t=this;return(0,c.A)((0,s.A)().mark((function a(){return(0,s.A)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:i.A.confirm({title:"确认操作",content:"确定要拒绝该笔佣金吗？",onOk:function(){var a=(0,c.A)((0,s.A)().mark((function a(){return(0,s.A)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,(0,d.RS)(e.id);case 3:t.$message.success("已拒绝"),t.loadData(),a.next=10;break;case 7:a.prev=7,a.t0=a["catch"](0),t.$message.error((null===a.t0||void 0===a.t0?void 0:a.t0.msg)||"操作失败");case 10:case"end":return a.stop()}}),a,null,[[0,7]])})));function n(){return a.apply(this,arguments)}return n}()});case 1:case"end":return a.stop()}}),a)})))()}}},p=m,g=a(81656),v=(0,g.A)(p,n,r,!1,null,"0a2a16e1",null),h=v.exports},22013:function(e,t,a){a.r(t),a.d(t,{default:function(){return h}});var n=function(){var e=this,t=e._self._c;return t("div",[t("a-card",{attrs:{bordered:"false"}},[t("div",{staticClass:"filter-bar"},[t("a-form",{attrs:{layout:"inline"}},[t("a-form-item",{attrs:{label:"日期范围"}},[t("a-range-picker",{staticStyle:{width:"260px"},attrs:{allowClear:""},on:{change:e.handleDateChange},model:{value:e.query.dateRange,callback:function(t){e.$set(e.query,"dateRange",t)},expression:"query.dateRange"}})],1),t("a-form-item",[t("a-radio-group",{on:{change:e.handlePresetChange},model:{value:e.query.rangePreset,callback:function(t){e.$set(e.query,"rangePreset",t)},expression:"query.rangePreset"}},[t("a-radio-button",{attrs:{value:"7d"}},[e._v("近7天")]),t("a-radio-button",{attrs:{value:"30d"}},[e._v("近30天")]),t("a-radio-button",{attrs:{value:"90d"}},[e._v("近90天")])],1)],1),t("a-form-item",{attrs:{label:"排名指标"}},[t("a-select",{staticStyle:{width:"140px"},on:{change:e.loadRanking},model:{value:e.query.metric,callback:function(t){e.$set(e.query,"metric",t)},expression:"query.metric"}},[t("a-select-option",{attrs:{value:"income"}},[e._v("预计收入")]),t("a-select-option",{attrs:{value:"turnover"}},[e._v("成交流水")]),t("a-select-option",{attrs:{value:"order_count"}},[e._v("订单数")])],1)],1),t("a-form-item",{attrs:{label:"分销员ID"}},[t("a-input",{staticStyle:{width:"160px"},attrs:{placeholder:"精确匹配",allowClear:""},model:{value:e.query.agentId,callback:function(t){e.$set(e.query,"agentId",t)},expression:"query.agentId"}})],1),t("a-form-item",[t("a-button",{attrs:{type:"primary",icon:"search"},on:{click:e.handleSearch}},[e._v("查询")]),t("a-button",{staticStyle:{"margin-left":"8px"},attrs:{icon:"reload"},on:{click:e.reset}},[e._v("重置")])],1)],1)],1),t("div",{staticClass:"overview-grid"},[t("div",{staticClass:"overview-card"},[t("div",{staticClass:"label"},[e._v("预计收入")]),t("div",{staticClass:"value"},[e._v("￥"+e._s(e.toAmount(e.overview.income)))])]),t("div",{staticClass:"overview-card"},[t("div",{staticClass:"label"},[e._v("成交流水")]),t("div",{staticClass:"value"},[e._v("￥"+e._s(e.toAmount(e.overview.turnover)))])]),t("div",{staticClass:"overview-card"},[t("div",{staticClass:"label"},[e._v("订单数")]),t("div",{staticClass:"value"},[e._v(e._s(e.overview.order_count||0))])]),t("div",{staticClass:"overview-card"},[t("div",{staticClass:"label"},[e._v("有效分销员")]),t("div",{staticClass:"value"},[e._v(e._s(e.overview.agent_count||0))])])]),t("a-row",{staticStyle:{"margin-top":"16px"},attrs:{gutter:16}},[t("a-col",{attrs:{span:8}},[t("a-card",{attrs:{title:"分销员排行榜",bordered:"false",size:"small",loading:e.rankingLoading}},[t("a-table",{attrs:{columns:e.rankingColumns,dataSource:e.ranking,size:"small",rowKey:"user_id",pagination:!1}})],1)],1),t("a-col",{attrs:{span:16}},[t("a-card",{attrs:{title:"日维度统计",bordered:"false",size:"small"}},[t("a-table",{attrs:{columns:e.dailyColumns,dataSource:e.dailyList,loading:e.dailyLoading,pagination:e.dailyPagination,rowKey:"id",size:"small"},on:{change:e.handleDailyChange},scopedSlots:e._u([{key:"agent",fn:function(a,n){return[t("span",[e._v("#"+e._s(n.user_id)+" "+e._s(e.resolveNickname(n.user_id,n.nickname)))])]}},{key:"actions",fn:function(a,n){return[t("a",{on:{click:function(t){return e.openDetail(n)}}},[e._v("查看趋势")])]}}])})],1)],1)],1)],1),t("a-drawer",{attrs:{visible:e.detailVisible,title:e.detailTitle,width:720,destroyOnClose:""},on:{close:e.closeDetail}},[t("div",{staticClass:"detail-toolbar"},[t("span",[e._v("统计范围：")]),t("a-select",{staticStyle:{width:"120px"},on:{change:e.handleDetailRangeChange},model:{value:e.detailRange,callback:function(t){e.detailRange=t},expression:"detailRange"}},[t("a-select-option",{attrs:{value:"7d"}},[e._v("近7天")]),t("a-select-option",{attrs:{value:"30d"}},[e._v("近30天")]),t("a-select-option",{attrs:{value:"90d"}},[e._v("近90天")])],1)],1),t("a-spin",{attrs:{spinning:e.detailLoading}},[e.detailSummary?t("div",{staticClass:"summary-grid"},[t("div",{staticClass:"summary-card"},[t("div",{staticClass:"label"},[e._v("收入合计")]),t("div",{staticClass:"value"},[e._v("￥"+e._s(e.toAmount(e.detailSummary.income)))])]),t("div",{staticClass:"summary-card"},[t("div",{staticClass:"label"},[e._v("已入账")]),t("div",{staticClass:"value"},[e._v("￥"+e._s(e.toAmount(e.detailSummary.accounted)))])]),t("div",{staticClass:"summary-card"},[t("div",{staticClass:"label"},[e._v("成交流水")]),t("div",{staticClass:"value"},[e._v("￥"+e._s(e.toAmount(e.detailSummary.turnover)))])]),t("div",{staticClass:"summary-card"},[t("div",{staticClass:"label"},[e._v("订单数")]),t("div",{staticClass:"value"},[e._v(e._s(e.detailSummary.order_count||0))])]),t("div",{staticClass:"summary-card"},[t("div",{staticClass:"label"},[e._v("分享次数")]),t("div",{staticClass:"value"},[e._v(e._s(e.detailSummary.share_count||0))])]),t("div",{staticClass:"summary-card"},[t("div",{staticClass:"label"},[e._v("团队人数")]),t("div",{staticClass:"value"},[e._v(e._s(e.detailSummary.member_total||0))])])]):e._e(),e.detailSeries.length?t("a-table",{attrs:{columns:e.detailColumns,dataSource:e.detailSeries,pagination:!1,size:"small",rowKey:"date"}}):t("a-empty",{attrs:{description:"暂无数据"}})],1)],1)],1)},r=[],i=a(69870),s=a(57888),o=a(17654),c=a(21092),u=a(95093),l=a.n(u),d=a(35491),m={data:function(){var e=this;return{query:{dateRange:[],rangePreset:"30d",metric:"income",agentId:void 0,page:1,per_page:10},overview:{income:0,turnover:0,order_count:0,agent_count:0},ranking:[],rankingLoading:!1,rankingColumns:[{title:"排名",dataIndex:"rank",width:70,customRender:function(e,t,a){return a+1}},{title:"分销员",dataIndex:"user_id",customRender:function(t){return"#".concat(t," ").concat(e.resolveNickname(t))}},{title:"预计收入",dataIndex:"income",customRender:function(t){return"￥".concat(e.toAmount(t))}},{title:"成交流水",dataIndex:"turnover",customRender:function(t){return"￥".concat(e.toAmount(t))}},{title:"订单数",dataIndex:"order_count"}],dailyList:[],dailyLoading:!1,dailyPagination:{current:1,pageSize:10,total:0,showTotal:function(e){return"共 ".concat(e," 条")}},dailyColumns:[{title:"日期",dataIndex:"date"},{title:"分销员",dataIndex:"user_id",scopedSlots:{customRender:"agent"}},{title:"等级",dataIndex:"level",customRender:function(e){return"LV".concat(e||1)}},{title:"预计收入",dataIndex:"income",customRender:function(t){return"￥".concat(e.toAmount(t))}},{title:"成交流水",dataIndex:"turnover",customRender:function(t){return"￥".concat(e.toAmount(t))}},{title:"订单数",dataIndex:"order_count"},{title:"分享数",dataIndex:"share_count"},{title:"操作",dataIndex:"actions",scopedSlots:{customRender:"actions"},width:100}],agentCache:{},detailVisible:!1,detailLoading:!1,detailSummary:null,detailSeries:[],detailColumns:[{title:"日期",dataIndex:"date"},{title:"收入",dataIndex:"income",customRender:function(t){return"￥".concat(e.toAmount(t))}},{title:"已入账",dataIndex:"accounted",customRender:function(t){return"￥".concat(e.toAmount(t))}},{title:"流水",dataIndex:"turnover",customRender:function(t){return"￥".concat(e.toAmount(t))}},{title:"订单数",dataIndex:"order_count"},{title:"分享数",dataIndex:"share_count"},{title:"团队人数",dataIndex:"member_total"}],detailRange:"30d",currentAgent:null}},computed:{detailTitle:function(){if(!this.currentAgent)return"分销员数据";var e=this.resolveNickname(this.currentAgent.user_id,this.currentAgent.nickname);return e?"分销员 #".concat(this.currentAgent.user_id,"（").concat(e,"）"):"分销员 #".concat(this.currentAgent.user_id)}},mounted:function(){this.applyPreset("30d"),this.loadOverview(),this.loadRanking(),this.loadDaily(!0)},methods:{resolveNickname:function(e,t){var a=this.agentCache[e];return(null===a||void 0===a?void 0:a.nickname)||(null===a||void 0===a?void 0:a.user_nickname)||t||""},toAmount:function(e){return Number(e||0).toFixed(2)},formatDate:function(e){return e?l()(e).format("YYYY-MM-DD HH:mm"):"-"},getDateParams:function(){if(!this.query.dateRange||2!==this.query.dateRange.length)return{};var e=(0,c.A)(this.query.dateRange,2),t=e[0],a=e[1];return{date_between:[t.startOf("day").format("YYYY-MM-DD"),a.endOf("day").format("YYYY-MM-DD")]}},applyPreset:function(e){this.query.rangePreset=e;var t,a=l()();switch(e){case"7d":t=a.clone().subtract(6,"days");break;case"90d":t=a.clone().subtract(89,"days");break;default:t=a.clone().subtract(29,"days");break}this.query.dateRange=[t.startOf("day"),a.endOf("day")]},handlePresetChange:function(e){this.applyPreset(e.target.value),this.handleSearch()},handleDateChange:function(){this.query.rangePreset=void 0},loadOverview:function(){var e=this;return(0,o.A)((0,i.A)().mark((function t(){var a,n;return(0,i.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,a=(0,s.A)({},e.getDateParams()),t.next=4,(0,d.UF)(a);case 4:n=t.sent,n&&(e.overview={income:Number(n.income||0),turnover:Number(n.turnover||0),order_count:Number(n.order_count||0),agent_count:Number(n.agent_count||0)}),t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](0),e.$message.error((null===t.t0||void 0===t.t0?void 0:t.t0.msg)||"概览数据加载失败");case 11:case"end":return t.stop()}}),t,null,[[0,8]])})))()},loadRanking:function(){var e=this;return(0,o.A)((0,i.A)().mark((function t(){var a,n;return(0,i.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.rankingLoading=!0,t.prev=1,a=(0,s.A)({metric:e.query.metric,limit:20},e.getDateParams()),t.next=5,(0,d.tl)(a);case 5:n=t.sent,e.ranking=(n||[]).map((function(e,t){return(0,s.A)((0,s.A)({},e),{},{rank:t+1})})),t.next=12;break;case 9:t.prev=9,t.t0=t["catch"](1),e.$message.error((null===t.t0||void 0===t.t0?void 0:t.t0.msg)||"排行榜加载失败");case 12:return t.prev=12,e.rankingLoading=!1,t.finish(12);case 15:case"end":return t.stop()}}),t,null,[[1,9,12,15]])})))()},loadDaily:function(){var e=arguments,t=this;return(0,o.A)((0,i.A)().mark((function a(){var n,r,o,c,u;return(0,i.A)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=e.length>0&&void 0!==e[0]&&e[0],n&&(t.query.page=1,t.dailyPagination.current=1),t.dailyLoading=!0,a.prev=3,r=(0,s.A)({page:t.query.page,per_page:t.query.per_page},t.getDateParams()),t.query.agentId&&(o=Number(t.query.agentId),Number.isFinite(o)&&(r.user_id=o)),a.next=8,(0,d.SE)(r);case 8:c=a.sent,u=(c.data||[]).map((function(e){return(0,s.A)((0,s.A)({},e),{},{id:"".concat(e.date||"","-").concat(e.user_id)})})),t.dailyList=u,t.dailyPagination=(0,s.A)((0,s.A)({},t.dailyPagination),{},{current:c.current_page||t.query.page,pageSize:c.per_page||t.query.per_page,total:c.total||0}),t.addAgentsToCache(u),a.next=18;break;case 15:a.prev=15,a.t0=a["catch"](3),t.$message.error((null===a.t0||void 0===a.t0?void 0:a.t0.msg)||"日统计加载失败");case 18:return a.prev=18,t.dailyLoading=!1,a.finish(18);case 21:case"end":return a.stop()}}),a,null,[[3,15,18,21]])})))()},addAgentsToCache:function(e){var t=this;(e||[]).forEach((function(e){var a=Number(e.user_id);!Number.isFinite(a)||a<=0||(t.agentCache[a]=(0,s.A)((0,s.A)((0,s.A)({},t.agentCache[a]),e),{},{user_id:a,nickname:e.nickname||e.user_nickname}))}))},handleDailyChange:function(e){this.query.page=e.current,this.query.per_page=e.pageSize,this.loadDaily()},handleSearch:function(){this.loadOverview(),this.loadRanking(),this.loadDaily(!0)},reset:function(){this.query.dateRange=[],this.query.rangePreset="30d",this.query.metric="income",this.query.agentId=void 0,this.applyPreset("30d"),this.handleSearch()},openDetail:function(e){this.currentAgent={user_id:e.user_id,nickname:e.nickname||e.user_nickname},this.detailVisible=!0,this.detailRange="30d",this.loadAgentDetail()},loadAgentDetail:function(){var e=this;return(0,o.A)((0,i.A)().mark((function t(){var a,n;return(0,i.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.currentAgent){t.next=2;break}return t.abrupt("return");case 2:return e.detailLoading=!0,t.prev=3,t.next=6,(0,d.gF)({agent_id:e.currentAgent.user_id,range:e.detailRange});case 6:n=t.sent,e.detailSummary=null!==n&&void 0!==n&&n.summary?(0,s.A)({},n.summary):null,e.detailSeries=((null===n||void 0===n?void 0:n.series)||[]).map((function(e){return{date:e.date,income:Number(e.income||0),accounted:Number(e.accounted||0),turnover:Number(e.turnover||0),order_count:Number(e.order_count||0),share_count:Number(e.share_count||0),member_total:Number(e.member_total||0)}})),null!==(a=e.detailSummary)&&void 0!==a&&a.nickname&&(e.agentCache[e.currentAgent.user_id]=(0,s.A)((0,s.A)({},e.agentCache[e.currentAgent.user_id]||{}),{},{nickname:e.detailSummary.nickname})),t.next=17;break;case 12:t.prev=12,t.t0=t["catch"](3),e.$message.error((null===t.t0||void 0===t.t0?void 0:t.t0.msg)||"统计数据获取失败"),e.detailSummary=null,e.detailSeries=[];case 17:return t.prev=17,e.detailLoading=!1,t.finish(17);case 20:case"end":return t.stop()}}),t,null,[[3,12,17,20]])})))()},handleDetailRangeChange:function(e){this.detailRange=e,this.loadAgentDetail()},closeDetail:function(){this.detailVisible=!1,this.detailLoading=!1,this.currentAgent=null,this.detailSummary=null,this.detailSeries=[],this.detailRange="30d"}}},p=m,g=a(81656),v=(0,g.A)(p,n,r,!1,null,"3f28752f",null),h=v.exports},66821:function(e,t,a){a.r(t),a.d(t,{default:function(){return h}});var n=function(){var e=this,t=e._self._c;return t("a-card",{attrs:{bordered:"false"}},[t("div",{staticClass:"table-search"},[t("a-form",{attrs:{layout:"inline"}},[t("a-form-item",{attrs:{label:"状态"}},[t("a-select",{staticStyle:{width:"160px"},attrs:{allowClear:"",placeholder:"全部"},model:{value:e.query.status,callback:function(t){e.$set(e.query,"status",t)},expression:"query.status"}},[t("a-select-option",{attrs:{value:"pending"}},[e._v("待审核")]),t("a-select-option",{attrs:{value:"approved"}},[e._v("待打款")]),t("a-select-option",{attrs:{value:"paid"}},[e._v("已打款")]),t("a-select-option",{attrs:{value:"rejected"}},[e._v("已拒绝")])],1)],1),t("a-form-item",[t("a-button",{attrs:{type:"primary",icon:"search"},on:{click:function(t){return e.loadData(!0)}}},[e._v("查询")]),t("a-button",{staticStyle:{"margin-left":"8px"},attrs:{icon:"reload"},on:{click:e.reset}},[e._v("重置")])],1)],1)],1),t("a-table",{attrs:{columns:e.columns,dataSource:e.list,loading:e.loading,pagination:e.pagination,rowKey:"id"},on:{change:e.handleTableChange},scopedSlots:e._u([{key:"amount",fn:function(a){return t("span",{},[e._v(" ￥"+e._s(Number(a||0).toFixed(2))+" ")])}},{key:"status",fn:function(a){return t("span",{},[t("a-tag",{attrs:{color:e.statusColor(a)}},[e._v(e._s(e.statusText(a)))])],1)}},{key:"account",fn:function(a,n){return t("span",{},[e._v(" "+e._s(e.formatAccount(n))+" ")])}},{key:"actions",fn:function(a,n){return t("span",{},["pending"===n.status?t("span",[t("a-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.handleApprove(n)}}},[e._v("通过")]),t("a-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"danger",size:"small"},on:{click:function(t){return e.handleReject(n)}}},[e._v("拒绝")])],1):"approved"===n.status?t("span",[t("a-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.handleMarkPaid(n)}}},[e._v("标记打款")]),t("a-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"danger",size:"small"},on:{click:function(t){return e.handleReject(n)}}},[e._v("拒绝")])],1):t("span",[e._v("-")])])}}])})],1)},r=[],i=(a(96305),a(43898)),s=a(69870),o=a(57888),c=a(17654),u=a(95093),l=a.n(u),d=a(35491),m={data:function(){var e=this;return{loading:!1,list:[],query:{page:1,per_page:10,status:void 0},pagination:{current:1,pageSize:10,total:0,showTotal:function(e){return"共 ".concat(e," 条")}},columns:[{title:"ID",dataIndex:"id"},{title:"用户ID",dataIndex:"user_id"},{title:"提现金额",dataIndex:"amount",scopedSlots:{customRender:"amount"}},{title:"手续费",dataIndex:"fee",customRender:function(e){return"￥".concat(Number(e||0).toFixed(2))}},{title:"到账方式",scopedSlots:{customRender:"account"}},{title:"状态",dataIndex:"status",scopedSlots:{customRender:"status"}},{title:"申请时间",dataIndex:"created_at",customRender:function(t){return e.formatDate(t)}},{title:"审核时间",dataIndex:"reviewed_at",customRender:function(t){return e.formatDate(t)}},{title:"打款时间",dataIndex:"paid_at",customRender:function(t){return e.formatDate(t)}},{title:"操作",scopedSlots:{customRender:"actions"}}]}},mounted:function(){this.loadData(!0)},methods:{loadData:function(){var e=arguments,t=this;return(0,c.A)((0,s.A)().mark((function a(){var n,r;return(0,s.A)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=e.length>0&&void 0!==e[0]&&e[0],n&&(t.query.page=1,t.pagination.current=1),t.loading=!0,a.prev=3,a.next=6,(0,d.v7)((0,o.A)({},t.query));case 6:r=a.sent,t.list=r.data||[],t.pagination=(0,o.A)((0,o.A)({},t.pagination),{},{current:r.current_page||1,pageSize:r.per_page||t.query.per_page,total:r.total||0}),a.next=14;break;case 11:a.prev=11,a.t0=a["catch"](3),t.$message.error((null===a.t0||void 0===a.t0?void 0:a.t0.msg)||"加载失败");case 14:return a.prev=14,t.loading=!1,a.finish(14);case 17:case"end":return a.stop()}}),a,null,[[3,11,14,17]])})))()},handleTableChange:function(e){this.query.page=e.current,this.query.per_page=e.pageSize,this.loadData()},reset:function(){this.query.status=void 0,this.loadData(!0)},statusText:function(e){switch(e){case"pending":return"待审核";case"approved":return"待打款";case"paid":return"已打款";case"rejected":return"已拒绝";default:return e}},statusColor:function(e){switch(e){case"pending":return"orange";case"approved":return"blue";case"paid":return"green";case"rejected":return"red";default:return"purple"}},formatDate:function(e){return e?l()(e).format("YYYY-MM-DD HH:mm"):"-"},formatAccount:function(e){if(!e)return"-";if("wechat"===e.account_type||!e.account_type)return"微信零钱";var t=e.account_info||{};if("alipay"===e.account_type)return"支付宝 ".concat(t.account_no||"");if("bank_card"===e.account_type){var a=t.account_no?t.account_no.slice(-4):"";return"".concat(t.bank_name||"银行卡"," (***").concat(a,")")}return e.account_type},handleApprove:function(e){var t=this;return(0,c.A)((0,s.A)().mark((function a(){return(0,s.A)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:i.A.confirm({title:"确认操作",content:"确认通过该提现申请吗？",onOk:function(){var a=(0,c.A)((0,s.A)().mark((function a(){return(0,s.A)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,(0,d.Vm)(e.id);case 3:t.$message.success("操作成功"),t.loadData(),a.next=10;break;case 7:a.prev=7,a.t0=a["catch"](0),t.$message.error((null===a.t0||void 0===a.t0?void 0:a.t0.msg)||"操作失败");case 10:case"end":return a.stop()}}),a,null,[[0,7]])})));function n(){return a.apply(this,arguments)}return n}()});case 1:case"end":return a.stop()}}),a)})))()},handleReject:function(e){var t=this;return(0,c.A)((0,s.A)().mark((function a(){return(0,s.A)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:i.A.confirm({title:"确认操作",content:"确认拒绝该提现申请吗？",onOk:function(){var a=(0,c.A)((0,s.A)().mark((function a(){return(0,s.A)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,(0,d.Tb)(e.id);case 3:t.$message.success("已拒绝"),t.loadData(),a.next=10;break;case 7:a.prev=7,a.t0=a["catch"](0),t.$message.error((null===a.t0||void 0===a.t0?void 0:a.t0.msg)||"操作失败");case 10:case"end":return a.stop()}}),a,null,[[0,7]])})));function n(){return a.apply(this,arguments)}return n}()});case 1:case"end":return a.stop()}}),a)})))()},handleMarkPaid:function(e){var t=this;return(0,c.A)((0,s.A)().mark((function a(){return(0,s.A)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:i.A.confirm({title:"确认操作",content:"确认已完成打款？",onOk:function(){var a=(0,c.A)((0,s.A)().mark((function a(){return(0,s.A)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,(0,d.xY)(e.id);case 3:t.$message.success("已标记打款"),t.loadData(),a.next=10;break;case 7:a.prev=7,a.t0=a["catch"](0),t.$message.error((null===a.t0||void 0===a.t0?void 0:a.t0.msg)||"操作失败");case 10:case"end":return a.stop()}}),a,null,[[0,7]])})));function n(){return a.apply(this,arguments)}return n}()});case 1:case"end":return a.stop()}}),a)})))()}}},p=m,g=a(81656),v=(0,g.A)(p,n,r,!1,null,"4019ed5f",null),h=v.exports},35491:function(e,t,a){a.d(t,{$X:function(){return d},Gg:function(){return l},L_:function(){return c},RS:function(){return p},SE:function(){return _},Sn:function(){return s},Tb:function(){return h},UF:function(){return b},Vm:function(){return v},gF:function(){return w},oQ:function(){return u},pQ:function(){return i},tl:function(){return y},v7:function(){return g},vt:function(){return m},x4:function(){return o},xY:function(){return f}});var n=a(26222),r={agents:"/agents",agentDetail:"/agents/{id}",agentStats:"/agents/{id}/stats",createAgent:"/agents",updateAgent:"/agents/{id}",managerAgents:"/members/{id}/agents",assignAgents:"/members/{id}/assign_agents",managers:"/distribution/managers",rebates:"/rebates",rebateApprove:"/rebates/{id}/approve",rebateReject:"/rebates/{id}/reject",withdrawals:"/withdrawals",withdrawalApprove:"/withdrawals/{id}/approve",withdrawalReject:"/withdrawals/{id}/reject",withdrawalMarkPaid:"/withdrawals/{id}/mark_paid",statsDaily:"/agents/stats/daily",statsRanking:"/agents/stats/ranking",statsOverall:"/agents/stats/overall",statsTeam:"/agents/stats/team",statsDetail:"/agents/stats/detail"};function i(e){return(0,n.p)({url:r.agents,method:"get",params:e})}function s(e){return(0,n.p)({url:r.createAgent,method:"post",data:e})}function o(e,t){return(0,n.p)({url:r.updateAgent.replace("{id}",e),method:"patch",data:t})}function c(e){return(0,n.p)({url:r.managers,method:"get",params:e})}function u(e,t){return(0,n.p)({url:r.assignAgents.replace("{id}",e),method:"post",data:t})}function l(e,t){return(0,n.p)({url:r.managerAgents.replace("{id}",e),method:"get",params:t})}function d(e){return(0,n.p)({url:r.rebates,method:"get",params:e})}function m(e,t){return(0,n.p)({url:r.rebateApprove.replace("{id}",e),method:"patch",data:t})}function p(e,t){return(0,n.p)({url:r.rebateReject.replace("{id}",e),method:"patch",data:t})}function g(e){return(0,n.p)({url:r.withdrawals,method:"get",params:e})}function v(e,t){return(0,n.p)({url:r.withdrawalApprove.replace("{id}",e),method:"patch",data:t})}function h(e,t){return(0,n.p)({url:r.withdrawalReject.replace("{id}",e),method:"patch",data:t})}function f(e,t){return(0,n.p)({url:r.withdrawalMarkPaid.replace("{id}",e),method:"patch",data:t})}function _(e){return(0,n.p)({url:r.statsDaily,method:"get",params:e})}function y(e){return(0,n.p)({url:r.statsRanking,method:"get",params:e})}function b(e){return(0,n.p)({url:r.statsOverall,method:"get",params:e})}function w(e){return(0,n.p)({url:r.statsDetail,method:"get",params:e})}},17654:function(e,t,a){function n(e,t,a,n,r,i,s){try{var o=e[i](s),c=o.value}catch(e){return void a(e)}o.done?t(c):Promise.resolve(c).then(n,r)}function r(e){return function(){var t=this,a=arguments;return new Promise((function(r,i){var s=e.apply(t,a);function o(e){n(s,r,i,o,c,"next",e)}function c(e){n(s,r,i,o,c,"throw",e)}o(void 0)}))}}a.d(t,{A:function(){return r}})},69870:function(e,t,a){a.d(t,{A:function(){return r}});var n=a(68285);function r(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
r=function(){return t};var e,t={},a=Object.prototype,i=a.hasOwnProperty,s=Object.defineProperty||function(e,t,a){e[t]=a.value},o="function"==typeof Symbol?Symbol:{},c=o.iterator||"@@iterator",u=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function d(e,t,a){return Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{d({},"")}catch(e){d=function(e,t,a){return e[t]=a}}function m(e,t,a,n){var r=t&&t.prototype instanceof y?t:y,i=Object.create(r.prototype),o=new O(n||[]);return s(i,"_invoke",{value:I(e,a,o)}),i}function p(e,t,a){try{return{type:"normal",arg:e.call(t,a)}}catch(e){return{type:"throw",arg:e}}}t.wrap=m;var g="suspendedStart",v="suspendedYield",h="executing",f="completed",_={};function y(){}function b(){}function w(){}var A={};d(A,c,(function(){return this}));var x=Object.getPrototypeOf,k=x&&x(x(M([])));k&&k!==a&&i.call(k,c)&&(A=k);var S=w.prototype=y.prototype=Object.create(A);function C(e){["next","throw","return"].forEach((function(t){d(e,t,(function(e){return this._invoke(t,e)}))}))}function D(e,t){function a(r,s,o,c){var u=p(e[r],e,s);if("throw"!==u.type){var l=u.arg,d=l.value;return d&&"object"==(0,n.A)(d)&&i.call(d,"__await")?t.resolve(d.__await).then((function(e){a("next",e,o,c)}),(function(e){a("throw",e,o,c)})):t.resolve(d).then((function(e){l.value=e,o(l)}),(function(e){return a("throw",e,o,c)}))}c(u.arg)}var r;s(this,"_invoke",{value:function(e,n){function i(){return new t((function(t,r){a(e,n,t,r)}))}return r=r?r.then(i,i):i()}})}function I(t,a,n){var r=g;return function(i,s){if(r===h)throw Error("Generator is already running");if(r===f){if("throw"===i)throw s;return{value:e,done:!0}}for(n.method=i,n.arg=s;;){var o=n.delegate;if(o){var c=L(o,n);if(c){if(c===_)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===g)throw r=f,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=h;var u=p(t,a,n);if("normal"===u.type){if(r=n.done?f:v,u.arg===_)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r=f,n.method="throw",n.arg=u.arg)}}}function L(t,a){var n=a.method,r=t.iterator[n];if(r===e)return a.delegate=null,"throw"===n&&t.iterator["return"]&&(a.method="return",a.arg=e,L(t,a),"throw"===a.method)||"return"!==n&&(a.method="throw",a.arg=new TypeError("The iterator does not provide a '"+n+"' method")),_;var i=p(r,t.iterator,a.arg);if("throw"===i.type)return a.method="throw",a.arg=i.arg,a.delegate=null,_;var s=i.arg;return s?s.done?(a[t.resultName]=s.value,a.next=t.nextLoc,"return"!==a.method&&(a.method="next",a.arg=e),a.delegate=null,_):s:(a.method="throw",a.arg=new TypeError("iterator result is not an object"),a.delegate=null,_)}function R(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function q(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(R,this),this.reset(!0)}function M(t){if(t||""===t){var a=t[c];if(a)return a.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,s=function a(){for(;++r<t.length;)if(i.call(t,r))return a.value=t[r],a.done=!1,a;return a.value=e,a.done=!0,a};return s.next=s}}throw new TypeError((0,n.A)(t)+" is not iterable")}return b.prototype=w,s(S,"constructor",{value:w,configurable:!0}),s(w,"constructor",{value:b,configurable:!0}),b.displayName=d(w,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,d(e,l,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},C(D.prototype),d(D.prototype,u,(function(){return this})),t.AsyncIterator=D,t.async=function(e,a,n,r,i){void 0===i&&(i=Promise);var s=new D(m(e,a,n,r),i);return t.isGeneratorFunction(a)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},C(S),d(S,l,"Generator"),d(S,c,(function(){return this})),d(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),a=[];for(var n in t)a.push(n);return a.reverse(),function e(){for(;a.length;){var n=a.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=M,O.prototype={constructor:O,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(q),!t)for(var a in this)"t"===a.charAt(0)&&i.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var a=this;function n(n,r){return o.type="throw",o.arg=t,a.next=n,r&&(a.method="next",a.arg=e),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var s=this.tryEntries[r],o=s.completion;if("root"===s.tryLoc)return n("end");if(s.tryLoc<=this.prev){var c=i.call(s,"catchLoc"),u=i.call(s,"finallyLoc");if(c&&u){if(this.prev<s.catchLoc)return n(s.catchLoc,!0);if(this.prev<s.finallyLoc)return n(s.finallyLoc)}else if(c){if(this.prev<s.catchLoc)return n(s.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return n(s.finallyLoc)}}}},abrupt:function(e,t){for(var a=this.tryEntries.length-1;a>=0;--a){var n=this.tryEntries[a];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var r=n;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var s=r?r.completion:{};return s.type=e,s.arg=t,r?(this.method="next",this.next=r.finallyLoc,_):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),_},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var a=this.tryEntries[t];if(a.finallyLoc===e)return this.complete(a.completion,a.afterLoc),q(a),_}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var a=this.tryEntries[t];if(a.tryLoc===e){var n=a.completion;if("throw"===n.type){var r=n.arg;q(a)}return r}}throw Error("illegal catch attempt")},delegateYield:function(t,a,n){return this.delegate={iterator:M(t),resultName:a,nextLoc:n},"next"===this.method&&(this.arg=e),_}},t}}}]);
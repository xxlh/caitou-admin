"use strict";(self["webpackChunkvue_antd_pro"]=self["webpackChunkvue_antd_pro"]||[]).push([[459],{32964:function(e,t,a){a.r(t),a.d(t,{default:function(){return v}});var r=function(){var e=this,t=e._self._c;return t("a-card",{attrs:{bordered:!1}},[t("div",{staticClass:"card-title"},[e._v(e._s(e.$route.meta.title))]),t("a-spin",{attrs:{spinning:e.isLoading}},[t("a-form",{attrs:{form:e.form,selfUpdate:!0},on:{submit:e.handleSubmit}},[t("a-tabs",{attrs:{activeKey:e.tabKey,tabBarStyle:{marginBottom:"30px"}},on:{change:e.handleTabs}},[t("a-tab-pane",{key:0,attrs:{tab:"基本信息"}}),t("a-tab-pane",{key:1,attrs:{tab:"规格/库存"}}),t("a-tab-pane",{key:2,attrs:{tab:"商品详情"}}),t("a-tab-pane",{key:3,attrs:{tab:"更多设置"}})],1),t("div",{staticClass:"tabs-content"},[t("div",{directives:[{name:"show",rawName:"v-show",value:0==e.tabKey,expression:"tabKey == 0"}],staticClass:"tab-pane"},[t("a-form-item",{attrs:{label:"商品名称",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["title",{rules:[{required:!0,min:2,message:"请输入至少2个字符"}]}],expression:"['title', {rules: [{required: true, min: 2, message: '请输入至少2个字符'}]}]"}],attrs:{placeholder:"请输入商品名称"}})],1),t("a-form-item",{attrs:{label:"商品类型",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["type",{initialValue:e.$store.getters.storeId?"intra-city":"physical",rules:[{required:!0}]}],expression:"['type', {initialValue: $store.getters.storeId ? 'intra-city' : 'physical', rules: [{required: true}]}]"}]},[t("a-radio",{attrs:{value:"intra-city"}},[e._v("同城商品")]),t("a-radio",{attrs:{value:"physical"}},[e._v("跨地商品")]),t("a-radio",{attrs:{value:"travel"}},[e._v("旅游线路")]),t("a-radio",{attrs:{value:"verification"}},[e._v("核销卡券")]),t("a-radio",{attrs:{value:"virtual"}},[e._v("线下交易")])],1)],1),t("a-form-item",{attrs:{label:"商品分类",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-tree-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["categorys",{rules:[{required:!0,message:"请至少选择1个商品分类"}]}],expression:"['categorys', {rules: [{required: true, message: '请至少选择1个商品分类'}]}]"}],attrs:{placeholder:"请选择商品分类",dropdownStyle:{maxHeight:"500px",overflow:"auto"},treeData:e.formData.categoryList,treeCheckable:"",treeCheckStrictly:"",allowClear:""}}),t("div",{staticClass:"form-item-help"},[t("router-link",{attrs:{target:"_blank",to:{path:"/goods/category/index"}}},[e._v("去新增")]),t("a",{attrs:{href:"javascript:;"},on:{click:e.onReloadCategoryList}},[e._v("刷新")])],1)],1),t("a-form-item",{attrs:{label:"商品图片",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"建议尺寸：750*750像素, 最多上传10张, 可拖拽图片调整顺序, 第1张将作为商品首图"}},[t("SelectImage",{directives:[{name:"decorator",rawName:"v-decorator",value:["image_ids",{rules:[{required:!0,message:"请至少上传1张商品图片"}]}],expression:"['image_ids', {rules: [{required: true, message: '请至少上传1张商品图片'}]}]"}],attrs:{collection:"product_images",multiple:"",maxNum:10}})],1),t("a-form-item",{attrs:{label:"运费模板",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["delivery_id",{rules:[{required:!1,message:"请选择运费模板"}]}],expression:"['delivery_id', {rules: [{required: false, message: '请选择运费模板'}]}]"}],staticStyle:{width:"300px"},attrs:{placeholder:"请选择运费模板"}},e._l(e.formData.deliveryList,(function(a,r){return t("a-select-option",{key:r,attrs:{value:a.delivery_id}},[e._v(e._s(a.name))])})),1),t("div",{staticClass:"form-item-help"},[t("router-link",{attrs:{target:"_blank",to:{path:"/setting/delivery/template/create"}}},[e._v("新增模板")]),t("a",{attrs:{href:"javascript:;"},on:{click:e.onReloadDeliveryList}},[e._v("刷新")])],1)],1),t("a-form-item",{attrs:{label:"商品状态",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["on_sale",{initialValue:!0,rules:[{required:!0}]}],expression:"['on_sale', {initialValue: true, rules: [{ required: true }]}]"}]},[t("a-radio",{attrs:{value:!0}},[e._v("上架")]),t("a-radio",{attrs:{value:!1}},[e._v("下架")])],1)],1)],1),t("div",{directives:[{name:"show",rawName:"v-show",value:1==e.tabKey,expression:"tabKey == 1"}],staticClass:"tab-pane"},[t("a-form-item",{attrs:{label:"规格类型",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["spec_type",{initialValue:10,rules:[{required:!0}]}],expression:"['spec_type', { initialValue: 10, rules: [{ required: true }] }]"}],on:{change:function(t){return e.onForceUpdate()}}},[t("a-radio",{attrs:{value:10}},[e._v("单规格")]),t("a-tooltip",{attrs:{title:"保存后可编辑多规格"}},[t("a-radio",{attrs:{value:20,disabled:""}},[e._v("多规格")])],1)],1)],1),t("div",{directives:[{name:"show",rawName:"v-show",value:20==e.form.getFieldValue("spec_type"),expression:"form.getFieldValue('spec_type') == 20"}]},[t("MultiSpec",{ref:"MultiSpec"})],1),t("div",{directives:[{name:"show",rawName:"v-show",value:10==e.form.getFieldValue("spec_type"),expression:"form.getFieldValue('spec_type') == 10"}]},[t("a-form-item",{attrs:{label:"商品价格",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"商品的实际购买金额，最低0.01"}},[t("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["price",{initialValue:1,rules:[{required:!0,message:"请输入商品价格"}]}],expression:"['price', { initialValue: 1, rules: [{ required: true, message: '请输入商品价格' }] }]"}],attrs:{min:.01,precision:2}}),t("span",{staticClass:"ml-10"},[e._v("元")])],1),t("a-form-item",{attrs:{label:"零售价",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"零售价仅用于商品页展示"}},[t("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["retail_price"],expression:"['retail_price']"}],attrs:{min:0,precision:2}}),t("span",{staticClass:"ml-10"},[e._v("元")])],1),t("a-form-item",{attrs:{label:"永辉价",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"永辉价仅用于商品页展示"}},[t("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["yh_price"],expression:"['yh_price']"}],attrs:{min:0,precision:2}}),t("span",{staticClass:"ml-10"},[e._v("元")])],1),t("a-form-item",{attrs:{label:"成本价",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"成本价仅用于计算盈亏"}},[t("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["cost_price"],expression:"['cost_price']"}],attrs:{min:0,precision:2}}),t("span",{staticClass:"ml-10"},[e._v("元")])],1),t("a-form-item",{attrs:{label:"当前库存数量",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"商品的实际库存数量，为0时用户无法下单"}},[t("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["stock",{initialValue:100,rules:[{required:!0,message:"请输入库存数量"}]}],expression:"['stock', { initialValue: 100, rules:[{ required: true, message: '请输入库存数量' }] }]"}],attrs:{min:0,precision:0}}),t("span",{staticClass:"ml-10"},[e._v("件")])],1),t("a-form-item",{attrs:{label:"商品重量",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"商品的实际重量，用于计算运费"}},[t("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["weight",{initialValue:0,rules:[{required:!1,message:"请输入库存数量"}]}],expression:"['weight', { initialValue: 0, rules:[{ required: false, message: '请输入库存数量' }] }]"}],attrs:{min:0}}),t("span",{staticClass:"ml-10"},[e._v("克 (g)")])],1)],1),t("a-form-item",{attrs:{label:"库存计算方式",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["deduct_stock_type",{initialValue:10,rules:[{required:!0}]}],expression:"['deduct_stock_type', {initialValue: 10, rules: [{ required: true }]}]"}]},[t("a-radio",{attrs:{value:10}},[e._v("下单减库存")]),t("a-radio",{attrs:{value:20}},[e._v("付款减库存")])],1)],1)],1),t("div",{directives:[{name:"show",rawName:"v-show",value:2==e.tabKey,expression:"tabKey == 2"}],staticClass:"tab-pane"},[t("a-form-item",{attrs:{label:"商品详情",labelCol:e.labelCol,wrapperCol:{span:16}}},[t("Ueditor",{directives:[{name:"decorator",rawName:"v-decorator",value:["description",{rules:[{required:!0,message:"商品详情不能为空"}]}],expression:"['description', { rules: [{ required: true, message: '商品详情不能为空' }] }]"}],attrs:{collection:"desc_images"}})],1)],1),t("div",{directives:[{name:"show",rawName:"v-show",value:3==e.tabKey,expression:"tabKey == 3"}],staticClass:"tab-pane"},[t("a-form-item",{attrs:{label:"主图视频",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"建议视频宽高比19:9，建议时长8-45秒"}},[t("SelectVideo",{directives:[{name:"decorator",rawName:"v-decorator",value:["video_id"],expression:"['video_id']"}],attrs:{collection:"product_video",multiple:!1}})],1),t("a-form-item",{attrs:{label:"视频封面",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"建议尺寸：750像素*750像素"}},[t("SelectImage",{directives:[{name:"decorator",rawName:"v-decorator",value:["video_cover_id"],expression:"['video_cover_id']"}],attrs:{collection:"video_cover",multiple:!1}})],1),t("a-form-item",{attrs:{label:"商品卖点",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"一句话简述，例如：此款商品美观大方 性价比较高 不容错过"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["highlight"],expression:"['highlight']"}],attrs:{placeholder:"请输入商品卖点"}})],1),t("a-form-item",{attrs:{label:"服务与承诺",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[e.formData.serviceList?t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["serviceIds",{initialValue:e.formData.defaultServiceIds}],expression:"['serviceIds', { initialValue: formData.defaultServiceIds }]"}],attrs:{mode:"multiple",placeholder:"请选择服务与承诺"}},e._l(e.formData.serviceList,(function(a,r){return t("a-select-option",{key:r,attrs:{value:a.service_id}},[e._v(e._s(a.name))])})),1):e._e(),t("div",{staticClass:"form-item-help"},[t("router-link",{attrs:{target:"_blank",to:{path:"/goods/service/index"}}},[e._v("去新增")]),t("a",{attrs:{href:"javascript:;"},on:{click:e.onReloadServiceList}},[e._v("刷新")])],1)],1),t("a-form-item",{attrs:{label:"初始销量",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"用户端展示的销量 = 初始销量 + 实际销量"}},[t("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["sold_inital",{initialValue:0}],expression:"['sold_inital', {initialValue: 0}]"}]})],1),t("a-divider",{attrs:{orientation:"left"}},[e._v("积分设置")]),t("a-form-item",{attrs:{label:"积分赠送",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"开启后用户购买此商品将获得积分"}},[t("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["is_points_gift",{initialValue:1,rules:[{required:!0}]}],expression:"['is_points_gift', {initialValue: 1, rules: [{ required: true }]}]"}]},[t("a-radio",{attrs:{value:1}},[e._v("开启")]),t("a-radio",{attrs:{value:0}},[e._v("关闭")])],1)],1),t("a-form-item",{attrs:{label:"积分抵扣",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"开启后用户购买此商品可以使用积分进行抵扣"}},[t("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["is_points_discount",{initialValue:1,rules:[{required:!0}]}],expression:"['is_points_discount', {initialValue: 1, rules: [{ required: true }]}]"}]},[t("a-radio",{attrs:{value:1}},[e._v("开启")]),t("a-radio",{attrs:{value:0}},[e._v("关闭")])],1)],1),t("a-divider",{attrs:{orientation:"left"}},[e._v("会员折扣设置")]),t("a-form-item",{attrs:{label:"会员折扣",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"开启后会员折扣，会员购买此商品可以享受会员等级折扣价"}},[t("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["is_enable_grade",{initialValue:1,rules:[{required:!0}]}],expression:"['is_enable_grade', {initialValue: 1, rules: [{ required: true }]}]"}],on:{change:function(t){return e.onForceUpdate(!0)}}},[t("a-radio",{attrs:{value:1}},[e._v("开启")]),t("a-radio",{attrs:{value:0}},[e._v("关闭")])],1)],1),e.form.getFieldValue("is_enable_grade")?t("a-form-item",{attrs:{label:"会员折扣设置",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["is_alone_grade",{initialValue:0,rules:[{required:!0}]}],expression:"['is_alone_grade', { initialValue: 0, rules: [{ required: true }] }]"}],on:{change:function(t){return e.onForceUpdate(!0)}}},[t("a-radio",{attrs:{value:0}},[e._v("默认等级折扣")]),t("a-radio",{attrs:{value:1}},[e._v("单独设置折扣")])],1),e.form.getFieldValue("is_alone_grade")?t("div",e._l(e.formData.userGradeList,(function(a){return t("a-form-item",{key:a.grade_id},[t("InputNumberGroup",{directives:[{name:"decorator",rawName:"v-decorator",value:["alone_grade_equity[grade_id:".concat(a.grade_id,"]"),{initialValue:e.formData.defaultUserGradeValue[a.grade_id],rules:[{required:!0,message:"折扣率不能为空"}]}],expression:"[`alone_grade_equity[grade_id:${item.grade_id}]`, {\n                    initialValue: formData.defaultUserGradeValue[item.grade_id], rules: [{required: true, message: '折扣率不能为空'}]\n                  }]"}],attrs:{addonBefore:a.name,addonAfter:"折",inputProps:{min:0,max:9.9}}})],1)})),1):e._e(),t("div",{staticClass:"form-item-help"},[e.form.getFieldValue("is_alone_grade")?t("p",{staticClass:"extra"},[e._v("单独折扣：折扣率范围0.0-9.9，例如: 9.8代表98折，0代表不折扣")]):t("p",{staticClass:"extra"},[e._v("默认折扣：默认为用户所属会员等级的折扣率")])])],1):e._e()],1)]),t("a-form-item",{staticClass:"mt-20",attrs:{"wrapper-col":{span:e.wrapperCol.span,offset:e.labelCol.span}}},[t("a-button",{attrs:{type:"primary","html-type":"submit",loading:e.isBtnLoading}},[e._v("提交")])],1)],1)],1)],1)},i=[],o=a(5893),s=a(21550),l=a(78834),n=a(65829),d=a(81269),c={components:{SelectImage:s._7,SelectVideo:s.Ke,Ueditor:s.nv,InputNumberGroup:s.tE,MultiSpec:n.A},data:function(){return{tabKey:0,labelCol:{span:3},wrapperCol:{span:10},isLoading:!1,isBtnLoading:!1,form:this.$form.createForm(this),formData:l.A.formData,channel:d.A.PRODUCT.value}},created:function(){var e=this;this.isLoading=!0,l.A.getFormData().then((function(){e.isLoading=!1}))},methods:{onForceUpdate:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.$forceUpdate(),t&&setTimeout((function(){e.$forceUpdate()}),10)},handleTabs:function(e){this.tabKey=e},onReloadCategoryList:function(){var e=this;this.isLoading=!0,l.A.getCategoryList().then((function(){e.isLoading=!1}))},onReloadServiceList:function(){var e=this;this.isLoading=!0,l.A.getServiceList().then((function(){e.isLoading=!1}))},onReloadDeliveryList:function(){var e=this;this.isLoading=!0,l.A.getDeliveryList().then((function(){e.isLoading=!1}))},handleSubmit:function(e){var t=this;e.preventDefault();var a=this.form.validateFields;a((function(e,a){if(e)return t.onTargetTabError(e),!1;if(20===a.spec_type){var r=t.$refs.MultiSpec;if(!r.verifyForm())return t.tabKey=1,!1;a.specData=r.getFormSpecData(),delete a.price,delete a.stock}return a.category_ids=a.categorys.map((function(e){return e.value})),delete a.categorys,t.onFormSubmit(a),!0}))},onTargetTabError:function(e){var t=[["title","categorys","image_ids","delivery_id"],["spec_type","price"],["content"],["alone_grade_equity","first_money","second_money","third_money"]],a=Object.keys(e).shift();for(var r in t)if(t[r].indexOf(a)>-1){this.tabKey=parseInt(r);break}},onFormSubmit:function(e){var t=this;this.isLoading=!0,this.isBtnLoading=!0,e.store_id=this.$store.getters.storeId,o.WQ(e).then((function(e){t.$message.success("创建成功",1.5),setTimeout((function(){t.$router.push("./index")}),1500)})).catch((function(){t.isBtnLoading=!1})).finally((function(){t.isLoading=!1}))}}},u=c,m=a(81656),p=(0,m.A)(u,r,i,!1,null,"2c0c102c",null),v=p.exports},15497:function(e,t,a){a.r(t),a.d(t,{default:function(){return g}});var r=function(){var e=this,t=e._self._c;return t("a-card",{attrs:{bordered:!1}},[t("div",{staticClass:"card-title"},[e._v(e._s(e.$route.meta.title))]),t("div",{staticClass:"table-operator"},[t("a-row",{staticClass:"row-item-search"},[t("a-form",{staticClass:"search-form",attrs:{form:e.searchForm,layout:"inline"},on:{submit:e.handleSearch}},[t("a-form-item",{attrs:{label:"商品名称"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["title"],expression:"['title']"}],attrs:{placeholder:"请输入商品名称"}})],1),t("a-form-item",{attrs:{label:"商品编码"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["no"],expression:"['no']"}],attrs:{placeholder:"请输入商品编码"}})],1),t("a-form-item",{attrs:{label:"商品分类"}},[t("a-tree-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["category_ids",{initialValue:0}],expression:"['category_ids', { initialValue: 0 }]"}],attrs:{treeData:e.categoryListTree,dropdownStyle:{maxHeight:"500px",overflow:"auto"},allowClear:""}})],1),t("a-form-item",{staticClass:"search-btn"},[t("a-button",{attrs:{type:"primary",icon:"search","html-type":"submit"}},[e._v("搜索")])],1)],1)],1),t("div",{staticClass:"row-item-tab clearfix"},[t("div",{staticClass:"tab-list fl-l"},[t("a-radio-group",{on:{change:e.handleType},model:{value:e.queryParam.type,callback:function(t){e.$set(e.queryParam,"type",t)},expression:"queryParam.type"}},["旅游线路管理员"!=e.$store.getters.role.name&&"跨地商品管理员"!=e.$store.getters.role.name?t("a-radio-button",{attrs:{value:"intra-city"}},[e._v("同城商品")]):e._e(),"跨地商品管理员"==e.$store.getters.role.name||"超级管理员"==e.$store.getters.role.name?t("a-radio-button",{attrs:{value:"physical"}},[e._v("跨地商品")]):e._e(),"旅游线路管理员"==e.$store.getters.role.name||"超级管理员"==e.$store.getters.role.name?t("a-radio-button",{attrs:{value:"travel"}},[e._v("旅游线路")]):e._e(),"旅游线路管理员"==e.$store.getters.role.name||"超级管理员"==e.$store.getters.role.name?t("a-radio-button",{attrs:{value:"verification"}},[e._v("核销卡券")]):e._e(),"跨地商品管理员"==e.$store.getters.role.name||"超级管理员"==e.$store.getters.role.name?t("a-radio-button",{attrs:{value:"virtual"}},[e._v("线下交易")]):e._e()],1)],1),t("div",{staticClass:"tab-list fl-l"},[t("a-radio-group",{attrs:{defaultValue:e.queryParam.listType},on:{change:e.handleStatus}},[t("a-radio-button",{attrs:{value:"all"}},[e._v("全部")]),t("a-radio-button",{attrs:{value:"on_sale"}},[e._v("出售中")]),t("a-radio-button",{attrs:{value:"off_sale"}},[e._v("已下架")]),t("a-radio-button",{attrs:{value:"sold_out"}},[e._v("已售罄")])],1)],1),e.$auth("products.intra-city.skus.create")&&"intra-city"==e.queryParam.type?t("a-button",{staticClass:"fl-l",attrs:{type:"primary",icon:"plus"},on:{click:e.handleAdd}},[e._v("添加商品")]):t("div",[t("a-button",{staticClass:"fl-l",attrs:{type:"primary",icon:"plus"},on:{click:e.handleCreate}},[e._v(e._s("travel"==e.queryParam.type?"新增线路":"新增商品"))]),t("a-tooltip",{attrs:{placement:"right"}},[t("template",{slot:"title"},[t("span",[e._v("非同城商品默认不会展示，需要在[页面设计]中配置对应展示的商品类型")])]),t("a-button",{attrs:{type:"dashed",shape:"circle",icon:"info"}})],2)],1),e.selectedRowKeys.length?t("div",{staticClass:"button-group"},[t("a-button-group",{staticClass:"ml-10"},[t("a-button",{attrs:{icon:"arrow-up"},on:{click:function(t){return e.handleUpdateStatus(e.selectedRowKeys,!0)}}},[e._v("上架")]),t("a-button",{attrs:{icon:"arrow-down"},on:{click:function(t){return e.handleUpdateStatus(e.selectedRowKeys,!1)}}},[e._v("下架")]),t("a-button",{directives:[{name:"action",rawName:"v-action:products.*.delete",arg:"products",modifiers:{"*":!0,delete:!0}}],attrs:{icon:"delete"},on:{click:function(t){return e.handleDelete(e.selectedRowKeys)}}},[e._v("删除")])],1)],1):e._e()],1)],1),t("s-table",{ref:"table",attrs:{rowKey:"id",loading:e.isLoading,columns:e.columns,data:e.loadData,rowSelection:e.rowSelection,pageSize:15},scopedSlots:e._u([{key:"image",fn:function(e){return t("span",{},[t("a",{attrs:{title:"点击查看原图",href:e,target:"_blank"}},[t("img",{attrs:{width:"50",height:"50",src:e,alt:"商品图片"}})])])}},{key:"goods_title",fn:function(a){return t("span",{},[t("p",{staticClass:"twoline-hide",staticStyle:{width:"270px"}},[e._v(e._s(a))])])}},{key:"on_sale",fn:function(a,r){return t("span",{},[t("a-tag",{staticClass:"cur-p",attrs:{color:a?"green":"red"},on:{click:function(t){return e.handleUpdateStatus([r.id],!a)}}},[e._v(e._s(a?"在售":"下架"))])],1)}},{key:"action",fn:function(a,r){return t("div",{staticClass:"actions"},[e.$auth("products.*.update")?t("a",{on:{click:function(t){return e.handleEdit(r)}}},[e._v("编辑")]):e._e(),e.$auth("products.*.delete")?t("a",{on:{click:function(t){return e.handleDelete([r.id])}}},[e._v("删除")]):e._e(),t("a-popover",{attrs:{trigger:"hover"},on:{visibleChange:function(t){t&&e.showQRCode(r)}},scopedSlots:e._u([{key:"title",fn:function(){return[t("a-typography-text",{staticStyle:{width:"120px"},attrs:{code:"",ellipsis:""}},[e._v("pages/goods/goods?id="+e._s(r.id))])]},proxy:!0},{key:"content",fn:function(){return[e.QRcode[r.id]&&"loading"==e.QRcode[r.id]?t("a-spin"):e.QRcode[r.id]?t("img",{staticStyle:{margin:"auto",display:"block"},attrs:{src:e.QRcode[r.id],width:"100",height:"100"}}):e._e()]},proxy:!0}],null,!0)},[t("a",[e._v("链接")])])],1)}}])}),t("a-drawer",{attrs:{title:"从主仓库添加商品",placement:"right",closable:!1,visible:e.visibleGoodsPicker,width:640}},[e.showPickerList?[t("div",{staticClass:"table-operator"},[t("a-row",{staticClass:"row-item-search"},[t("a-form",{staticClass:"search-form",attrs:{layout:"inline"}},[t("a-form-item",{attrs:{label:"商品分类"}},[t("a-tree-select",{attrs:{treeData:e.categoryListTree,defaultValue:"0",dropdownStyle:{maxHeight:"500px",overflow:"auto"},allowClear:""},on:{change:function(t){return e.searchGoodsPicker(e.pickerParams.search)}},model:{value:e.pickerParams.category_ids,callback:function(t){e.$set(e.pickerParams,"category_ids",t)},expression:"pickerParams.category_ids"}})],1),t("a-input-search",{staticStyle:{"max-width":"250px","min-width":"150px"},attrs:{placeholder:"搜索商品名称"},on:{search:e.searchGoodsPicker},model:{value:e.pickerParams.search,callback:function(t){e.$set(e.pickerParams,"search",t)},expression:"pickerParams.search"}})],1)],1)],1),t("s-table",{ref:"goodsPickerTable",attrs:{rowKey:"id",loading:e.isLoading,columns:e.columnsGoodsPicker,data:e.loadGoodsPickerData,rowSelection:{selectedRowKeys:e.selectedRowKeysPicker,onChange:function(t){return e.selectedRowKeysPicker=t}},pageSize:16},scopedSlots:e._u([{key:"image",fn:function(e){return t("span",{},[t("a",{attrs:{title:"点击查看原图",href:e,target:"_blank"}},[t("img",{attrs:{width:"50",height:"50",src:e,alt:"商品图片"}})])])}},{key:"goods_title",fn:function(a){return t("span",{},[t("p",{staticClass:"twoline-hide",staticStyle:{width:"270px"}},[e._v(e._s(a))])])}}],null,!1,1893465979)})]:[t("div",{staticStyle:{height:"400px",display:"flex","flex-direction":"column","align-items":"center","justify-content":"center"}},[t("a-input-search",{attrs:{placeholder:"搜索商品名称",size:"large"},on:{search:e.searchGoodsPicker}})],1)],t("div",{style:{position:"absolute",right:0,bottom:0,width:"100%",borderTop:"1px solid #e9e9e9",padding:"10px 16px",background:"#fff",textAlign:"right",zIndex:1}},[t("a-button",{staticStyle:{float:"left"},attrs:{type:"primary"},on:{click:e.handleCreate}},[e._v("创建新商品")]),t("a-button",{style:{marginRight:"8px"},on:{click:function(t){e.visibleGoodsPicker=!1}}},[e._v("取消")]),t("a-button",{attrs:{type:"primary",loading:e.isSavingPicking},on:{click:e.submitGoodspicker}},[e._v("添加")])],1)],2)],1)},i=[],o=a(69870),s=a(17654),l=a(57888),n=a(5893),d=a(11895),c=a(21550),u=a(90667),m=[{title:"商品ID",dataIndex:"id"},{title:"商品图片",dataIndex:"image",scopedSlots:{customRender:"image"}},{title:"商品名称",dataIndex:"title",scopedSlots:{customRender:"goods_title"}},{title:"最低价格",dataIndex:"price_lowest"},{title:"总销量",dataIndex:"sold_count"},{title:"仓储库存",dataIndex:"stock"},{title:"库存总量",dataIndex:"stock_total"},{title:"状态",dataIndex:"on_sale",scopedSlots:{customRender:"on_sale"}},{title:"添加时间",dataIndex:"created_at"},{title:"操作",dataIndex:"action",width:"180px",scopedSlots:{customRender:"action"}}],p={name:"Index",components:{ContentHeader:c.dv,STable:c.Wd},data:function(){var e=this;return{searchForm:this.$form.createForm(this),categoryListTree:[],queryParam:{type:"intra-city",listType:"all"},tabParams:{},isLoading:!1,columns:m,selectedRowKeys:[],loadData:function(t){return n.p_((0,l.A)((0,l.A)((0,l.A)((0,l.A)({},t),e.queryParam),e.tabParams),{store_id:e.$store.getters.storeId})).then((function(e){return e}))},visibleGoodsPicker:!1,showPickerList:!1,isSavingPicking:!1,selectedRowKeysPicker:[],pickerParams:{type:"intra-city"},columnsGoodsPicker:m.filter((function(e){return/^(id|image|title|price_lowest|created_at)$/.test(e.dataIndex)})),loadGoodsPickerData:function(t){return n.p_((0,l.A)((0,l.A)((0,l.A)({},t),e.pickerParams),{except_store_id:e.$store.getters.storeId})).then((function(e){return e}))},QRcode:{}}},watch:{"queryParam.listType":{immediate:!0,handler:function(e){"on_sale"==this.queryParam.listType?this.tabParams={on_sale:!0}:"off_sale"==this.queryParam.listType?this.tabParams={on_sale:!1}:"sold_out"==this.queryParam.listType?this.tabParams={stock:0}:this.tabParams={},this.handleRefresh(!0)}}},created:function(){this.$route.query.listType&&(this.queryParam.listType=this.$route.query.listType),this.getCategoryList()},computed:{rowSelection:function(){return{selectedRowKeys:this.selectedRowKeys,onChange:this.onSelectChange}}},methods:{onSelectChange:function(e){this.selectedRowKeys=e},handleType:function(e){this.queryParam.types=[e.target.value],this.handleRefresh(!0)},handleStatus:function(e){this.queryParam.listType=e.target.value},handleSearch:function(e){var t=this;e.preventDefault(),this.searchForm.validateFields((function(e,a){e||(t.queryParam=(0,l.A)((0,l.A)({},t.queryParam),a),t.handleRefresh(!0))}))},handleReset:function(){this.searchForm.resetFields()},getCategoryList:function(){var e=this;this.isLoading=!0,u.A.getListFromScreen().then((function(t){e.categoryListTree=t})).finally((function(t){e.isLoading=!1}))},handleUpdateStatus:function(e){var t=this,a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.$auth("products.*.update"))return!1;this.isLoading=!0,n.wk({goodsIds:e,state:a}).then((function(e){t.$message.success(e.message,1.5),t.handleRefresh()})).finally((function(e){t.isLoading=!1}))},handleDelete:function(e){var t=this,a=this.$confirm({title:"您确定要删除该记录吗?",content:"删除后不可恢复",onOk:function(){var r="intra-city"==t.queryParam.type?n.ED({product_ids:e,store_id:t.$store.getters.storeId}):n.KF({ids:e});return r.then((function(e){t.$message.success(e.message,1.5),t.handleRefresh()})).finally((function(e){a.destroy()}))}})},handleAdd:function(){this.visibleGoodsPicker=!0},handleCreate:function(){this.$router.push("/goods/create")},handleEdit:function(e){this.$router.push({path:"/goods/update",query:{goodsId:e.id}})},handleRefresh:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.selectedRowKeys=[],null===(e=this.$refs.table)||void 0===e||e.refresh(t)},handleSearchGoodsPicker:function(e){var t=this;e.preventDefault(),this.pickerSearchForm.validateFields((function(e,a){e||(t.pickerParams=(0,l.A)((0,l.A)({},t.pickerParams),a),t.selectedRowKeysPicker=[],t.$refs.goodsPickerTable.refresh(!0))}))},searchGoodsPicker:function(e){var t;this.showPickerList=!0,this.pickerParams.search=e,this.pickerParams=(0,l.A)({},this.pickerParams),null===(t=this.$refs.goodsPickerTable)||void 0===t||t.refresh(!0)},submitGoodspicker:function(){var e=this;this.isSavingPicking=!0,n.xG({product_ids:this.selectedRowKeysPicker,store_id:this.$store.getters.storeId}).then((function(t){e.$message.success("已添加选中商品到本仓储",1.5),e.visibleGoodsPicker=!1,e.handleRefresh(!0)})).finally((function(t){e.isSavingPicking=!1}))},showQRCode:function(e){var t=this;return(0,s.A)((0,o.A)().mark((function a(){var r;return(0,o.A)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!t.QRcode[e.id]){a.next=2;break}return a.abrupt("return");case 2:return t.QRcode[e.id]="loading",t.QRcode=(0,l.A)({},t.QRcode),a.next=6,d.t("pages/goods/goods?id="+e.id);case 6:r=a.sent,t.QRcode=(0,l.A)({},t.QRcode),t.QRcode[e.id]=r.base64;case 9:case"end":return a.stop()}}),a)})))()}}},v=p,f=a(81656),h=(0,f.A)(v,r,i,!1,null,"7b2835e7",null),g=h.exports},44130:function(e,t,a){a.r(t),a.d(t,{default:function(){return D}});var r=function(){var e=this,t=e._self._c;return t("a-card",{attrs:{bordered:!1}},[t("div",{staticClass:"card-title"},[e._v(e._s(e.$route.meta.title))]),t("a-spin",{attrs:{spinning:e.isLoading}},[t("a-form",{attrs:{form:e.form,selfUpdate:!0},on:{submit:e.handleSubmit}},[t("a-tabs",{attrs:{activeKey:e.tabKey,tabBarStyle:{marginBottom:"30px"}},on:{change:e.handleTabs}},[t("a-tab-pane",{key:0,attrs:{tab:"基本信息"}}),t("a-tab-pane",{key:1,attrs:{tab:"规格/库存"}}),t("a-tab-pane",{key:4,attrs:{tab:"定时调价"}}),t("a-tab-pane",{key:2,attrs:{tab:"商品详情"}}),t("a-tab-pane",{key:3,attrs:{tab:"更多设置"}})],1),t("div",{staticClass:"tabs-content"},[t("div",{directives:[{name:"show",rawName:"v-show",value:0==e.tabKey,expression:"tabKey == 0"}],staticClass:"tab-pane"},[t("a-form-item",{attrs:{label:"商品名称",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["title",{rules:[{required:!0,min:2,message:"请输入至少2个字符"}]}],expression:"['title', { rules: [{ required: true, min: 2, message: '请输入至少2个字符' }] }]"}],attrs:{placeholder:"请输入商品名称"}})],1),t("a-form-item",{attrs:{label:"商品类型",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["type",{initialValue:e.$store.getters.storeId?"intra-city":"physical",rules:[{required:!0}]}],expression:"['type', {initialValue: $store.getters.storeId ? 'intra-city' : 'physical', rules: [{required: true}]}]"}]},[t("a-radio",{attrs:{value:"intra-city"}},[e._v("同城商品")]),t("a-radio",{attrs:{value:"physical"}},[e._v("跨地商品")]),t("a-radio",{attrs:{value:"travel"}},[e._v("旅游线路")]),t("a-radio",{attrs:{value:"verification"}},[e._v("核销卡券")]),t("a-radio",{attrs:{value:"virtual"}},[e._v("线下交易")])],1)],1),t("a-form-item",{attrs:{label:"商品分类",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-tree-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["categorys",{rules:[{required:!0,message:"请至少选择1个商品分类"}]}],expression:"['categorys', { rules: [{required: true, message: '请至少选择1个商品分类'}]}]"}],attrs:{placeholder:"请选择商品分类",dropdownStyle:{maxHeight:"500px",overflow:"auto"},treeData:e.formData.categoryList,treeCheckable:"",treeCheckStrictly:"",allowClear:""}}),t("div",{staticClass:"form-item-help"},[t("router-link",{attrs:{target:"_blank",to:{path:"/goods/category/index"}}},[e._v("去新增")]),t("a",{attrs:{href:"javascript:;"},on:{click:e.onReloadCategoryList}},[e._v("刷新")])],1)],1),t("a-form-item",{attrs:{label:"商品图片",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"建议尺寸：750*750像素, 最多上传10张, 可拖拽图片调整顺序, 第1张将作为商品首图"}},[t("SelectImage",{directives:[{name:"decorator",rawName:"v-decorator",value:["image_ids",{rules:[{required:!0,message:"请至少上传1张商品图片"}]}],expression:"['image_ids', { rules: [{ required: true, message: '请至少上传1张商品图片' }] }]"}],attrs:{channel:e.channel,channel_id:e.goodsId,collection:"product_images",multiple:"",maxNum:10,defaultList:e.formData.goods.images||[]}})],1),t("a-form-item",{attrs:{label:"商品编码",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["no"],expression:"['no']"}],attrs:{placeholder:"请输入商品编码"}})],1),t("a-form-item",{attrs:{label:"运费模板",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["delivery_id",{rules:[{required:!1,message:"请选择运费模板"}]}],expression:"['delivery_id', {rules: [{required: false, message: '请选择运费模板'}]}]"}],staticStyle:{width:"300px"},attrs:{placeholder:"请选择运费模板"}},e._l(e.formData.deliveryList,(function(a,r){return t("a-select-option",{key:r,attrs:{value:a.delivery_id}},[e._v(e._s(a.name))])})),1),t("div",{staticClass:"form-item-help"},[t("router-link",{attrs:{target:"_blank",to:{path:"/setting/delivery/template/create"}}},[e._v("新增模板")]),t("a",{attrs:{href:"javascript:;"},on:{click:e.onReloadDeliveryList}},[e._v("刷新")])],1)],1),t("a-form-item",{attrs:{label:"配送所需",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["delivery_taking",{initialValue:""}],expression:"['delivery_taking', {initialValue: ''}]"}],on:{change:function(t){return e.onForceUpdate()}}},[t("a-radio",{attrs:{value:""}},[e._v("半小时内")]),t("a-radio",{attrs:{value:"hours"}},[e._v("小时数")]),t("a-radio",{attrs:{value:"days"}},[e._v("天数")])],1),t("InputNumberGroup",{directives:[{name:"show",rawName:"v-show",value:"hours"==e.form.getFieldValue("delivery_taking"),expression:"form.getFieldValue('delivery_taking') == 'hours'"},{name:"decorator",rawName:"v-decorator",value:["delivery_hours_taking",{initialValue:1}],expression:"['delivery_hours_taking', {initialValue: 1}]"}],attrs:{addonBefore:"下单",addonAfter:"天后配送",inputProps:{min:1,precision:0}}}),t("InputNumberGroup",{directives:[{name:"show",rawName:"v-show",value:"days"==e.form.getFieldValue("delivery_taking"),expression:"form.getFieldValue('delivery_taking') == 'days'"},{name:"decorator",rawName:"v-decorator",value:["delivery_days_taking",{initialValue:3}],expression:"['delivery_days_taking', {initialValue: 3}]"}],attrs:{addonBefore:"下单",addonAfter:"小时后配送",inputProps:{min:1,precision:0}}})],1),t("a-form-item",{attrs:{label:"最晚配送",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"超过最晚配送时间后，商品自动下架"}},[t("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["delivery_latest"],expression:"['delivery_latest']"}],attrs:{"show-time":{defaultValue:e.endOfToday},valueFormat:"YYYY-MM-DD HH:mm:ss"}})],1),t("a-form-item",{attrs:{label:"商品状态",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["on_sale",{initialValue:!0,rules:[{required:!0}]}],expression:"['on_sale', {initialValue: true, rules: [{ required: true }]}]"}]},[t("a-radio",{attrs:{value:!0}},[e._v("上架")]),t("a-radio",{attrs:{value:!1}},[e._v("下架")])],1)],1)],1),t("div",{directives:[{name:"show",rawName:"v-show",value:1==e.tabKey,expression:"tabKey == 1"}],staticClass:"tab-pane"},[t("a-form-item",{attrs:{label:"规格类型",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["spec_type",{initialValue:10,rules:[{required:!0}]}],expression:"['spec_type', {initialValue: 10, rules: [{ required: true }]}]"}],on:{change:function(t){return e.onForceUpdate()}}},[t("a-radio",{attrs:{value:10}},[e._v("单规格")]),t("a-radio",{attrs:{value:20}},[e._v("多规格")])],1)],1),t("div",{directives:[{name:"show",rawName:"v-show",value:20==e.form.getFieldValue("spec_type"),expression:"form.getFieldValue('spec_type') == 20"}]},[t("MultiSpec",{ref:"MultiSpec",attrs:{goodsId:e.goodsId,defaultSpecList:e.formData.specs,defaultSkuList:e.formData.skus}})],1),t("div",{directives:[{name:"show",rawName:"v-show",value:10==e.form.getFieldValue("spec_type"),expression:"form.getFieldValue('spec_type') == 10"}]},[t("a-form-item",{attrs:{label:"商品价格",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"商品的实际购买金额，最低0.01"}},[t("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["price",{rules:[{required:!0,message:"请输入商品价格"}]}],expression:"['price', { rules:[{ required: true, message: '请输入商品价格' }] }]"}],attrs:{min:.01,precision:2}}),t("span",{staticClass:"ml-10"},[e._v("元")])],1),t("a-form-item",{attrs:{label:"零售价",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"零售价仅用于商品页展示"}},[t("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["retail_price"],expression:"['retail_price']"}],attrs:{min:0,precision:2}}),t("span",{staticClass:"ml-10"},[e._v("元")])],1),t("a-form-item",{attrs:{label:"永辉价",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"永辉价仅用于商品页展示"}},[t("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["yh_price"],expression:"['yh_price']"}],attrs:{min:0,precision:2}}),t("span",{staticClass:"ml-10"},[e._v("元")])],1),t("a-form-item",{attrs:{label:"成本价",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"成本价仅用于计算盈亏"}},[t("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["cost_price"],expression:"['cost_price']"}],attrs:{min:0,precision:2}}),t("span",{staticClass:"ml-10"},[e._v("元")])],1),t("a-form-item",{attrs:{label:"当前库存数量",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"商品的实际库存数量，为0时用户无法下单"}},[t("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["stock",{initialValue:100,rules:[{required:!0,message:"请输入库存数量"}]}],expression:"['stock', { initialValue: 100, rules:[{ required: true, message: '请输入库存数量' }] }]"}],attrs:{min:0,precision:0}}),t("span",{staticClass:"ml-10"},[e._v("件")])],1),t("a-form-item",{attrs:{label:"商品重量",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"商品的实际重量，用于计算运费"}},[t("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["weight",{initialValue:0,rules:[{required:!1,message:"请输入库存数量"}]}],expression:"['weight', { initialValue: 0, rules:[{ required: false, message: '请输入库存数量' }] }]"}],attrs:{min:0}}),t("span",{staticClass:"ml-10"},[e._v("克 (g)")])],1)],1),t("a-form-item",{attrs:{label:"库存计算方式",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["deduct_stock_type",{initialValue:10,rules:[{required:!0}]}],expression:"['deduct_stock_type', {initialValue: 10, rules: [{ required: true }]}]"}]},[t("a-radio",{attrs:{value:10}},[e._v("下单减库存")]),t("a-radio",{attrs:{value:20}},[e._v("付款减库存")])],1)],1)],1),t("div",{directives:[{name:"show",rawName:"v-show",value:4==e.tabKey,expression:"tabKey == 4"}],staticClass:"tab-pane"},[t("PriceSchedule",{attrs:{goodsId:e.goodsId,skus:e.formData.skus}})],1),t("div",{directives:[{name:"show",rawName:"v-show",value:2==e.tabKey,expression:"tabKey == 2"}],staticClass:"tab-pane"},[t("a-form-item",{attrs:{label:"商品详情",labelCol:e.labelCol,wrapperCol:{span:16}}},[t("Ueditor",{directives:[{name:"decorator",rawName:"v-decorator",value:["description",{rules:[{required:!0,message:"商品详情不能为空"}]}],expression:"['description', {rules: [{required: true, message: '商品详情不能为空'}]}]"}],attrs:{channel:e.channel,channel_id:e.goodsId,collection:"desc_images"}})],1)],1),t("div",{directives:[{name:"show",rawName:"v-show",value:3==e.tabKey,expression:"tabKey == 3"}],staticClass:"tab-pane"},[t("a-form-item",{attrs:{label:"主图视频",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"建议视频宽高比19:9，建议时长8-45秒"}},[t("SelectVideo",{directives:[{name:"decorator",rawName:"v-decorator",value:["video_id"],expression:"['video_id']"}],attrs:{channel:e.channel,channel_id:e.goodsId,collection:"product_video",multiple:!1,defaultList:e.formData.goods.video?[e.formData.goods.video]:[]}})],1),t("a-form-item",{attrs:{label:"视频封面",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"建议尺寸：750像素*750像素"}},[t("SelectImage",{directives:[{name:"decorator",rawName:"v-decorator",value:["video_cover_id"],expression:"['video_cover_id']"}],attrs:{channel:e.channel,channel_id:e.goodsId,collection:"video_cover",multiple:!1,defaultList:e.formData.goods.video_cover?[e.formData.goods.video_cover]:[]}})],1),t("a-form-item",{attrs:{label:"商品卖点",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"一句话简述，例如：此款商品美观大方 性价比较高 不容错过"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["highlight"],expression:"['highlight']"}],attrs:{placeholder:"请输入商品卖点"}})],1),t("a-form-item",{attrs:{label:"服务与承诺",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[e.formData.serviceList?t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["serviceIds"],expression:"['serviceIds']"}],attrs:{mode:"multiple",placeholder:"请选择服务与承诺"}},e._l(e.formData.serviceList,(function(a,r){return t("a-select-option",{key:r,attrs:{value:a.service_id}},[e._v(e._s(a.name))])})),1):e._e(),t("div",{staticClass:"form-item-help"},[t("router-link",{attrs:{target:"_blank",to:{path:"/goods/service/index"}}},[e._v("去新增")]),t("a",{attrs:{href:"javascript:;"},on:{click:e.onReloadServiceList}},[e._v("刷新")])],1)],1),t("a-form-item",{attrs:{label:"初始销量",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"用户端展示的销量 = 初始销量 + 实际销量"}},[t("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["sold_inital",{initialValue:0}],expression:"['sold_inital', {initialValue: 0}]"}]})],1),t("a-divider",{attrs:{orientation:"left"}},[e._v("积分设置")]),t("a-form-item",{attrs:{label:"积分赠送",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"开启后用户购买此商品将获得积分"}},[t("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["is_points_gift",{initialValue:1,rules:[{required:!0}]}],expression:"['is_points_gift', {initialValue: 1, rules: [{ required: true }]}]"}]},[t("a-radio",{attrs:{value:1}},[e._v("开启")]),t("a-radio",{attrs:{value:0}},[e._v("关闭")])],1)],1),t("a-form-item",{attrs:{label:"积分抵扣",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"开启后用户购买此商品可以使用积分进行抵扣"}},[t("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["is_points_discount",{initialValue:1,rules:[{required:!0}]}],expression:"['is_points_discount', {initialValue: 1, rules: [{ required: true }]}]"}]},[t("a-radio",{attrs:{value:1}},[e._v("开启")]),t("a-radio",{attrs:{value:0}},[e._v("关闭")])],1)],1),t("a-divider",{attrs:{orientation:"left"}},[e._v("会员折扣设置")]),t("a-form-item",{attrs:{label:"会员折扣",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"开启后会员折扣，会员购买此商品可以享受会员等级折扣价"}},[t("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["is_enable_grade",{initialValue:1,rules:[{required:!0}]}],expression:"['is_enable_grade', {initialValue: 1, rules: [{ required: true }]}]"}],on:{change:function(t){return e.onForceUpdate(!0)}}},[t("a-radio",{attrs:{value:1}},[e._v("开启")]),t("a-radio",{attrs:{value:0}},[e._v("关闭")])],1)],1),t("a-form-item",{directives:[{name:"show",rawName:"v-show",value:e.form.getFieldValue("is_enable_grade"),expression:"form.getFieldValue('is_enable_grade')"}],attrs:{label:"会员折扣设置",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["is_alone_grade",{initialValue:0,rules:[{required:!0}]}],expression:"['is_alone_grade', {initialValue: 0, rules: [{ required: true }]}]"}],on:{change:function(t){return e.onForceUpdate(!0)}}},[t("a-radio",{attrs:{value:0}},[e._v("默认等级折扣")]),t("a-radio",{attrs:{value:1}},[e._v("单独设置折扣")])],1),t("div",{directives:[{name:"show",rawName:"v-show",value:e.form.getFieldValue("is_alone_grade"),expression:"form.getFieldValue('is_alone_grade')"}]},e._l(e.formData.userGradeList,(function(a){return t("a-form-item",{key:a.grade_id},[t("InputNumberGroup",{directives:[{name:"decorator",rawName:"v-decorator",value:["alone_grade_equity[grade_id:".concat(a.grade_id,"]"),{initialValue:e.formData.defaultUserGradeValue[a.grade_id],rules:[{required:!0,message:"折扣率不能为空"}]}],expression:"[`alone_grade_equity[grade_id:${item.grade_id}]`, {\n                    initialValue: formData.defaultUserGradeValue[item.grade_id], rules: [{required: true, message: '折扣率不能为空'}]\n                  }]"}],attrs:{addonBefore:a.name,addonAfter:"折",inputProps:{min:0,max:9.9}}})],1)})),1),t("div",{staticClass:"form-item-help"},[e.form.getFieldValue("is_alone_grade")?t("p",{staticClass:"extra"},[e._v("单独折扣：折扣率范围0.0-9.9，例如: 9.8代表98折，0代表不折扣")]):t("p",{staticClass:"extra"},[e._v("默认折扣：默认为用户所属会员等级的折扣率")])])],1)],1)]),t("a-form-item",{staticClass:"mt-20",attrs:{"wrapper-col":{span:e.wrapperCol.span,offset:e.labelCol.span}}},[t("a-button",{attrs:{type:"primary","html-type":"submit",loading:e.isBtnLoading}},[e._v("提交")])],1)],1)],1)],1)},i=[],o=a(5893),s=(a(63237),a(75860),a(21550)),l=a(78834),n=a(65829),d=a(61145),c=a(81269),u=function(){var e=this,t=e._self._c;return t("a-card",{attrs:{bordered:!1}},[t("div",{staticClass:"table-operator"},[t("a-row",[t("a-col",{attrs:{span:5}},[t("a-button",{directives:[{name:"action",rawName:"v-action:create",arg:"create"}],attrs:{type:"default",icon:"plus"},on:{click:e.handleAdd}},[e._v("新增")])],1)],1)],1),t("s-table",{ref:"table",attrs:{rowKey:"id",loading:e.isLoading,columns:e.columns,data:e.loadData,showPagination:!1},scopedSlots:e._u([{key:"frequence",fn:function(a,r){return t("span",{},[a?t("p",{staticClass:"twoline-hide"},[e._v("每 "+e._s(a)+" "+e._s(r.repeat))]):t("p",[e._v("执行一次")])])}},{key:"status",fn:function(a,r){return t("span",{},[!a&&new Date(r.adjust_at)<new Date?t("a-tag",{attrs:{color:"red"}},[e._v("执行失败")]):a?r.every?t("a-tag",{attrs:{color:"blue"}},[e._v("已执行"+e._s(r.logs?r.logs.length:"n")+"次")]):t("a-tag",{attrs:{color:"green"}},[e._v("已调价")]):t("a-tag",[e._v("待执行")])],1)}},{key:"turn_back",fn:function(a,r){return t("span",{},[a?!a.done_at&&new Date(a.adjust_at)<new Date?t("a-tag",{attrs:{color:"red"}},[e._v("回改失败")]):a.done_at?a.every&&r.product_sku.price!=a.target_price?t("a-tag",{attrs:{color:"blue"}},[e._v("待回改")]):t("a-tag",{attrs:{color:"green"}},[e._v("已回改")]):t("a-tag",[e._v("待回改")]):t("a-tag",[e._v("否")])],1)}},{key:"action",fn:function(a,r){return t("span",{},[t("a",{directives:[{name:"action",rawName:"v-action:update",arg:"update"}],staticStyle:{"margin-right":"8px"},on:{click:function(t){return e.handleEdit(r)}}},[e._v("编辑")]),t("a",{directives:[{name:"action",rawName:"v-action:delete",arg:"delete"}],on:{click:function(t){return e.handleDelete(r)}}},[e._v("删除")])])}}])}),t("PriceScheduleEdit",{ref:"EditForm",attrs:{goodsId:e.goodsId,goodsSkus:e.storeSkus},on:{handleSubmit:e.handleRefresh}})],1)},m=[],p=a(21092),v=a(57888),f=a(16270),h=a(34189),g={name:"PriceSchedule",components:{STable:s.Wd,SelectRegion:s.$p,PriceScheduleEdit:h.A},props:{goodsId:null,skus:f.A.array.def([])},data:function(){var e=this;return{queryParam:{with_turn_back:!0},cascader:[],isLoading:!1,columns:[{title:"规格名称",dataIndex:"product_sku.name"},{title:"当前价格",dataIndex:"product_sku.price"},{title:"即将调价",dataIndex:"target_price"},{title:"调价时间",dataIndex:"adjust_at"},{title:"执行频率",dataIndex:"every",scopedSlots:{customRender:"frequence"}},{title:"执行状态",dataIndex:"done_at",scopedSlots:{customRender:"status"}},{title:"价格回改",dataIndex:"turn_back",scopedSlots:{customRender:"turn_back"}},{title:"操作",dataIndex:"action",width:"180px",scopedSlots:{customRender:"action"}}],loadData:function(t){return o.Fb(e.goodsId,(0,v.A)((0,v.A)((0,v.A)({},t),e.queryParam),{},{store_id:e.$store.getters.storeId})).then((function(e){return{data:e}}))}}},computed:{storeSkus:function(){var e=this;return this.$store.getters.storeId?this.skus.filter((function(t){return t.store_id==e.$store.getters.storeId})):this.skus}},methods:{handleAdd:function(){this.$refs.EditForm.create()},handleEdit:function(e){this.$refs.EditForm.edit(e)},handleDelete:function(e){var t=this,a=this.$confirm({title:"您确定要删除该记录吗?",content:"删除后不可恢复",onOk:function(){return o.Kv(t.goodsId,e.id).then((function(e){t.$message.success("已删除",1.5),t.handleRefresh()})).finally((function(e){a.destroy()}))}})},handleRefresh:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.$refs.table.refresh(e)},onSearch:function(){this.handleRefresh(!0)},onCascaderChange:function(e){var t=(0,p.A)(e,3),a=t[0],r=t[1],i=t[2];this.queryParam=(0,v.A)((0,v.A)({},this.queryParam),{},{province:a,city:r,district:i}),this.handleRefresh(!0)}}},_=g,b=a(81656),y=(0,b.A)(_,u,m,!1,null,null,null),C=y.exports,w=a(95093),k=a.n(w),x={components:{SelectImage:s._7,SelectVideo:s.Ke,Ueditor:s.nv,InputNumberGroup:s.tE,MultiSpec:n.A,PriceSchedule:C},data:function(){return{tabKey:0,labelCol:{span:3},wrapperCol:{span:10},isLoading:!1,isBtnLoading:!1,form:this.$form.createForm(this),goodsId:null,channel:c.A.PRODUCT.value,formData:l.A.formData,endOfToday:k()("23:59:59","HH:mm:ss")}},created:function(){this.initData()},beforeDestroy:function(){l.A.formData.goods={},l.A.formData.goodsCategories=[],l.A.formData.skus=[],l.A.formData.specs=[]},methods:{initData:function(){var e=this;this.goodsId=parseInt(this.$route.query.goodsId),this.isLoading=!0,l.A.getFormData(this.goodsId).then((function(){(0,d.RI)(e.form.getFieldsValue())||e.form.setFieldsValue(l.A.getFieldsValue()),e.isLoading=!1}))},onForceUpdate:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.$forceUpdate(),t&&setTimeout((function(){e.$forceUpdate()}),10)},handleTabs:function(e){this.tabKey=e},onReloadCategoryList:function(){var e=this;this.isLoading=!0,l.A.getCategoryList().then((function(){e.isLoading=!1}))},onReloadServiceList:function(){var e=this;this.isLoading=!0,l.A.getServiceList().then((function(){e.isLoading=!1}))},onReloadDeliveryList:function(){var e=this;this.isLoading=!0,l.A.getDeliveryList().then((function(){e.isLoading=!1}))},handleSubmit:function(e){var t=this;e.preventDefault();var a=this.form.validateFields;a((function(e,a){var r;if(e)return t.onTargetTabError(e),!1;if(20===a.spec_type){var i=t.$refs.MultiSpec;if(!i.verifyForm())return t.tabKey=1,!1;a.specData=i.getFormSpecData(),delete a.price,delete a.stock}return a.category_ids=a.categorys.map((function(e){return e.value})),delete a.categorys,a.store_id=t.$store.getters.storeId,a.image_ids=null===(r=a.image_ids)||void 0===r?void 0:r.filter((function(e){return e})),"days"!=a.delivery_taking&&(a.delivery_days_taking=null),"hours"!=a.delivery_taking&&(a.delivery_hours_taking=null),t.onFormSubmit(a),!0}))},onTargetTabError:function(e){var t=[["title","categorys","image_ids"],["price"],["description"],["alone_grade_equity","first_money","second_money","third_money"]],a=Object.keys(e).shift();for(var r in t)if(t[r].indexOf(a)>-1){this.tabKey=parseInt(r);break}},onFormSubmit:function(e){var t=this;this.isLoading=!0,this.isBtnLoading=!0,Promise.all([e.specData?o.jF(this.goodsId,e.specData.skuList):null]).then((function(){o.hc(t.goodsId,e).then((function(e){t.$message.success("商品已更新！",1.5),setTimeout((function(){t.$router.push("./index")}),1500)})).catch((function(){t.isBtnLoading=!1})).finally((function(){t.isLoading=!1}))}))}}},S=x,L=(0,b.A)(S,r,i,!1,null,"4d389492",null),D=L.exports},4146:function(e,t,a){a.r(t),a.d(t,{default:function(){return D}});var r=function(){var e=this,t=e._self._c;return t("a-card",{attrs:{bordered:!1}},[t("div",{staticClass:"card-title"},[e._v(e._s(e.$route.meta.title))]),t("div",{staticClass:"table-operator"},[t("a-button",{directives:[{name:"action",rawName:"v-action:create",arg:"create"}],attrs:{type:"primary",icon:"plus"},on:{click:e.handleAdd}},[e._v("新增")])],1),e.isLoading?e._e():t("a-table",{attrs:{rowKey:"id",columns:e.columns,dataSource:e.categoryList,defaultExpandAllRows:!0,expandIconColumnIndex:1,pagination:!1,loading:e.isLoading},scopedSlots:e._u([{key:"image",fn:function(a){return t("span",{},[a?t("img",{attrs:{src:a.preview_url,width:"30",height:"30"}}):e._e()])}},{key:"status",fn:function(a){return t("span",{},[t("a-tag",{attrs:{color:a?"green":""}},[e._v(e._s(a?"显示":"隐藏"))])],1)}},{key:"action",fn:function(a,r){return t("span",{},[t("a",{directives:[{name:"action",rawName:"v-action:update",arg:"update"}],staticStyle:{"margin-right":"8px"},on:{click:function(t){return e.handleEdit(r)}}},[e._v("编辑")]),t("a",{directives:[{name:"action",rawName:"v-action:delete",arg:"delete"}],on:{click:function(t){return e.handleDelete(r)}}},[e._v("删除")])])}}],null,!1,1721256717)}),t("AddForm",{ref:"AddForm",attrs:{categoryList:e.categoryList},on:{handleSubmit:e.handleRefresh}}),t("EditForm",{ref:"EditForm",attrs:{categoryList:e.categoryList},on:{handleSubmit:e.handleRefresh}})],1)},i=[],o=a(63237),s=a(21550),l=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"新增商品分类",width:720,visible:e.visible,confirmLoading:e.confirmLoading,maskClosable:!1,destroyOnClose:!0},on:{ok:e.handleSubmit,cancel:e.handleCancel}},[t("a-spin",{attrs:{spinning:e.confirmLoading}},[t("a-form",{attrs:{form:e.form}},[t("a-form-item",{attrs:{label:"分类名称",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,min:2,message:"请输入至少2个字符"}]}],expression:"['name', {rules: [{required: true, min: 2, message: '请输入至少2个字符'}]}]"}]})],1),t("a-form-item",{attrs:{label:"上级分类",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-tree-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["parent_id",{initialValue:0}],expression:"['parent_id', {initialValue: 0}]"}],attrs:{treeData:e.categoryListTree,dropdownStyle:{maxHeight:"400px",overflow:"auto"},allowClear:""}})],1),t("a-form-item",{attrs:{label:"分类图片",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("SelectImage",{directives:[{name:"decorator",rawName:"v-decorator",value:["image_id"],expression:"['image_id']"}],attrs:{collection:"category_image"}})],1),t("a-form-item",{attrs:{label:"分类描述",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["description",{rules:[{required:!1,min:2,message:"请输入至少2个字符"}]}],expression:"['description', {rules: [{required: false, min: 2, message: '请输入至少2个字符'}]}]"}]})],1),t("a-form-item",{attrs:{label:"分类标识",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["slug",{rules:[{required:!0,min:2,message:"请输入至少2个字符"}]}],expression:"['slug', {rules: [{required: true, min: 2, message: '请输入至少2个字符'}]}]"}]})],1)],1)],1)],1)},n=[],d=a(90667),c={components:{SelectImage:s._7},props:{categoryList:{type:Array,required:!0}},data:function(){return{title:"",labelCol:{span:7},wrapperCol:{span:13},visible:!1,confirmLoading:!1,form:this.$form.createForm(this),categoryListTree:[]}},methods:{add:function(){this.visible=!0,this.getCategoryList()},getCategoryList:function(){var e=this.categoryList,t=d.A.formatTreeData(e);this.categoryListTree=[{title:"顶级分类",key:0,value:0}].concat(t)},handleSubmit:function(e){var t=this;e.preventDefault();var a=this.form.validateFields;a((function(e,a){e||t.onFormSubmit(a)}))},handleCancel:function(){this.visible=!1,this.form.resetFields()},onFormSubmit:function(e){var t=this;this.confirmLoading=!0,o.WQ(e).then((function(a){t.$message.success("创建成功",1.5),t.handleCancel(),t.$emit("handleSubmit",e)})).finally((function(e){t.confirmLoading=!1}))}}},u=c,m=a(81656),p=(0,m.A)(u,l,n,!1,null,null,null),v=p.exports,f=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"编辑商品分类",width:720,visible:e.visible,confirmLoading:e.confirmLoading,maskClosable:!1,destroyOnClose:!0},on:{ok:e.handleSubmit,cancel:e.handleCancel}},[t("a-spin",{attrs:{spinning:e.confirmLoading}},[t("a-form",{attrs:{form:e.form}},[t("a-form-item",{attrs:{label:"分类名称",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,min:2,message:"请输入至少2个字符"}]}],expression:"['name', {rules: [{required: true, min: 2, message: '请输入至少2个字符'}]}]"}]})],1),t("a-form-item",{attrs:{label:"上级分类",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-tree-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["parent_id"],expression:"['parent_id']"}],attrs:{treeData:e.categoryListTree,dropdownStyle:{maxHeight:"400px",overflow:"auto"},allowClear:""}})],1),t("a-form-item",{attrs:{label:"分类图片",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("SelectImage",{directives:[{name:"decorator",rawName:"v-decorator",value:["image_id"],expression:"['image_id']"}],attrs:{channel:e.channel,channel_id:e.record.id,collection:"category_image",defaultList:e.record.image?[e.record.image]:[]}})],1),t("a-form-item",{attrs:{label:"分类描述",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["description",{rules:[{required:!1,min:2,message:"请输入至少2个字符"}]}],expression:"['description', {rules: [{required: false, min: 2, message: '请输入至少2个字符'}]}]"}]})],1),t("a-form-item",{attrs:{label:"分类标识",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["slug",{rules:[{required:!0,min:2,message:"请输入至少2个字符"}]}],expression:"['slug', {rules: [{required: true, min: 2, message: '请输入至少2个字符'}]}]"}]})],1),t("a-form-item",{attrs:{label:"同城配送商品分类",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"仅展示当前配送区域商品"}},[t("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["is_limit_area",{initialValue:!!e.$store.getters.storeId,rules:[{required:!0}]}],expression:"['is_limit_area', { initialValue: $store.getters.storeId ? true : false, rules: [{ required: true }] }]"}]},[t("a-radio",{attrs:{value:!0}},[e._v("是")]),t("a-radio",{attrs:{value:!1}},[e._v("否")])],1)],1)],1)],1)],1)},h=[],g=a(2543),_=a.n(g),b=a(81269),y={components:{SelectImage:s._7},props:{categoryList:{type:Array,required:!0}},data:function(){return{title:"",labelCol:{span:7},wrapperCol:{span:13},visible:!1,confirmLoading:!1,form:this.$form.createForm(this),categoryListTree:[],record:{},channel:b.A.CATEGORY.value}},methods:{edit:function(e){this.visible=!0,this.record=e,this.getCategoryList(),this.setFieldsValue()},setFieldsValue:function(){var e=this.record,t=this.form.setFieldsValue;this.$nextTick((function(){t(_().pick(e,["name","parent_id","image_id","status","description","slug","is_limit_area"]))}))},getCategoryList:function(){var e=this.categoryList,t=d.A.formatTreeData(e);this.categoryListTree=[{title:"顶级分类",key:0,value:0}].concat(t)},handleSubmit:function(e){var t=this;e.preventDefault();var a=this.form.validateFields;a((function(e,a){e||t.onFormSubmit(a)}))},handleCancel:function(){this.visible=!1,this.form.resetFields()},onFormSubmit:function(e){var t=this;e.parent_id||delete e.parent_id,this.confirmLoading=!0,o.hc(this.record["id"],e).then((function(a){t.$message.success("更新成功",1.5),t.handleCancel(),t.$emit("handleSubmit",e)})).finally((function(e){t.confirmLoading=!1}))}}},C=y,w=(0,m.A)(C,f,h,!1,null,null,null),k=w.exports,x={name:"Index",components:{STable:s.Wd,AddForm:v,EditForm:k},data:function(){return{categoryList:[],queryParam:{},isLoading:!1,columns:[{title:"分类ID",dataIndex:"id"},{title:"分类名称",dataIndex:"name"},{title:"分类图标",dataIndex:"image",scopedSlots:{customRender:"image"}},{title:"添加时间",dataIndex:"created_at"},{title:"操作",dataIndex:"action",width:"180px",scopedSlots:{customRender:"action"}}]}},created:function(){this.getCategoryList()},methods:{getCategoryList:function(){var e=this;this.isLoading=!0,o.p_().then((function(t){e.categoryList=t})).finally((function(t){e.isLoading=!1}))},handleAdd:function(){this.$refs.AddForm.add()},handleEdit:function(e){this.$refs.EditForm.edit(e)},handleDelete:function(e){var t=this,a=this.$confirm({title:"您确定要删除该记录吗?",content:"删除后不可恢复",onOk:function(){return o.KF({categoryId:e["id"]}).then((function(e){t.$message.success(e.message,1.5),t.handleRefresh()})).finally((function(e){a.destroy()}))}})},handleRefresh:function(){this.getCategoryList()}}},S=x,L=(0,m.A)(S,r,i,!1,null,null,null),D=L.exports},35389:function(e,t,a){a.r(t),a.d(t,{default:function(){return D}});var r=function(){var e=this,t=e._self._c;return t("a-card",{attrs:{bordered:!1}},[t("div",{staticClass:"card-title"},[e._v(e._s(e.$route.meta.title))]),t("div",{staticClass:"table-operator"},[t("a-row",{staticClass:"row-item-search"},[t("a-form",{staticClass:"search-form",attrs:{form:e.searchForm,layout:"inline"},on:{submit:e.handleSearch}},[t("a-form-item",{attrs:{label:"商品名称"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["goodsName"],expression:"['goodsName']"}],attrs:{placeholder:"请输入商品名称/编码"}})],1),t("a-form-item",{attrs:{label:"订单号"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["orderNo"],expression:"['orderNo']"}],attrs:{placeholder:"请输入订单号"}})],1),t("a-form-item",{attrs:{label:"会员ID"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["userId"],expression:"['userId']"}],attrs:{placeholder:"请输入会员ID"}})],1),t("a-form-item",{attrs:{label:"状态"}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["status",{initialValue:-1}],expression:"['status', { initialValue: -1 }]"}]},[t("a-select-option",{attrs:{value:-1}},[e._v("全部")]),t("a-select-option",{attrs:{value:1}},[e._v("显示")]),t("a-select-option",{attrs:{value:0}},[e._v("隐藏")])],1)],1),t("a-form-item",{staticClass:"search-btn"},[t("a-button",{attrs:{type:"primary",icon:"search","html-type":"submit"}},[e._v("搜索")])],1)],1)],1),t("div",{staticClass:"row-item-tab clearfix"},[t("div",{staticClass:"tab-list fl-l"},[t("a-radio-group",{attrs:{defaultValue:e.queryParam.score},on:{change:e.handleTabs}},[t("a-radio-button",{attrs:{value:0}},[e._v("全部")]),t("a-radio-button",{attrs:{value:10}},[e._v("好评")]),t("a-radio-button",{attrs:{value:20}},[e._v("中评")]),t("a-radio-button",{attrs:{value:30}},[e._v("差评")])],1)],1)])],1),t("s-table",{ref:"table",attrs:{rowKey:"comment_id",loading:e.isLoading,columns:e.columns,data:e.loadData,pageSize:15},scopedSlots:e._u([{key:"orderGoods",fn:function(e){return t("span",{},[t("GoodsItem",{attrs:{data:{image:e.goods_image,imageAlt:"商品图片",title:e.goods_name,goodsProps:e.goods_props}}})],1)}},{key:"user",fn:function(a){return t("span",{},[t("p",[e._v(e._s(a.nick_name))]),t("p",[t("span",{staticStyle:{"font-size":"12px",color:"#7b7b7b"}},[e._v("(ID: 11649)")])])])}},{key:"score",fn:function(a){return t("span",{},[t("a-tag",{attrs:{color:{10:"green",20:"",30:"red"}[a]}},[e._v(e._s({10:"好评",20:"中评",30:"差评"}[a]))])],1)}},{key:"content",fn:function(a){return t("span",{},[t("p",{staticClass:"twoline-hide",staticStyle:{width:"270px"}},[e._v(e._s(a))])])}},{key:"is_picture",fn:function(a){return t("span",{},[t("a-tag",{attrs:{color:a?"green":""}},[e._v(e._s(a?"是":"否"))])],1)}},{key:"status",fn:function(a){return t("span",{},[t("a-tag",{attrs:{color:a?"green":""}},[e._v(e._s(a?"显示":"隐藏"))])],1)}},{key:"action",fn:function(a,r){return t("span",{},[t("a",{directives:[{name:"action",rawName:"v-action:update",arg:"update"}],staticStyle:{"margin-right":"8px"},on:{click:function(t){return e.handleEdit(r)}}},[e._v("编辑")]),t("a",{directives:[{name:"action",rawName:"v-action:delete",arg:"delete"}],on:{click:function(t){return e.handleDelete(r)}}},[e._v("删除")])])}}])}),t("EditForm",{ref:"EditForm",on:{handleSubmit:e.handleRefresh}})],1)},i=[],o=a(57888),s=a(26222),l={list:"/goods.comment/list",detail:"/goods.comment/detail",edit:"/goods.comment/edit",delete:"/goods.comment/delete"};function n(e){return(0,s.p)({url:l.list,method:"get",params:e})}function d(e){return(0,s.p)({url:l.detail,method:"get",params:e})}function c(e){return(0,s.p)({url:l.edit,method:"post",data:e})}function u(e){return(0,s.p)({url:l.delete,method:"post",data:e})}var m=a(21550),p=a(114),v=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:e.title,width:720,visible:e.visible,confirmLoading:e.confirmLoading,maskClosable:!1,destroyOnClose:!0},on:{ok:e.handleSubmit,cancel:e.handleCancel}},[t("a-spin",{attrs:{spinning:e.confirmLoading}},[t("a-form",{attrs:{form:e.form}},[t("a-form-item",{attrs:{label:"评分",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["score",{initialValue:10,rules:[{required:!0}]}],expression:"['score', {initialValue: 10, rules: [{required: true}]}]"}]},[t("a-radio",{attrs:{value:10}},[e._v("好评")]),t("a-radio",{attrs:{value:20}},[e._v("中评")]),t("a-radio",{attrs:{value:30}},[e._v("差评")])],1)],1),t("a-form-item",{attrs:{label:"评价内容",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["content"],expression:"['content']"}],attrs:{placeholder:"请输入评价内容 (300个字符以内)",autoSize:{minRows:4}}})],1),t("a-form-item",{attrs:{label:"评价图片",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"最多允许6张，可拖拽调整显示顺序"}},[t("SelectImage",{directives:[{name:"decorator",rawName:"v-decorator",value:["imageIds"],expression:"['imageIds']"}],attrs:{multiple:"",maxNum:6,defaultList:e.record.imageList}})],1),t("a-form-item",{attrs:{label:"状态",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"用户端是否展示"}},[t("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["status",{initialValue:1,rules:[{required:!0}]}],expression:"['status', {initialValue: 1, rules: [{required: true}]}]"}]},[t("a-radio",{attrs:{value:1}},[e._v("显示")]),t("a-radio",{attrs:{value:0}},[e._v("隐藏")])],1)],1),t("a-form-item",{attrs:{label:"排序",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"数字越小越靠前"}},[t("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["sort",{initialValue:100,rules:[{required:!0,message:"请输入至少1个数字"}]}],expression:"['sort', {initialValue: 100, rules: [{required: true, message: '请输入至少1个数字'}]}]"}],attrs:{min:0}})],1)],1)],1)],1)},f=[],h=a(91863),g=a.n(h),_={components:{SelectImage:m._7},data:function(){return{title:"编辑评价",labelCol:{span:7},wrapperCol:{span:13},visible:!1,confirmLoading:!1,form:this.$form.createForm(this),commentId:null,record:{}}},methods:{edit:function(e){this.visible=!0,this.commentId=e,this.getRecordData()},getRecordData:function(){var e=this;this.confirmLoading=!0,d({commentId:this.commentId}).then((function(t){e.record=t.data.detail,e.setFieldsValue()})).finally((function(t){e.confirmLoading=!1}))},setFieldsValue:function(){var e=this,t=this.form.setFieldsValue;this.$nextTick((function(){t(g()(e.record,["score","content","status","sort","imageIds"]))}))},handleSubmit:function(e){var t=this;e.preventDefault();var a=this.form.validateFields;a((function(e,a){!e&&t.onFormSubmit(a)}))},handleCancel:function(){this.visible=!1,this.record={},this.form.resetFields()},onFormSubmit:function(e){var t=this;this.confirmLoading=!0,c({commentId:this.commentId,form:e}).then((function(a){t.$message.success(a.message,1.5),t.handleCancel(),t.$emit("handleSubmit",e)})).finally((function(e){t.confirmLoading=!1}))}}},b=_,y=a(81656),C=(0,y.A)(b,v,f,!1,null,null,null),w=C.exports,k=[{title:"ID",dataIndex:"comment_id"},{title:"商品信息",dataIndex:"orderGoods",scopedSlots:{customRender:"orderGoods"}},{title:"买家",dataIndex:"user",scopedSlots:{customRender:"user"}},{title:"评分",dataIndex:"score",scopedSlots:{customRender:"score"}},{title:"评价内容",dataIndex:"content",scopedSlots:{customRender:"content"}},{title:"图片评价",dataIndex:"is_picture",scopedSlots:{customRender:"is_picture"}},{title:"状态",dataIndex:"status",scopedSlots:{customRender:"status"}},{title:"排序",dataIndex:"sort"},{title:"评价时间",dataIndex:"create_time"},{title:"操作",dataIndex:"action",width:"180px",scopedSlots:{customRender:"action"}}],x={name:"Index",components:{ContentHeader:m.dv,STable:p.Wd,GoodsItem:p.O5,EditForm:w},data:function(){var e=this;return{expand:!1,searchForm:this.$form.createForm(this),categoryListTree:[],queryParam:{score:0},isLoading:!1,columns:k,loadData:function(t){return n((0,o.A)((0,o.A)({},t),e.queryParam)).then((function(e){return e.data.list}))}}},created:function(){},methods:{handleTabs:function(e){this.queryParam.score=e.target.value,this.handleRefresh(!0)},handleSearch:function(e){var t=this;e.preventDefault(),this.searchForm.validateFields((function(e,a){e||(t.queryParam=(0,o.A)((0,o.A)({},t.queryParam),a),t.handleRefresh(!0))}))},handleDelete:function(e){var t=this,a=this.$confirm({title:"您确定要删除该记录吗?",content:"删除后不可恢复",onOk:function(){return u({commentId:e.comment_id}).then((function(e){t.$message.success(e.message,1.5),t.handleRefresh()})).finally((function(e){a.destroy()}))}})},handleEdit:function(e){this.$refs.EditForm.edit(e.comment_id)},handleRefresh:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.$refs.table.refresh(e)}}},S=x,L=(0,y.A)(S,r,i,!1,null,"9d7105be",null),D=L.exports},65829:function(e,t,a){a.d(t,{A:function(){return A}});var r=function(){var e=this,t=e._self._c;return t("div",[t("a-form-item",{attrs:{label:"规格键值",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[e.multiSpecData.specList.length?e._e():t("div",{staticClass:"form-item-help",staticStyle:{"line-height":"36px"}},[t("small",[e._v("添加规格键值后设置每个规格的价格！")])]),e.isSpecLocked?e._e():t("a-button",{staticClass:"spec-group-add-btn",attrs:{icon:e.multiSpecData.specList.length?"edit":"plus"},on:{click:function(t){e.isShowSpecEditor=!0}}},[e._v(" "+e._s(e.multiSpecData.specList.length?"编辑规格键值":"添加规格键值")+" ")]),t("a-drawer",{attrs:{title:"规格键值编辑",placement:"right",closable:!1,visible:e.isShowSpecEditor,"after-visible-change":e.specVisibleChange,width:640}},[t("a-table",{staticClass:"spec-list",attrs:{rowKey:"id",columns:e.multiSpecData.specColumns,dataSource:e.multiSpecData.specList,scroll:{x:!0},pagination:!1,bordered:""},scopedSlots:e._u([{key:"key",fn:function(a,r){return[t("a-auto-complete",{attrs:{"data-source":e.specKeys,placeholder:"输入新键或选择已有"},model:{value:r.key,callback:function(t){e.$set(r,"key",t)},expression:"item.key"}})]}},{key:"name",fn:function(a,r){return[t("a-input",{attrs:{size:"small"},model:{value:r.name,callback:function(t){e.$set(r,"name",t)},expression:"item.name"}})]}},{key:"request_field_ids",fn:function(a,r){return[t("a-select",{style:{width:"100%"},attrs:{mode:"multiple",placeholder:"Please select"},model:{value:r.request_field_ids,callback:function(t){e.$set(r,"request_field_ids",t)},expression:"item.request_field_ids"}},e._l(e.multiSpecData.fields,(function(a){return t("a-select-option",{key:a.id},[e._v(" "+e._s(a.name)+" ")])})),1)]}},{key:"actions",fn:function(a,r){return[e.multiSpecData.specList.length?t("a-popconfirm",{attrs:{title:"确定删除?"},on:{confirm:function(){return e.MultiSpecModel.handleDeleteSpec(r.id)}}},[t("a",{attrs:{href:"javascript:;"}},[e._v("删除")])]):e._e()]}}])}),t("a-button",{staticClass:"editable-add-btn",attrs:{block:""},on:{click:function(){return e.MultiSpecModel.handleAddSpec()}}},[e._v("新增一条")]),t("div",{style:{position:"absolute",right:0,bottom:0,width:"100%",borderTop:"1px solid #e9e9e9",padding:"10px 16px",background:"#fff",textAlign:"right",zIndex:1}},[t("a-button",{style:{marginRight:"8px"},on:{click:function(t){e.isShowSpecEditor=!1}}},[e._v("取消")]),t("a-button",{attrs:{type:"primary",loading:e.isSavingSpec},on:{click:function(){return e.handleSaveSpecs()}}},[e._v("保存")])],1)],1)],1),t("a-form-item",{directives:[{name:"show",rawName:"v-show",value:e.multiSpecData.skuList.length,expression:"multiSpecData.skuList.length"}],attrs:{label:"规格数据",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[e.multiSpecData.skuList.length>1?t("div",{staticClass:"sku-batch"},[t("span",{staticClass:"title"},[e._v("批量设置:")]),t("a-input-number",{attrs:{placeholder:"商品价格",min:.01,precision:2},model:{value:e.multiSpecData.skuBatchForm.price,callback:function(t){e.$set(e.multiSpecData.skuBatchForm,"price",t)},expression:"multiSpecData.skuBatchForm.price"}}),t("a-input-number",{attrs:{placeholder:"零售价格",min:0,precision:2},model:{value:e.multiSpecData.skuBatchForm.retail_price,callback:function(t){e.$set(e.multiSpecData.skuBatchForm,"retail_price",t)},expression:"multiSpecData.skuBatchForm.retail_price"}}),t("a-input-number",{attrs:{placeholder:"永辉价格",min:0,precision:2},model:{value:e.multiSpecData.skuBatchForm.yh_price,callback:function(t){e.$set(e.multiSpecData.skuBatchForm,"yh_price",t)},expression:"multiSpecData.skuBatchForm.yh_price"}}),t("a-input-number",{attrs:{placeholder:"成本价格",min:0,precision:2},model:{value:e.multiSpecData.skuBatchForm.cost_price,callback:function(t){e.$set(e.multiSpecData.skuBatchForm,"cost_price",t)},expression:"multiSpecData.skuBatchForm.cost_price"}}),t("a-input-number",{attrs:{placeholder:"库存数量",min:0,precision:0},model:{value:e.multiSpecData.skuBatchForm.stock,callback:function(t){e.$set(e.multiSpecData.skuBatchForm,"stock",t)},expression:"multiSpecData.skuBatchForm.stock"}}),t("a-input-number",{attrs:{placeholder:"商品重量",min:0,precision:2},model:{value:e.multiSpecData.skuBatchForm.weight,callback:function(t){e.$set(e.multiSpecData.skuBatchForm,"weight",t)},expression:"multiSpecData.skuBatchForm.weight"}}),t("a-button",{on:{click:e.handleSkuBatch}},[e._v("立即设置")])],1):e._e(),t("a-table",{staticClass:"sku-list",attrs:{columns:e.multiSpecData.skuColumns,dataSource:e.multiSpecData.skuList,scroll:{x:!0},pagination:!1,bordered:""},scopedSlots:e._u([{key:"image",fn:function(a,r){return[t("SelectImage",{attrs:{channel:e.channel,channel_id:r.id,collection:"sku_image",defaultList:r.image?[r.image]:[],width:50},model:{value:r.image_id,callback:function(t){e.$set(r,"image_id",t)},expression:"item.image_id"}})]}},{key:"price",fn:function(a,r){return[t("a-input-number",{attrs:{size:"small",min:.01,precision:2},model:{value:r.price,callback:function(t){e.$set(r,"price",t)},expression:"item.price"}})]}},{key:"retail_price",fn:function(a,r){return[t("a-input-number",{attrs:{size:"small",min:0,precision:2},model:{value:r.retail_price,callback:function(t){e.$set(r,"retail_price",t)},expression:"item.retail_price"}})]}},{key:"yh_price",fn:function(a,r){return[t("a-input-number",{attrs:{size:"small",min:0,precision:2},model:{value:r.yh_price,callback:function(t){e.$set(r,"yh_price",t)},expression:"item.yh_price"}})]}},{key:"cost_price",fn:function(a,r){return[t("a-input-number",{attrs:{size:"small",min:0,precision:2},model:{value:r.cost_price,callback:function(t){e.$set(r,"cost_price",t)},expression:"item.cost_price"}})]}},{key:"stock",fn:function(a,r){return[t("a-input-number",{attrs:{size:"small",min:0,precision:0},model:{value:r.stock,callback:function(t){e.$set(r,"stock",t)},expression:"item.stock"}})]}},{key:"weight",fn:function(a,r){return[t("a-input-number",{attrs:{size:"small",min:0,precision:2},model:{value:r.weight,callback:function(t){e.$set(r,"weight",t)},expression:"item.weight"}})]}},{key:"no",fn:function(a,r){return[t("a-input",{attrs:{size:"small"},model:{value:r.no,callback:function(t){e.$set(r,"no",t)},expression:"item.no"}})]}}])})],1)],1)},i=[],o=a(69870),s=a(17654),l=a(16270),n=a(57888),d=a(93492),c=a(25418),u=a(26222),m={list:"/fields"};function p(e){return(0,u.p)({url:m.list,method:"get",params:e})}var v=a(2543),f=a.n(v),h=a(61145),g=a(47026),b=[{title:"预览图",dataIndex:"image",width:90,scopedSlots:{customRender:"image"}},{title:"商品价格",dataIndex:"price",width:100,scopedSlots:{customRender:"price"}},{title:"零售价格",dataIndex:"retail_price",width:80,scopedSlots:{customRender:"retail_price"}},{title:"永辉价格",dataIndex:"yh_price",width:80,scopedSlots:{customRender:"yh_price"}},{title:"成本价格",dataIndex:"cost_price",width:80,scopedSlots:{customRender:"cost_price"}},{title:"库存数量",dataIndex:"stock",width:80,scopedSlots:{customRender:"stock"}},{title:"重量 (KG)",dataIndex:"weight",width:80,scopedSlots:{customRender:"weight"}},{title:"SKU编码",dataIndex:"no",width:140,scopedSlots:{customRender:"no"}}],y={id:0,product_id:0,image_id:0,image:"",own_spec:[],price:"",retail_price:"",yh_price:"",cost_price:"",stock:"",weight:"",no:"",spec_ids:""},C={key:"",name:"",request_field_ids:[]},w=[{title:"规格类别",dataIndex:"key",scopedSlots:{customRender:"key"}},{title:"规格名称",dataIndex:"name",scopedSlots:{customRender:"name"}},{title:"要求提交",dataIndex:"request_field_ids",valueType:"select",scopedSlots:{customRender:"request_field_ids"}},{title:"操作",dataIndex:"actions",scopedSlots:{customRender:"actions"}}],k=function(){function e(){(0,d.A)(this,e),this.multiSpecData={},this.error="",this.multiSpecData={storeId:g.A.getters.storeId,specList:[],specColumns:f().cloneDeep(w),skuList:[],skuColumns:f().cloneDeep(b),skuBatchForm:f().cloneDeep(y),fields:[]}}return(0,c.A)(e,[{key:"getData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];e.length&&(this.multiSpecData.specList=f().cloneDeep(e).map((function(e){return e.request_field_ids=e.request_field_ids||[],e})),this.multiSpecData.skuList=f().cloneDeep(t).map((function(e){return e.skuKey=e.spec_ids,e})));var a=this.specGroupArr(),r=S(a),i=this.rowSpanArr(a,r);return this.buildSkuColumns(i,a),this.buildSkuList(r),this.multiSpecData}},{key:"getFields",value:function(){var e=this;return new Promise((function(t,a){e.multiSpecData.fields.length?t(e.multiSpecData.fields):p().then((function(a){e.multiSpecData.fields=a,t(a)}))}))}},{key:"isEmpty",value:function(){return 0===this.multiSpecData.specList.length}},{key:"getError",value:function(){return this.error}},{key:"specGroupArr",value:function(){var e=f()(this.multiSpecData.specList).groupBy("key").values().value();return e}},{key:"rowSpanArr",value:function(e,t){for(var a=[],r=t.length,i=0;i<e.length;i++)a[i]=parseInt(r/e[i].length),r=a[i];return a}},{key:"buildSkuList",value:function(e){for(var t=[],a=function(){var a=(0,n.A)((0,n.A)({},y),{},{key:r,skuKey:e[r].map((function(e){return e.id})).join(",")});e[r].forEach((function(e,t){a["spec_value_".concat(t)]=e.name})),t.push(a)},r=0;r<e.length;r++)a();this.multiSpecData.skuList=this.oldSkuList(t)}},{key:"oldSkuList",value:function(e){var t=this,a=this.multiSpecData.skuList.concat();if(!a.length||!e.length)return e;var r=function(r){var i={};i=a.length===e.length?f().cloneDeep(a[r]):a.find((function(a){return a.skuKey===e[r].skuKey&&a.store_id==t.multiSpecData.storeId})),i&&(e[r]=(0,n.A)((0,n.A)({},e[r]),i))};for(var i in e)r(i);return e}},{key:"buildSkuColumns",value:function(e,t){this.multiSpecData.specList;for(var a=b.concat(),r=function(t,a,r,i){var o={children:a,attrs:{}},s=e[t-1];return o.attrs.rowSpan=i%s===0?s:0,o},i=function(e){var i=t[e-1];a.unshift({title:i[0].key,dataIndex:"spec_value_".concat(e-1),customRender:function(t,a,i){return r(e,t,a,i)}})},o=t.length;o>0;o--)i(o);this.multiSpecData.skuColumns=a}},{key:"handleDeleteSpec",value:function(e){this.multiSpecData.specList=this.multiSpecData.specList.filter((function(t){return t.id!=e}))}},{key:"handleAddSpec",value:function(){this.multiSpecData.specList.push((0,n.A)({},C))}},{key:"handleSkuBatch",value:function(){var e=this.getFilterObject(this.multiSpecData.skuBatchForm),t=this.multiSpecData.skuList;for(var a in t)t[a]=(0,n.A)((0,n.A)({},t[a]),e);this.onUpdate(!1)}},{key:"getFilterObject",value:function(e){var t={};for(var a in e){var r=e[a];(0,h.Im)(r)||(t[a]=r)}return t}},{key:"verifyForm",value:function(){return!!this.verifySkuList()}},{key:"verifySkuList",value:function(){var e=[{field:"price",name:"商品价格"},{field:"stock",name:"库存数量"}],t=this.multiSpecData.skuList;for(var a in t){var r=t[a];for(var i in e){var o=r[e[i].field];if(""===o||null===o)return this.error="".concat(e[i].name,"不能为空"),!1}}return!0}},{key:"getFormSpecData",value:function(){var e=this.multiSpecData,t=e.specList,a=e.skuList,r={specList:f().cloneDeep(t),skuList:f().cloneDeep(a)};for(var i in r.skuList){var o=r.skuList[i];delete o.image,delete o.key}return r}},{key:"onUpdate",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e?(0,h.sg)(x,200)(this):x(this)}}])}(),x=function(e){return e.getData()},S=function(e){return e.length?Array.prototype.reduce.call(e,(function(e,t){var a=[];return e.forEach((function(e){t.forEach((function(t){a.push(e.concat([t]))}))})),a}),[[]]):[]},L=a(21550),D=a(5893),I=a(81269),q={components:{SelectImage:L._7},props:{goodsId:null,defaultSpecList:l.A.array.def([]),defaultSkuList:l.A.array.def([]),isSpecLocked:l.A.bool.def(!1)},data:function(){return{labelCol:{span:3},wrapperCol:{span:21},isShowSpecEditor:!1,MultiSpecModel:new k,multiSpecData:{specList:[],skuList:[]},channel:I.A.SKU.value,fields:[],isSavingSpec:!1}},watch:{defaultSpecList:function(e){e.length&&this.MultiSpecModel.isEmpty()&&this.getData()}},computed:{specKeys:function(){return _(this.multiSpecData.specList).map("key").uniq().value().filter((function(e){return""!=e}))}},created:function(){this.getData()},methods:{getData:function(){var e=this.defaultSpecList,t=this.defaultSkuList;this.multiSpecData=this.MultiSpecModel.getData(e,t)},getFormSpecData:function(){return this.MultiSpecModel.getFormSpecData()},handleSaveSpecs:function(){var e=this;return(0,s.A)((0,o.A)().mark((function t(){var a,r;return(0,o.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.isSavingSpec=!0,a=_(e.multiSpecData.specList).filter("key").groupBy("key").value(),t.next=4,D.$E(e.goodsId,a);case 4:r=t.sent,e.multiSpecData.skuList=r.skus,e.MultiSpecModel.onUpdate(!1),e.isSavingSpec=!1,e.isShowSpecEditor=!1;case 9:case"end":return t.stop()}}),t)})))()},handleSkuBatch:function(){this.MultiSpecModel.handleSkuBatch()},verifyForm:function(){return!!this.MultiSpecModel.verifyForm()||(this.$message.error(this.MultiSpecModel.getError(),2),!1)},specVisibleChange:function(e){var t=this;return(0,s.A)((0,o.A)().mark((function a(){return(0,o.A)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!e){a.next=3;break}return a.next=3,t.MultiSpecModel.getFields();case 3:case"end":return a.stop()}}),a)})))()}}},F=q,V=a(81656),N=(0,V.A)(F,r,i,!1,null,"21f3cdce",null),A=N.exports},26112:function(e,t,a){a.r(t),a.d(t,{default:function(){return L}});var r=function(){var e=this,t=e._self._c;return t("a-card",{attrs:{bordered:!1}},[t("div",{staticClass:"card-title"},[e._v(e._s(e.$route.meta.title))]),t("div",{staticClass:"table-operator"},[t("a-row",[t("a-col",{attrs:{span:6}},[t("a-button",{directives:[{name:"action",rawName:"v-action:create",arg:"create"}],attrs:{type:"primary",icon:"plus"},on:{click:e.handleAdd}},[e._v("新增")])],1),t("a-col",{attrs:{span:8,offset:10}},[t("a-input-search",{staticStyle:{"max-width":"300px","min-width":"150px",float:"right"},attrs:{placeholder:"请输入服务名称"},on:{search:e.onSearch},model:{value:e.queryParam.search,callback:function(t){e.$set(e.queryParam,"search",t)},expression:"queryParam.search"}})],1)],1)],1),t("s-table",{ref:"table",attrs:{rowKey:"service_id",loading:e.isLoading,columns:e.columns,data:e.loadData,pageSize:15},scopedSlots:e._u([{key:"summary",fn:function(a){return t("span",{},[t("p",{staticClass:"summary oneline-hide"},[e._v(e._s(a))])])}},{key:"is_default",fn:function(a){return t("span",{},[t("a-tag",{attrs:{color:a?"green":""}},[e._v(e._s(a?"是":"否"))])],1)}},{key:"status",fn:function(a){return t("span",{},[t("a-tag",{attrs:{color:a?"green":""}},[e._v(e._s(a?"显示":"隐藏"))])],1)}},{key:"action",fn:function(a,r){return t("span",{},[t("a",{directives:[{name:"action",rawName:"v-action:update",arg:"update"}],staticStyle:{"margin-right":"8px"},on:{click:function(t){return e.handleEdit(r)}}},[e._v("编辑")]),t("a",{directives:[{name:"action",rawName:"v-action:delete",arg:"delete"}],on:{click:function(t){return e.handleDelete(r)}}},[e._v("删除")])])}}])}),t("AddForm",{ref:"AddForm",on:{handleSubmit:e.handleRefresh}}),t("EditForm",{ref:"EditForm",on:{handleSubmit:e.handleRefresh}})],1)},i=[],o=a(57888),s=a(90841),l=a(21550),n=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:e.title,width:720,visible:e.visible,confirmLoading:e.confirmLoading,maskClosable:!1},on:{ok:e.handleSubmit,cancel:e.handleCancel}},[t("a-spin",{attrs:{spinning:e.confirmLoading}},[t("a-form",{attrs:{form:e.form}},[t("a-form-item",{attrs:{label:"服务名称",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,min:2,message:"请输入至少2个字符"}]}],expression:"['name', {rules: [{required: true, min: 2, message: '请输入至少2个字符'}]}]"}],attrs:{placeholder:"请输入服务与承诺的名称"}})],1),t("a-form-item",{attrs:{label:"概述",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["summary"],expression:"['summary']"}],attrs:{placeholder:"请输入概述内容 (300个字符以内)",autoSize:{minRows:4}}})],1),t("a-form-item",{attrs:{label:"是否默认",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"新增商品时是否默认勾选"}},[t("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["is_default",{initialValue:1,rules:[{required:!0}]}],expression:"['is_default', {initialValue: 1, rules: [{required: true}]}]"}]},[t("a-radio",{attrs:{value:1}},[e._v("是")]),t("a-radio",{attrs:{value:0}},[e._v("否")])],1)],1),t("a-form-item",{attrs:{label:"状态",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"用户端是否展示"}},[t("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["status",{initialValue:1,rules:[{required:!0}]}],expression:"['status', {initialValue: 1, rules: [{required: true}]}]"}]},[t("a-radio",{attrs:{value:1}},[e._v("显示")]),t("a-radio",{attrs:{value:0}},[e._v("隐藏")])],1)],1),t("a-form-item",{attrs:{label:"排序",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"数字越小越靠前"}},[t("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["sort",{initialValue:100,rules:[{required:!0,message:"请输入至少1个数字"}]}],expression:"['sort', {initialValue: 100, rules: [{required: true, message: '请输入至少1个数字'}]}]"}],attrs:{min:0}})],1)],1)],1)],1)},d=[],c={data:function(){return{title:"",labelCol:{span:7},wrapperCol:{span:13},visible:!1,confirmLoading:!1,form:this.$form.createForm(this)}},methods:{add:function(){this.title="新增记录",this.visible=!0},handleSubmit:function(e){var t=this;e.preventDefault();var a=this.form.validateFields;a((function(e,a){!e&&t.onFormSubmit(a)}))},handleCancel:function(){this.visible=!1,this.form.resetFields()},onFormSubmit:function(e){var t=this;this.confirmLoading=!0,s.WQ({form:e}).then((function(a){t.$message.success(a.message,1.5),t.handleCancel(),t.$emit("handleSubmit",e)})).finally((function(e){t.confirmLoading=!1}))}}},u=c,m=a(81656),p=(0,m.A)(u,n,d,!1,null,null,null),v=p.exports,f=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:e.title,width:720,visible:e.visible,confirmLoading:e.confirmLoading,maskClosable:!1},on:{ok:e.handleSubmit,cancel:e.handleCancel}},[t("a-spin",{attrs:{spinning:e.confirmLoading}},[t("a-form",{attrs:{form:e.form}},[t("a-form-item",{attrs:{label:"服务名称",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,min:2,message:"请输入至少2个字符"}]}],expression:"['name', {rules: [{required: true, min: 2, message: '请输入至少2个字符'}]}]"}],attrs:{placeholder:"请输入服务与承诺的名称"}})],1),t("a-form-item",{attrs:{label:"概述",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["summary"],expression:"['summary']"}],attrs:{placeholder:"请输入概述内容 (300个字符以内)",autoSize:{minRows:4}}})],1),t("a-form-item",{attrs:{label:"是否默认",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"新增商品时是否默认勾选"}},[t("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["is_default",{initialValue:1,rules:[{required:!0}]}],expression:"['is_default', {initialValue: 1, rules: [{required: true}]}]"}]},[t("a-radio",{attrs:{value:1}},[e._v("是")]),t("a-radio",{attrs:{value:0}},[e._v("否")])],1)],1),t("a-form-item",{attrs:{label:"状态",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"用户端是否展示"}},[t("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["status",{initialValue:1,rules:[{required:!0}]}],expression:"['status', {initialValue: 1, rules: [{required: true}]}]"}]},[t("a-radio",{attrs:{value:1}},[e._v("显示")]),t("a-radio",{attrs:{value:0}},[e._v("隐藏")])],1)],1),t("a-form-item",{attrs:{label:"排序",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"数字越小越靠前"}},[t("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["sort",{initialValue:100,rules:[{required:!0,message:"请输入至少1个数字"}]}],expression:"['sort', {initialValue: 100, rules: [{required: true, message: '请输入至少1个数字'}]}]"}],attrs:{min:0}})],1)],1)],1)],1)},h=[],g=a(91863),_=a.n(g),b={data:function(){return{title:"",labelCol:{span:7},wrapperCol:{span:13},visible:!1,confirmLoading:!1,form:this.$form.createForm(this),record:{}}},methods:{edit:function(e){this.title="编辑记录",this.visible=!0,this.record=e,this.setFieldsValue()},setFieldsValue:function(){var e=this,t=this.form.setFieldsValue;this.$nextTick((function(){t(_()(e.record,["name","summary","is_default","status","sort"]))}))},handleSubmit:function(e){var t=this;e.preventDefault();var a=this.form.validateFields;a((function(e,a){!e&&t.onFormSubmit(a)}))},handleCancel:function(){this.visible=!1,this.form.resetFields()},onFormSubmit:function(e){var t=this;this.confirmLoading=!0,s.hc({serviceId:this.record["service_id"],form:e}).then((function(a){t.$message.success(a.message,1.5),t.handleCancel(),t.$emit("handleSubmit",e)})).finally((function(e){t.confirmLoading=!1}))}}},y=b,C=(0,m.A)(y,f,h,!1,null,null,null),w=C.exports,k={name:"Index",components:{STable:l.Wd,AddForm:v,EditForm:w},data:function(){var e=this;return{queryParam:{},isLoading:!1,columns:[{title:"服务名称",dataIndex:"name",width:"300px"},{title:"概述",dataIndex:"summary",scopedSlots:{customRender:"summary"}},{title:"是否默认",dataIndex:"is_default",scopedSlots:{customRender:"is_default"}},{title:"状态",dataIndex:"status",scopedSlots:{customRender:"status"}},{title:"排序",dataIndex:"sort"},{title:"更新时间",dataIndex:"update_time"},{title:"操作",dataIndex:"action",width:"180px",scopedSlots:{customRender:"action"}}],loadData:function(t){return s.p_((0,o.A)((0,o.A)({},t),e.queryParam)).then((function(e){return e.data.list}))}}},created:function(){},methods:{handleAdd:function(){this.$refs.AddForm.add()},handleEdit:function(e){this.$refs.EditForm.edit(e)},handleDelete:function(e){var t=this,a=this.$confirm({title:"您确定要删除该记录吗?",content:"删除后不可恢复",onOk:function(){return s.KF({serviceId:e["service_id"]}).then((function(e){t.$message.success(e.message,1.5),t.handleRefresh()})).finally((function(e){a.destroy()}))}})},handleRefresh:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.$refs.table.refresh(e)},onSearch:function(){this.handleRefresh(!0)}}},x=k,S=(0,m.A)(x,r,i,!1,null,"0fd143ff",null),L=S.exports},90841:function(e,t,a){a.d(t,{KF:function(){return d},Q7:function(){return s},WQ:function(){return l},hc:function(){return n},p_:function(){return o}});var r=a(26222),i={list:"/goods.service/list",all:"/goods.service/all",add:"/goods.service/add",edit:"/goods.service/edit",delete:"/goods.service/delete"};function o(e){return(0,r.p)({url:i.list,method:"get",params:e})}function s(e){return(0,r.p)({url:i.all,method:"get",params:e})}function l(e){return(0,r.p)({url:i.add,method:"post",data:e})}function n(e){return(0,r.p)({url:i.edit,method:"post",data:e})}function d(e){return(0,r.p)({url:i.delete,method:"post",data:e})}},94255:function(e,t,a){a.d(t,{KF:function(){return c},Q7:function(){return s},WQ:function(){return n},_0:function(){return l},hc:function(){return d},p_:function(){return o}});var r=a(26222),i={list:"/setting.delivery/list",all:"/setting.delivery/all",detail:"/setting.delivery/detail",add:"/setting.delivery/add",edit:"/setting.delivery/edit",delete:"/setting.delivery/delete"};function o(e){return(0,r.p)({url:i.list,method:"get",params:e})}function s(e){return(0,r.p)({url:i.all,method:"get",params:e})}function l(e){return(0,r.p)({url:i.detail,method:"get",params:e})}function n(e){return(0,r.p)({url:i.add,method:"post",data:e})}function d(e){return(0,r.p)({url:i.edit,method:"post",data:e})}function c(e){return(0,r.p)({url:i.delete,method:"post",data:e})}},71009:function(e,t,a){a.d(t,{KF:function(){return d},Q7:function(){return s},WQ:function(){return l},hc:function(){return n},p_:function(){return o}});var r=a(26222),i={list:"/user.grade/list",all:"/user.grade/all",add:"/user.grade/add",edit:"/user.grade/edit",delete:"/user.grade/delete"};function o(e){return(0,r.p)({url:i.list,method:"get",params:e})}function s(e){return(0,r.p)({url:i.all,method:"get",params:e})}function l(e){return(0,r.p)({url:i.add,method:"post",data:e})}function n(e){return(0,r.p)({url:i.edit,method:"post",data:e})}function d(e){return(0,r.p)({url:i.delete,method:"post",data:e})}},11895:function(e,t,a){a.d(t,{t:function(){return o}});var r=a(26222),i={qrcode:"wechat/qrcode?uri={uri}"};function o(e){return(0,r.p)({url:i.qrcode.replace("{uri}",e),method:"get"})}},78834:function(e,t,a){var r=a(57888),i=a(2543),o=a.n(i),s=a(90667),l=a(5893),n=(a(63237),a(71009)),d=a(90841),c=a(94255),u=a(47026);t.A={goodsId:null,formData:{goods:{},goodsCategories:[],specs:[],skus:[],categoryList:[],deliveryList:[],serviceList:[],defaultServiceIds:[],userGradeList:[],defaultUserGradeValue:{}},getFormData:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this.goodsId=t,new Promise((function(a,r){Promise.all([e.getGoodsDetail(t),e.getCategoryList()]).then((function(){e.setDefaultData(),a({formData:e.formData})}))}))},getGoodsDetail:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return!!t&&new Promise((function(a,r){l._0(t).then((function(t){e.formData.goods=t.product,e.formData.goodsCategories=t.product.categories,e.formData.specs=t.specs,e.formData.skus=t.skus,a()}))}))},getFieldsValue:function(){var e=this.formData.goods,t=o().pick(e,["title","type","delivery_id","delivery_hours_taking","delivery_days_taking","delivery_latest","on_sale","description","highlight","serviceIds","sold_inital","is_points_gift","is_points_discount","is_enable_grade","is_alone_grade"]);t.categorys=this.formatCategoryIds(this.formData.goodsCategories);var a="intra-city"==this.formData.goods.type?this.formData.skus.filter((function(e){return e.store_id==u.A.getters.storeId||!u.A.getters.storeId})):this.formData.skus;t.spec_type=a.length>1?20:10;var i=o().pick(a[0],["price","retail_price","yh_price","cost_price","stock","weight","no"]);return t.delivery_hours_taking&&(t.delivery_taking="hours"),t.delivery_days_taking&&(t.delivery_taking="days"),(0,r.A)((0,r.A)({},t),i)},formatCategoryIds:function(e){return e.map((function(e){return{value:e.id}}))},getCategoryList:function(){var e=this;return new Promise((function(t,a){s.A.getCategoryTreeSelect().then((function(a){e.formData.categoryList=a,t()}))}))},getDeliveryList:function(){var e=this;return new Promise((function(t,a){c.Q7().then((function(a){e.formData.deliveryList=a.data.list,t()}))}))},getServiceList:function(){var e=this;return new Promise((function(t,a){d.Q7().then((function(a){e.formData.serviceList=a.data.list,t()}))}))},getUserGradeList:function(){var e=this;return new Promise((function(t,a){n.Q7({status:1}).then((function(a){e.formData.userGradeList=a.data.list,t()}))}))},setDefaultData:function(){this.setDefaultServiceIds(),this.setDefaultUserGradeValue()},setDefaultServiceIds:function(){var e=this.formData.serviceList;if(!this.goodsId){var t=e.filter((function(e){return e.is_default}));this.formData.defaultServiceIds=t.map((function(e){return e.service_id}))}},setDefaultUserGradeValue:function(){var e=this.formData.userGradeList,t=this.goodsId&&this.formData.goods.alone_grade_equity?this.formData.goods.alone_grade_equity:{},a={};e.forEach((function(e){a[e.grade_id]=t[e.grade_id]||e.equity.discount})),this.formData.defaultUserGradeValue=(0,r.A)({},a)}}}}]);
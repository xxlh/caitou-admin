(self["webpackChunkvue_antd_pro"]=self["webpackChunkvue_antd_pro"]||[]).push([[92],{19134:function(e,t,a){"use strict";a.d(t,{A:function(){return b}});a(50113),a(26099);var r=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:e.title,width:720,visible:e.visible,confirmLoading:e.confirmLoading,maskClosable:!1},on:{ok:e.handleSubmit,cancel:e.handleCancel}},[t("a-spin",{attrs:{spinning:e.confirmLoading}},[t("a-form",{attrs:{form:e.form}},[t("a-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.goodsId,expression:"!goodsId"}],attrs:{label:"选择商品",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("SelectGoods",{directives:[{name:"decorator",rawName:"v-decorator",value:["product_id",{rules:[{required:!0,message:"请选择指定的商品"}]}],expression:"['product_id', { rules: [{ required: true, message: '请选择指定的商品' }] }]"}],attrs:{multiple:!1,disabled:e.isEditing,defaultList:e.containGoodsList},on:{change:e.selectGoods}})],1),t("a-form-item",{attrs:{label:"选择规格",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["sku_id",{rules:[{required:!0,message:"请选择目标规格"}]}],expression:"['sku_id', {rules: [{required: true, message: '请选择目标规格'}]}]"}],attrs:{options:e.skusOption,disabled:e.isEditing},on:{change:e.selectSku}})],1),t("a-form-item",{attrs:{label:"调整价格",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["target_dates",{rules:[{required:e.targetDatesOption.length>0,message:"请选择对应团期"}]}],expression:"['target_dates', {rules: [{required: targetDatesOption.length > 0, message: '请选择对应团期'}]}]"},{name:"show",rawName:"v-show",value:e.targetDatesOption.length,expression:"targetDatesOption.length"}],staticStyle:{width:"200px"},attrs:{mode:"multiple",options:e.targetDatesOption}}),t("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["target_price",{rules:[{required:!0,message:"请输入目标调整的价格"}]}],expression:"['target_price', {rules: [{required: true, message: '请输入目标调整的价格'}]}]"}],attrs:{min:.01,precision:2}}),e._v(" 元 "),e.form.getFieldValue("sku_id")&&e.skus.length?t("p",{staticClass:"form-item-help"},[e.targetDatesOption.length?e.form.getFieldValue("target_dates")&&1==e.form.getFieldValue("target_dates").length?t("small",[e._v("当前价格："+e._s(e.skus.find((function(t){return t.id==e.form.getFieldValue("sku_id")})).daily_price[e.form.getFieldValue("target_dates")[0]].price))]):e._e():t("small",[e._v("当前价格："+e._s(e.skus.find((function(t){return t.id==e.form.getFieldValue("sku_id")})).price))])]):e._e()],1),t("a-form-item",{attrs:{label:"调整库存",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-switch",{model:{value:e.isChangeStock,callback:function(t){e.isChangeStock=t},expression:"isChangeStock"}}),t("a-input-number",{directives:[{name:"show",rawName:"v-show",value:e.isChangeStock,expression:"isChangeStock"},{name:"decorator",rawName:"v-decorator",value:["target_stock"],expression:"['target_stock']"}],attrs:{min:0}}),e.form.getFieldValue("sku_id")&&e.skus.length?t("p",{staticClass:"form-item-help"},[e.targetDatesOption.length?e.form.getFieldValue("target_dates")&&1==e.form.getFieldValue("target_dates").length?t("small",[e._v("当前库存："+e._s(e.skus.find((function(t){return t.id==e.form.getFieldValue("sku_id")})).daily_price[e.form.getFieldValue("target_dates")[0]].stock))]):e._e():t("small",[e._v("当前库存："+e._s(e.skus.find((function(t){return t.id==e.form.getFieldValue("sku_id")})).stock))])]):e._e()],1),t("a-form-item",{attrs:{label:"模板",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-radio-group",{attrs:{"button-style":"solid"},on:{change:e.changeQuickOption},model:{value:e.quickOption,callback:function(t){e.quickOption=t},expression:"quickOption"}},[t("a-radio-button",{attrs:{value:"every_1_daily_at_6"}},[e._v("每天6点场")]),t("a-radio-button",{attrs:{value:"every_1_daily_at_9"}},[e._v("每天9点场")]),t("a-radio-button",{attrs:{value:"every_1_daily_at_12"}},[e._v("每天12点场")]),t("a-radio-button",{attrs:{value:"every_1_daily_at_16"}},[e._v("每天16点场")]),t("a-radio-button",{attrs:{value:"every_1_daily_at_20"}},[e._v("每天20点场")]),t("a-radio-button",{attrs:{value:"every_1_daily_at_0"}},[e._v("每天0点场")]),t("a-radio-button",{attrs:{value:""}},[e._v("自定义")])],1)],1),t("a-form-item",{directives:[{name:"show",rawName:"v-show",value:e.quickOption,expression:"quickOption"}],attrs:{label:"触发日期",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-date-picker",{attrs:{allowClear:!1},on:{change:e.changeQuickOption},model:{value:e.adjust_date,callback:function(t){e.adjust_date=t},expression:"adjust_date"}})],1),t("a-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.quickOption,expression:"!quickOption"}],attrs:{label:"触发时间",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-config-provider",{attrs:{locale:e.locale}},[t("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["adjust_at",{rules:[{required:!0,message:"请选择触发时间"}]}],expression:"['adjust_at', {rules: [{required: true, message: '请选择触发时间'}]}]"}],attrs:{"show-time":""}})],1)],1),t("a-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.quickOption,expression:"!quickOption"}],attrs:{label:"重复触发",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-switch",{model:{value:e.isRepeat,callback:function(t){e.isRepeat=t},expression:"isRepeat"}}),t("span",{directives:[{name:"show",rawName:"v-show",value:e.isRepeat,expression:"isRepeat"}]},[e._v(" 每 "),t("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["every"],expression:"['every']"}]}),t("a-select",{directives:[{name:"show",rawName:"v-show",value:e.isRepeat,expression:"isRepeat"},{name:"decorator",rawName:"v-decorator",value:["repeat"],expression:"['repeat']"}],staticStyle:{width:"100px"}},[t("a-select-option",{attrs:{value:"daily"}},[e._v("天")]),t("a-select-option",{attrs:{value:"weekly"}},[e._v("周")]),t("a-select-option",{attrs:{value:"monthly"}},[e._v("月")]),t("a-select-option",{attrs:{value:"yearly"}},[e._v("年")])],1),e._v(" 触发 ")],1)],1),t("a-form-item",{attrs:{label:e.quickOption?"限时":"价格库存回改",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-switch",{directives:[{name:"show",rawName:"v-show",value:!e.quickOption,expression:"!quickOption"}],model:{value:e.isTurnBack,callback:function(t){e.isTurnBack=t},expression:"isTurnBack"}}),t("span",{directives:[{name:"show",rawName:"v-show",value:e.isTurnBack||e.quickOption,expression:"isTurnBack || quickOption"}]},[t("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["turn_back_minutes",{initialValue:60,rules:[{required:!!e.quickOption,message:"请输入限时分钟数"}]}],expression:"['turn_back_minutes', {initialValue: 60, rules: [{required: !!quickOption, message: '请输入限时分钟数'}]}]"}],attrs:{min:1}}),e._v(" "+e._s(e.quickOption?"分钟":"分钟后"))],1)],1)],1)],1)],1)},i=[],s=a(57888),n=a(69870),o=a(17654),l=(a(2008),a(62062),a(62010),a(42781),a(16270)),u=a(5893),c=a(12448),d=a(2543),p=a.n(d),m=a(95093),v=a.n(m),_=a(1796),h={components:{SelectGoods:c.Ri},props:{goodsId:null,goodsSkus:l.A.array.def([])},data:function(){return{gId:this.goodsId,skus:this.goodsSkus,title:"调价修改",labelCol:{span:7},wrapperCol:{span:13},visible:!1,confirmLoading:!1,form:this.$form.createForm(this),containGoodsList:[],record:{},selectedSkuId:0,isEditing:!1,isChangeStock:!1,isRepeat:!1,isTurnBack:!1,quickOption:"",adjust_date:v()(),locale:_.A}},computed:{skusOption:function(){return this.skus.map((function(e){return{value:e.id,label:e.name}}))},targetDatesOption:function(){var e,t=this,a=null===(e=this.skus.find((function(e){return e.id==t.selectedSkuId})))||void 0===e?void 0:e.daily_price;return a?p()(a).map((function(e,t){return{value:t,label:t}})).value():[]}},methods:{create:function(){this.visible=!0},edit:function(e){var t=this;return(0,o.A)((0,n.A)().mark((function a(){var r,i;return(0,n.A)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(t.isEditing=!0,t.visible=!0,t.record=e,t.setFieldsValue(),t.gId||(t.gId=e.product_id),null!==(r=t.skus)&&void 0!==r&&r.length){a.next=10;break}return a.next=8,u._0(t.gId);case 8:i=a.sent,t.skus=t.$store.getters.storeId?i.skus.filter((function(e){return e.store_id==t.$store.getters.storeId})):i.skus;case 10:if(t.goodsId){a.next=13;break}return a.next=13,t.getContainGoodsList();case 13:case"end":return a.stop()}}),a)})))()},getContainGoodsList:function(){var e=this;return(0,o.A)((0,n.A)().mark((function t(){var a,r;return(0,n.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a=e.record,r=[a.product_id],void 0===r||!r.length){t.next=6;break}return e.isLoading=!0,t.next=6,u.eV(r,{store_id:e.$store.getters.storeId}).then((function(t){e.containGoodsList=t.data})).finally((function(t){e.isLoading=!1}));case 6:case"end":return t.stop()}}),t)})))()},setFieldsValue:function(){var e=this,t=this.record,a=this.form.setFieldsValue;this.$nextTick((function(){var r=(0,d.pick)(t,["product_id","target_dates","target_price","target_stock","repeat","every","adjust_at"]);r.sku_id=t.product_sku_id,t.turn_back&&(e.isTurnBack=!0,r.turn_back_minutes=v()(t.turn_back.adjust_at).diff(t.adjust_at,"minutes"),e.quickOption="every_"+t.every+"_"+t.repeat+"_at_"+v()(t.adjust_at).hour(),e.adjust_date=v()(t.adjust_at)),a(r)})),t.every&&t.repeat&&(this.isRepeat=!0),this.selectedSkuId=t.product_sku_id},selectSku:function(e){this.selectedSkuId=e},selectGoods:function(e){var t=this;return(0,o.A)((0,n.A)().mark((function a(){var r;return(0,n.A)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!t.isEditing){a.next=2;break}return a.abrupt("return");case 2:return t.gId=e,a.next=5,u._0(t.gId);case 5:r=a.sent,t.skus=t.$store.getters.storeId?r.skus.filter((function(e){return e.store_id==t.$store.getters.storeId})):r.skus,t.selectedSkuId=0,t.form.setFieldsValue({sku_id:null});case 9:case"end":return a.stop()}}),a)})))()},changeQuickOption:function(e){var t=1,a="daily",r=this.adjust_date;r.minute(0),r.second(0),this.quickOption&&("every_1_daily_at_6"==this.quickOption?r.hour(6):"every_1_daily_at_9"==this.quickOption?r.hour(9):"every_1_daily_at_12"==this.quickOption?r.hour(12):"every_1_daily_at_16"==this.quickOption?r.hour(16):"every_1_daily_at_20"==this.quickOption?r.hour(20):"every_1_daily_at_0"==this.quickOption?r.hour(0):this.quickOption="",this.isRepeat=!0,this.form.setFieldsValue({every:t,repeat:a,adjust_at:r}))},handleSubmit:function(e){var t=this;e.preventDefault();var a=this.form.validateFields;a((function(e,a){t.isChangeStock||(a.target_stock=null),a.adjust_at.local&&(a.adjust_at=a.adjust_at.local().format()),a.turn_back_seconds=60*a.turn_back_minutes,t.quickOption||t.isTurnBack||(a.turn_back_seconds=null),!e&&t.onFormSubmit(a)}))},handleCancel:function(){this.gId=null,this.skus=[],this.visible=!1,this.form.resetFields(),this.isEditing=!1,this.isChangeStock=!1,this.isRepeat=!1,this.quickOption=""},onFormSubmit:function(e){var t=this;this.confirmLoading=!0,this.isEditing?u.p6(this.record.product_id,this.record.id,(0,s.A)({},e)).then((function(a){t.$message.success("已修改",1.5),t.handleCancel(),t.$emit("handleSubmit",e)})).finally((function(){t.confirmLoading=!1})):u.zR(this.gId,(0,s.A)({},e)).then((function(a){t.$message.success("已新增",1.5),t.handleCancel(),t.$emit("handleSubmit",e)})).finally((function(){t.confirmLoading=!1}))}}},f=h,g=a(81656),k=(0,g.A)(f,r,i,!1,null,null,null),b=k.exports},1796:function(e,t,a){"use strict";a.d(t,{A:function(){return o}});var r=a(85505),i={today:"今天",now:"此刻",backToToday:"返回今天",ok:"确定",timeSelect:"选择时间",dateSelect:"选择日期",weekSelect:"选择周",clear:"清除",month:"月",year:"年",previousMonth:"上个月 (翻页上键)",nextMonth:"下个月 (翻页下键)",monthSelect:"选择月份",yearSelect:"选择年份",decadeSelect:"选择年代",yearFormat:"YYYY年",dayFormat:"D日",dateFormat:"YYYY年M月D日",dateTimeFormat:"YYYY年M月D日 HH时mm分ss秒",previousYear:"上一年 (Control键加左方向键)",nextYear:"下一年 (Control键加右方向键)",previousDecade:"上一年代",nextDecade:"下一年代",previousCentury:"上一世纪",nextCentury:"下一世纪"},s=a(69791),n={lang:(0,r["default"])({placeholder:"请选择日期",rangePlaceholder:["开始日期","结束日期"]},i),timePickerLocale:(0,r["default"])({},s.A)};n.lang.ok="确 定";var o=n},69791:function(e,t){"use strict";var a={placeholder:"请选择时间"};t.A=a},91863:function(e,t,a){var r=1/0,i=9007199254740991,s="[object Arguments]",n="[object Function]",o="[object GeneratorFunction]",l="[object Symbol]",u="object"==typeof a.g&&a.g&&a.g.Object===Object&&a.g,c="object"==typeof self&&self&&self.Object===Object&&self,d=u||c||Function("return this")();function p(e,t,a){switch(a.length){case 0:return e.call(t);case 1:return e.call(t,a[0]);case 2:return e.call(t,a[0],a[1]);case 3:return e.call(t,a[0],a[1],a[2])}return e.apply(t,a)}function m(e,t){var a=-1,r=e?e.length:0,i=Array(r);while(++a<r)i[a]=t(e[a],a,e);return i}function v(e,t){var a=-1,r=t.length,i=e.length;while(++a<r)e[i+a]=t[a];return e}var _=Object.prototype,h=_.hasOwnProperty,f=_.toString,g=d.Symbol,k=_.propertyIsEnumerable,b=g?g.isConcatSpreadable:void 0,w=Math.max;function y(e,t,a,r,i){var s=-1,n=e.length;a||(a=q),i||(i=[]);while(++s<n){var o=e[s];t>0&&a(o)?t>1?y(o,t-1,a,r,i):v(i,o):r||(i[i.length]=o)}return i}function C(e,t){return e=Object(e),O(e,t,(function(t,a){return a in e}))}function O(e,t,a){var r=-1,i=t.length,s={};while(++r<i){var n=t[r],o=e[n];a(o,n)&&(s[n]=o)}return s}function x(e,t){return t=w(void 0===t?e.length-1:t,0),function(){var a=arguments,r=-1,i=w(a.length-t,0),s=Array(i);while(++r<i)s[r]=a[t+r];r=-1;var n=Array(t+1);while(++r<t)n[r]=a[r];return n[t]=s,p(e,this,n)}}function q(e){return F(e)||j(e)||!!(b&&e&&e[b])}function S(e){if("string"==typeof e||Y(e))return e;var t=e+"";return"0"==t&&1/e==-r?"-0":t}function j(e){return I(e)&&h.call(e,"callee")&&(!k.call(e,"callee")||f.call(e)==s)}var F=Array.isArray;function A(e){return null!=e&&N(e.length)&&!V(e)}function I(e){return D(e)&&A(e)}function V(e){var t=L(e)?f.call(e):"";return t==n||t==o}function N(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=i}function L(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function D(e){return!!e&&"object"==typeof e}function Y(e){return"symbol"==typeof e||D(e)&&f.call(e)==l}var R=x((function(e,t){return null==e?{}:C(e,m(y(t,1),S))}));e.exports=R}}]);
"use strict";(self["webpackChunkvue_antd_pro"]=self["webpackChunkvue_antd_pro"]||[]).push([[331],{53529:function(e,a,t){t.r(a),t.d(a,{default:function(){return h}});t(62010);var r=function(){var e=this,a=e._self._c;return a("a-card",{attrs:{bordered:!1}},[a("div",{staticClass:"card-title"},[e._v(e._s(e.$route.meta.title))]),a("a-spin",{attrs:{spinning:e.isLoading}},[a("a-form",{attrs:{form:e.form},on:{submit:e.handleSubmit}},[a("a-form-item",{attrs:{label:"是否开启满额包邮",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["is_open",{rules:[{required:!0}]}],expression:"['is_open', { rules: [{ required: true }] }]"}]},[a("a-radio",{attrs:{value:1}},[e._v("开启")]),a("a-radio",{attrs:{value:0}},[e._v("关闭")])],1)],1),a("a-form-item",{attrs:{label:"单笔订单满",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["money",{rules:[{required:!0,message:"请输入包邮的订单额度"}]}],expression:"['money', { rules: [{ required: true, message: '请输入包邮的订单额度' }] }]"}],attrs:{min:0,precision:2}}),a("span",{staticClass:"ml-10"},[e._v("元包邮")]),a("div",{staticClass:"form-item-help"},[a("small",[e._v("如设置0为全场包邮")])])],1),a("a-form-item",{attrs:{label:"不参与包邮的商品",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("SelectGoods",{directives:[{name:"decorator",rawName:"v-decorator",value:["excludedGoodsIds"],expression:"['excludedGoodsIds']"}],attrs:{defaultList:e.excludedGoodsList}})],1),a("a-form-item",{attrs:{label:"不参与包邮的地区",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-button",{on:{click:e.handleAreasModal}},[e._v("选择地区")]),a("p",{staticClass:"content"},e._l(e.excludedRegions.selectedText,(function(t,r){return a("span",{key:r},[a("span",[e._v(e._s(t.name))]),t.citys.length?[a("span",[e._v("[")]),e._l(t.citys,(function(r,i){return a("span",{key:i,staticClass:"city-name"},[e._v(e._s(r.name)+e._s(t.citys.length>i+1?"、":""))])})),a("span",[e._v("]")])]:e._e(),a("span",{staticClass:"mr-5"})],2)})),0)],1),a("a-form-item",{attrs:{label:"满额包邮说明",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["describe",{rules:[{required:!0,message:"请输入满额包邮说明"}]}],expression:"['describe', { rules: [{ required: true, message: '请输入满额包邮说明' }] }]"}],attrs:{autoSize:{minRows:4}}})],1),a("a-form-item",{attrs:{"wrapper-col":{span:e.wrapperCol.span,offset:e.labelCol.span}}},[a("a-button",{attrs:{type:"primary","html-type":"submit"}},[e._v("提交")])],1)],1),a("AreasModal",{ref:"AreasModal",on:{handleSubmit:e.handleAreaSubmit}})],1)],1)},i=[],s=t(69870),n=t(17654),o=(t(26099),t(62953),t(91863)),l=t.n(o),u=t(25962),d=t(5893),c=t(47695),m=t(32875),p={components:{SelectGoods:c.Ri,AreasModal:m.yt},data:function(){return{key:"full_free",labelCol:{span:4},wrapperCol:{span:12},isLoading:!1,form:this.$form.createForm(this),record:{},excludedRegions:{cityIds:[],selectedText:[]},excludedGoodsList:[]}},created:function(){var e=this;return(0,n.A)((0,s.A)().mark((function a(){return(0,s.A)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,e.getDetail();case 2:return a.next=4,e.getExcludedGoodsList();case 4:case"end":return a.stop()}}),a)})))()},methods:{getDetail:function(){var e=this;return(0,n.A)((0,s.A)().mark((function a(){return(0,s.A)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return e.isLoading=!0,a.next=3,u._(e.key).then((function(a){e.record=a.data.values,e.setFieldsValue()})).finally((function(a){e.isLoading=!1}));case 3:case"end":return a.stop()}}),a)})))()},getExcludedGoodsList:function(){var e=this;return(0,n.A)((0,s.A)().mark((function a(){var t;return(0,s.A)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(t=e.record.excludedGoodsIds,!(t.length>0)){a.next=5;break}return e.isLoading=!0,a.next=5,d.eV(t).then((function(a){e.excludedGoodsList=a.data.list})).finally((function(a){e.isLoading=!1}));case 5:case"end":return a.stop()}}),a)})))()},setFieldsValue:function(){var e=this,a=this.record,t=this.$nextTick,r=this.form.setFieldsValue;t((function(){e.excludedRegions=a.excludedRegions,r(l()(a,["is_open","money","describe"]))}))},handleAreasModal:function(){this.$refs.AreasModal.handle({},this.excludedRegions.cityIds)},handleAreaSubmit:function(e){this.excludedRegions={cityIds:e.selectedCityIds,selectedText:e.selectedText}},handleSubmit:function(e){var a=this;e.preventDefault();var t=this.form.validateFields,r=this.excludedRegions;t((function(e,t){e||(t.excludedRegions=r,a.onFormSubmit(t))}))},onFormSubmit:function(e){var a=this;this.isLoading=!0,u.y(this.key,{form:e}).then((function(e){a.$message.success(e.message,1.5)})).finally((function(e){a.isLoading=!1}))}}},v=p,_=t(81656),f=(0,_.A)(v,r,i,!1,null,"60008742",null),h=f.exports},192:function(e,a,t){t.r(a),t.d(a,{default:function(){return _}});var r=function(){var e=this,a=e._self._c;return a("a-card",{attrs:{bordered:!1}},[a("div",{staticClass:"card-title"},[e._v(e._s(e.$route.meta.title))]),a("a-spin",{attrs:{spinning:e.isLoading}},[a("a-form",{attrs:{form:e.form},on:{submit:e.handleSubmit}},[a("a-form-item",{attrs:{label:"助力标题",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,min:2,message:"请输入至少2个字符"}]}],expression:"['name', { rules: [{ required: true, min: 2, message: '请输入至少2个字符' }] }]"}],attrs:{placeholder:"请输入助力标题"}})],1),a("a-form-item",{attrs:{label:"助力图",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("SelectImage",{directives:[{name:"decorator",rawName:"v-decorator",value:["image_id"],expression:"['image_id']"}],attrs:{collection:"assist_image"}}),a("p",{staticClass:"form-item-help"},[a("small",[e._v("建议200x200的奖励图")])])],1),a("a-form-item",{attrs:{label:"成功奖励",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("p",[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["award_id",{rules:[{required:!0}]}],expression:"['award_id', { rules: [{required: true}] }]"}],staticStyle:{width:"200px"},attrs:{placeholder:"请选择奖励的优惠券",allowClear:"",options:e.couponList,"filter-option":!1,dropdownStyle:{maxHeight:"300px",overflow:"auto"}}})],1),a("p",[a("span",{staticClass:"ml-5"},[e._v("同时奖励现金：")]),a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["award_amount",{initialValue:0}],expression:"['award_amount', { initialValue: 0 }]"}],attrs:{min:0,precision:2}}),a("span",[e._v("元")])],1)]),a("a-form-item",{attrs:{label:"对助力者奖励",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-radio-group",{model:{value:e.isAwardTeamate,callback:function(a){e.isAwardTeamate=a},expression:"isAwardTeamate"}},[a("a-radio",{attrs:{value:!1}},[e._v("不奖励")]),a("a-radio",{attrs:{value:!0}},[e._v("奖励")])],1)],1),a("a-form-item",{directives:[{name:"show",rawName:"v-show",value:e.isAwardTeamate,expression:"isAwardTeamate"}],attrs:{label:"助力者奖励",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("p",[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["award_teammate_id"],expression:"['award_teammate_id']"}],staticStyle:{width:"200px"},attrs:{placeholder:"请选择奖励的优惠券",allowClear:"",options:e.couponList,"filter-option":!1,dropdownStyle:{maxHeight:"300px",overflow:"auto"}}})],1),a("p",[a("span",{staticClass:"ml-5"},[e._v("同时奖励现金：")]),a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["award_teammate_amount",{initialValue:0}],expression:"['award_teammate_amount', { initialValue: 0 }]"}],attrs:{min:0,precision:2}}),a("span",[e._v("元")])],1),a("p",{staticClass:"form-item-help"},[a("small",[e._v("每个帮忙助力用户在助力的同时获得奖励")])])]),a("a-form-item",{attrs:{label:"需要助力数",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["needs",{initialValue:2,rules:[{required:!0,message:"请输入成功助力的需要助力数"}]}],expression:"['needs', { initialValue: 2, rules: [{ required: true, message: '请输入成功助力的需要助力数' }] }]"}],attrs:{min:-1,precision:0}}),a("span",{staticClass:"ml-5"},[e._v("位用户")]),a("p",[a("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["is_need_new",{initialValue:0}],expression:"['is_need_new', { initialValue: 0}]"}]},[a("a-radio",{attrs:{value:0}},[e._v("不限制")]),a("a-radio",{attrs:{value:1}},[e._v("新用户")])],1)],1)],1),a("a-form-item",{attrs:{label:"限时助力",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["hour_limited",{initialValue:3,rules:[{required:!0,message:"请输入助力限制的小时数"}]}],expression:"['hour_limited', { initialValue: 3, rules: [{ required: true, message: '请输入助力限制的小时数' }] }]"}],attrs:{min:-1,precision:0}}),a("span",{staticClass:"ml-5"},[e._v("小时")])],1),a("a-form-item",{attrs:{label:"限制同城",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["is_city_limited",{initialValue:1}],expression:"['is_city_limited', { initialValue: 1}]"}]},[a("a-radio",{attrs:{value:0}},[e._v("不限制")]),a("a-radio",{attrs:{value:1}},[e._v("只允许同城可配送区用户助力")])],1)],1),a("a-form-item",{attrs:{label:"周期限制",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("span",{staticClass:"ant-input-group-wrapper",staticStyle:{width:"auto"}},[a("span",{staticClass:"ant-input-wrapper ant-input-group"},[a("span",{staticClass:"ant-input-group-addon"},[e._v("每")]),a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["limit_once_every"],expression:"['limit_once_every']"}],staticStyle:{width:"150px"},attrs:{placeholder:"限制每xx时段领取一张"}},[a("a-select-option",{attrs:{value:"day"}},[e._v("天")]),a("a-select-option",{attrs:{value:"week"}},[e._v("周")]),a("a-select-option",{attrs:{value:"month"}},[e._v("月")]),a("a-select-option",{attrs:{value:null}},[e._v("不限")])],1),a("span",{staticClass:"ant-input-group-addon"},[e._v("限领取一张")])],1)])]),a("a-form-item",{attrs:{label:"是否启用",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["is_active",{initialValue:1,rules:[{required:!0}]}],expression:"['is_active', { initialValue: 1, rules: [{ required: true }] }]"}]},[a("a-radio",{attrs:{value:1}},[e._v("启用")]),a("a-radio",{attrs:{value:0}},[e._v("禁用")])],1),a("p",{staticClass:"form-item-help"},[a("small",[e._v("如果设为隐藏将不会展示在用户端页面")])])],1),a("a-form-item",{staticClass:"mt-20",attrs:{"wrapper-col":{span:e.wrapperCol.span,offset:e.labelCol.span}}},[a("a-button",{attrs:{type:"primary","html-type":"submit",loading:e.isBtnLoading}},[e._v("提交")])],1)],1)],1)],1)},i=[],s=t(69870),n=t(17654),o=(t(28706),t(62062),t(26099),t(95093),t(94197)),l=t(20543),u=t(47695),d=t(28178),c={components:{InputNumberGroup:u.tE,SelectImage:u._7},data:function(){return{ApplyRangeEnum:d.dw,CouponTypeEnum:d.kM,ExpireTypeEnum:d.HC,isLoading:!1,isBtnLoading:!1,labelCol:{span:3},wrapperCol:{span:10},form:this.$form.createForm(this),couponList:[],isAwardTeamate:!1}},created:function(){var e=this;return(0,n.A)((0,s.A)().mark((function a(){var t;return(0,s.A)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return e.$nextTick((function(){e.$forceUpdate()})),a.next=3,l.p_({per_page:99});case 3:t=a.sent,e.couponList=t.data.map((function(e){return{label:"".concat(e.id,". ").concat(e.title),value:e.id}}));case 5:case"end":return a.stop()}}),a)})))()},methods:{handleSubmit:function(e){var a=this;e.preventDefault();var t=this.form.validateFields,r=this.onFormSubmit;t((function(e,t){t.award_teammate_id||(t.award_teammate_id=0),a.isAwardTeamate||(t.award_teammate_id=0),a.isAwardTeamate||(t.award_teammate_amount=null),!e&&r(t)}))},onFormSubmit:function(e){var a=this;this.isLoading=!0,this.isBtnLoading=!0,o.WQ(e).then((function(e){a.$message.success("添加成功",1.5),setTimeout((function(){a.$router.push("./index")}),1500)})).catch((function(){a.isBtnLoading=!1})).finally((function(e){a.isLoading=!1}))}}},m=c,p=t(81656),v=(0,p.A)(m,r,i,!1,null,"6468be61",null),_=v.exports},37468:function(e,a,t){t.r(a),t.d(a,{default:function(){return v}});t(27495),t(5746);var r=function(){var e=this,a=e._self._c;return a("a-card",{attrs:{bordered:!1}},[a("div",{staticClass:"card-title"},[e._v(e._s(e.$route.meta.title))]),a("a-alert",{attrs:{message:"注：助力券只能抵扣商品金额，最多优惠到0.02元，不能抵扣运费",banner:""}}),a("div",{staticClass:"table-operator"},[a("a-row",[a("a-col",{attrs:{span:6}},[e.$auth("vouchers.create")?a("a-button",{attrs:{type:"primary",icon:"plus"},on:{click:e.handleAdd}},[e._v("新增")]):e._e()],1),a("a-col",{attrs:{span:8,offset:10}},[a("a-input-search",{staticStyle:{"max-width":"300px","min-width":"150px",float:"right"},attrs:{placeholder:"请输入优惠券名称"},on:{search:e.onSearch},model:{value:e.queryParam.search,callback:function(a){e.$set(e.queryParam,"search",a)},expression:"queryParam.search"}})],1)],1)],1),a("s-table",{ref:"table",attrs:{rowKey:"id",loading:e.isLoading,columns:e.columns,data:e.loadData,pageSize:15},scopedSlots:e._u([{key:"award",fn:function(t,r){return["App\\Models\\VoucherTemplate"==r.award_type&&r.award?a("a-tooltip",{attrs:{title:r.award.title}},[a("a-tag",[e._v("赠送优惠券")])],1):e._e(),r.award_amount?a("a-tag",[e._v("赠送金额￥"+e._s(r.award_amount))]):e._e(),r.award_amount||r.award?e._e():[e._v("无")]]}},{key:"award_teammate",fn:function(t,r){return["App\\Models\\VoucherTemplate"==r.award_teammate_type&&r.award_teammate?a("a-tooltip",{attrs:{title:r.award_teammate.title}},[a("a-tag",[e._v("赠送优惠券")])],1):r.award_teammate_amount?a("a-tag",[e._v("赠送金额￥"+e._s(r.award_teammate_amount))]):[e._v("无")]]}},{key:"is_need_new",fn:function(a){return[e._v(" "+e._s(a?"是":"否")+" ")]}},{key:"limit_once_every",fn:function(a){return["day"==a?[e._v("每天一次")]:"week"==a?[e._v("每周一次")]:"month"==a?[e._v("每月一次")]:e._e()]}},{key:"is_active",fn:function(t){return[a("a-tag",{attrs:{color:t?"green":""}},[e._v(e._s(t?"可用":"禁用"))])]}},{key:"action",fn:function(t){return a("span",{staticClass:"actions"},[e.$auth("vouchers.update")?a("a",{on:{click:function(a){return e.handleEdit(t)}}},[e._v("编辑")]):e._e(),a("a",{directives:[{name:"action",rawName:"v-action:delete",arg:"delete"}],on:{click:function(a){return e.handleDelete(t)}}},[e._v("删除")])])}}])})],1)},i=[],s=t(57888),n=(t(26099),t(94197)),o=t(47695),l=t(28178),u=t(47026),d={name:"Index",components:{STable:o.Wd},data:function(){var e=this;return{queryParam:{area_id:u.A.getters.areaId},ApplyRangeEnum:l.dw,CouponTypeEnum:l.kM,ExpireTypeEnum:l.HC,isLoading:!1,columns:[{title:"助力模版ID",dataIndex:"id"},{title:"助力标题",dataIndex:"name"},{title:"奖励",dataIndex:"award_amount",scopedSlots:{customRender:"award"}},{title:"助力者奖励",dataIndex:"award_teammate_amount",scopedSlots:{customRender:"award_teammate"}},{title:"需要助力数",dataIndex:"needs"},{title:"是否新人助力",dataIndex:"is_need_new",scopedSlots:{customRender:"is_need_new"}},{title:"用户发起频率",dataIndex:"limit_once_every",scopedSlots:{customRender:"limit_once_every"}},{title:"已助力次数",dataIndex:"success_count"},{title:"状态",dataIndex:"is_active",scopedSlots:{customRender:"is_active"}},{title:"添加时间",dataIndex:"created_at"},{title:"操作",width:"180px",scopedSlots:{customRender:"action"}}],loadData:function(a){return n.p_((0,s.A)((0,s.A)({},a),e.queryParam)).then((function(e){return e}))}}},created:function(){},methods:{handleAdd:function(){this.$router.push("./create")},handleEdit:function(e){this.$router.push({path:"./update",query:{id:e.id}})},handleDelete:function(e){var a=this,t=this.$confirm({title:"您确定要删除该记录吗?",content:"删除后不可恢复",onOk:function(){return n.KF(e.id).then((function(e){a.$message.success(e.message,1.5),a.handleRefresh()})).finally((function(e){t.destroy()}))}})},handleRefresh:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.$refs.table.refresh(e)},onSearch:function(){this.handleRefresh(!0)}}},c=d,m=t(81656),p=(0,m.A)(c,r,i,!1,null,null,null),v=p.exports},44313:function(e,a,t){t.r(a),t.d(a,{default:function(){return _}});t(62010);var r=function(){var e=this,a=e._self._c;return a("a-card",{attrs:{bordered:!1}},[a("div",{staticClass:"card-title"},[e._v(e._s(e.$route.meta.title))]),a("div",{staticClass:"table-operator"},[a("a-row",{staticClass:"row-item-search"},[a("a-form",{staticClass:"search-form",attrs:{form:e.searchForm,layout:"inline"},on:{submit:e.handleSearch}},[a("a-form-item",{attrs:{label:"助力标题"}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["couponName"],expression:"['couponName']"}],attrs:{placeholder:"请输入助力标题"}})],1),a("a-form-item",{attrs:{label:"会员ID"}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["user_id"],expression:"['user_id']"}],attrs:{placeholder:"请输入会员ID"}})],1),a("a-form-item",{attrs:{label:"领取时间"}},[a("a-range-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["created_between"],expression:"['created_between']"}],attrs:{format:"YYYY-MM-DD"}})],1),a("a-form-item",{staticClass:"search-btn"},[a("a-button",{attrs:{type:"primary",icon:"search","html-type":"submit"}},[e._v("搜索")])],1)],1)],1)],1),a("s-table",{ref:"table",attrs:{rowKey:"id",loading:e.isLoading,columns:e.columns,data:e.loadData,pageSize:15},scopedSlots:e._u([{key:"user",fn:function(e){return[a("UserItem",{attrs:{user:e}})]}},{key:"coupon_type",fn:function(t){return[a("a-tag",[e._v(e._s(e.CouponTypeEnum[t].name))])]}},{key:"count",fn:function(t,r){return[a("a-popover",{attrs:{placement:"right"}},[a("p",{staticClass:"c-p"},[e._v(e._s(t))]),a("template",{slot:"content"},e._l(r.teammates,(function(e){return a("div",[a("UserItem",{attrs:{user:e}})],1)})),0)],2)]}},{key:"status",fn:function(t){return[t.is_done?a("span",[a("a-tag",{attrs:{color:"green"}},[e._v("成功")])],1):e.moment(t.valid_before)<e.moment()?a("span",[a("a-tag",[e._v("已超时")])],1):a("span",[e._v("还剩"+e._s(e.moment(t.valid_before).diff(e.moment(),"minutes"))+"分钟")])]}}])})],1)},i=[],s=t(57888),n=t(94197),o=t(32664),l=t(28178),u=t(95093),d=t.n(u),c={name:"Index",components:{STable:o.Wd,UserItem:o.Dn},data:function(){var e=this;return{searchForm:this.$form.createForm(this),queryParam:{},CouponTypeEnum:l.kM,isLoading:!1,columns:[{title:"ID",dataIndex:"id"},{title:"会员信息",dataIndex:"user",scopedSlots:{customRender:"user"}},{title:"助力标题",dataIndex:"template.name"},{title:"已助力次数",dataIndex:"count",scopedSlots:{customRender:"count"}},{title:"状态",scopedSlots:{customRender:"status"}},{title:"领取时间",dataIndex:"created_at"}],loadData:function(a){return n.Rm((0,s.A)((0,s.A)({},a),e.queryParam)).then((function(e){return e}))}}},created:function(){},methods:{moment:d(),handleRefresh:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.$refs.table.refresh(e)},handleSearch:function(e){var a=this;e.preventDefault(),this.searchForm.validateFields((function(e,t){e||(a.queryParam=(0,s.A)((0,s.A)({},a.queryParam),t),a.handleRefresh(!0))}))}}},m=c,p=t(81656),v=(0,p.A)(m,r,i,!1,null,null,null),_=v.exports},50827:function(e,a,t){t.r(a),t.d(a,{default:function(){return g}});var r=function(){var e=this,a=e._self._c;return a("a-card",{attrs:{bordered:!1}},[a("div",{staticClass:"card-title"},[e._v(e._s(e.$route.meta.title))]),a("a-spin",{attrs:{spinning:e.isLoading}},[a("a-form",{attrs:{form:e.form},on:{submit:e.handleSubmit}},[a("a-form-item",{attrs:{label:"助力标题",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,min:2,message:"请输入至少2个字符"}]}],expression:"['name', { rules: [{ required: true, min: 2, message: '请输入至少2个字符' }] }]"}],attrs:{placeholder:"请输入助力标题"}})],1),a("a-form-item",{attrs:{label:"助力图",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("SelectImage",{directives:[{name:"decorator",rawName:"v-decorator",value:["image_id"],expression:"['image_id']"}],attrs:{channel:e.channel,channel_id:e.assistId,collection:"assist_image",defaultList:e.record.image?[e.record.image]:[]}}),a("p",{staticClass:"form-item-help"},[a("small",[e._v("建议200x200的奖励图")])])],1),a("a-form-item",{attrs:{label:"成功奖励",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("p",[a("SelectVoucher",{directives:[{name:"decorator",rawName:"v-decorator",value:["award_id",{rules:[{required:!0}]}],expression:"['award_id', { rules: [{required: true}] }]"}],attrs:{multiple:!1,defaultList:e.award_vouchers}})],1),a("p",[a("span",{staticClass:"ml-5"},[e._v("同时奖励现金：")]),a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["award_amount",{initialValue:0}],expression:"['award_amount', { initialValue: 0 }]"}],attrs:{min:0,precision:2}}),a("span",[e._v("元")])],1)]),a("a-form-item",{attrs:{label:"对助力者奖励",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-radio-group",{model:{value:e.isAwardTeamate,callback:function(a){e.isAwardTeamate=a},expression:"isAwardTeamate"}},[a("a-radio",{attrs:{value:!1}},[e._v("不奖励")]),a("a-radio",{attrs:{value:!0}},[e._v("奖励")])],1)],1),a("a-form-item",{directives:[{name:"show",rawName:"v-show",value:e.isAwardTeamate,expression:"isAwardTeamate"}],attrs:{label:"助力者奖励",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("p",[a("SelectVoucher",{directives:[{name:"decorator",rawName:"v-decorator",value:["award_teammate_id"],expression:"['award_teammate_id']"}],attrs:{multiple:!1,defaultList:e.award_teammate_vouchers}})],1),a("p",[a("span",{staticClass:"ml-5"},[e._v("同时奖励现金：")]),a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["award_teammate_amount",{initialValue:0}],expression:"['award_teammate_amount', { initialValue: 0 }]"}],attrs:{min:0,precision:2}}),a("span",[e._v("元")])],1),a("p",{staticClass:"form-item-help"},[a("small",[e._v("每个帮忙助力用户在助力的同时获得奖励")])])]),a("a-form-item",{attrs:{label:"需要助力数",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["needs",{initialValue:2,rules:[{required:!0,message:"请输入成功助力的需要助力数"}]}],expression:"['needs', { initialValue: 2, rules: [{ required: true, message: '请输入成功助力的需要助力数' }] }]"}],attrs:{min:-1,precision:0}}),a("span",{staticClass:"ml-5"},[e._v("位用户")]),a("p",[a("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["is_need_new"],expression:"['is_need_new']"}]},[a("a-radio",{attrs:{value:0}},[e._v("不限制")]),a("a-radio",{attrs:{value:1}},[e._v("新用户")])],1)],1)],1),a("a-form-item",{attrs:{label:"限时助力",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["hour_limited",{initialValue:3,rules:[{required:!0,message:"请输入助力限制的小时数"}]}],expression:"['hour_limited', { initialValue: 3, rules: [{ required: true, message: '请输入助力限制的小时数' }] }]"}],attrs:{min:-1,precision:0}}),a("span",{staticClass:"ml-5"},[e._v("小时")])],1),a("a-form-item",{attrs:{label:"限制同城",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["is_city_limited"],expression:"['is_city_limited']"}]},[a("a-radio",{attrs:{value:0}},[e._v("不限制")]),a("a-radio",{attrs:{value:1}},[e._v("只允许同城可配送区用户助力")])],1)],1),a("a-form-item",{attrs:{label:"周期限制",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("span",{staticClass:"ant-input-group-wrapper",staticStyle:{width:"auto"}},[a("span",{staticClass:"ant-input-wrapper ant-input-group"},[a("span",{staticClass:"ant-input-group-addon"},[e._v("每")]),a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["limit_once_every"],expression:"['limit_once_every']"}],staticStyle:{width:"150px"},attrs:{placeholder:"限制每xx时段领取一张"}},[a("a-select-option",{attrs:{value:"day"}},[e._v("天")]),a("a-select-option",{attrs:{value:"week"}},[e._v("周")]),a("a-select-option",{attrs:{value:"month"}},[e._v("月")]),a("a-select-option",{attrs:{value:null}},[e._v("不限")])],1),a("span",{staticClass:"ant-input-group-addon"},[e._v("限领取一张")])],1)])]),a("a-form-item",{attrs:{label:"是否启用",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["is_active",{initialValue:1,rules:[{required:!0}]}],expression:"['is_active', { initialValue: 1, rules: [{ required: true }] }]"}]},[a("a-radio",{attrs:{value:1}},[e._v("启用")]),a("a-radio",{attrs:{value:0}},[e._v("禁用")])],1),a("p",{staticClass:"form-item-help"},[a("small",[e._v("如果设为隐藏将不会展示在用户端页面")])])],1),a("a-form-item",{staticClass:"mt-20",attrs:{"wrapper-col":{span:e.wrapperCol.span,offset:e.labelCol.span}}},[a("a-button",{attrs:{type:"primary","html-type":"submit",loading:e.isBtnLoading}},[e._v("提交")])],1)],1)],1)],1)},i=[],s=t(69870),n=t(17654),o=(t(26099),t(95093),t(2543)),l=t(94197),u=t(20543),d=t(61145),c=t(47695),m=t(28178),p=t(81269),v={components:{InputNumberGroup:c.tE,SelectImage:c._7,SelectVoucher:c.lC},data:function(){return{ApplyRangeEnum:m.dw,CouponTypeEnum:m.kM,ExpireTypeEnum:m.HC,channel:p.A.ASSIST.value,isLoading:!1,isBtnLoading:!1,labelCol:{span:3},wrapperCol:{span:10},form:this.$form.createForm(this),assistId:null,record:{},award_vouchers:[],award_teammate_vouchers:[],isAwardTeamate:!1}},created:function(){var e=this;return(0,n.A)((0,s.A)().mark((function a(){var t,r;return(0,s.A)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return e.assistId=parseInt(e.$route.query.id),a.next=3,e.getDetail();case 3:return a.next=5,u._0(e.record.award_id);case 5:return t=a.sent,t&&e.award_vouchers.push(t),a.next=9,u._0(e.record.award_teammate_id);case 9:r=a.sent,r&&e.award_teammate_vouchers.push(r);case 11:case"end":return a.stop()}}),a)})))()},methods:{getDetail:function(){var e=this;return(0,n.A)((0,s.A)().mark((function a(){var t;return(0,s.A)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t=e.assistId,e.isLoading=!0,a.next=4,l._0(t).then((function(a){e.record=a,e.setFieldsValue()})).finally((function(){e.isLoading=!1}));case 4:case"end":return a.stop()}}),a)})))()},setFieldsValue:function(){var e=this,a=this.record,t=this.form,r=this.$nextTick;!(0,d.Im)(t.getFieldsValue())&&r((function(){var r=(0,o.pick)(a,["name","area_id","award_amount","award_id","award_type","award_teammate_amount","award_teammate_id","award_teammate_type","needs","is_need_new","hour_limited","is_city_limited","is_active","limit_once_every"]);(a.award_teammate_id||a.award_teammate_amount)&&(e.isAwardTeamate=!0),t.setFieldsValue(r)}))},handleSubmit:function(e){var a=this;e.preventDefault();var t=this.form.validateFields,r=this.onFormSubmit;t((function(e,t){t.award_teammate_id||(t.award_teammate_id=0),a.isAwardTeamate||(t.award_teammate_id=0),a.isAwardTeamate||(t.award_teammate_amount=null),!e&&r(t)}))},onFormSubmit:function(e){var a=this;this.isLoading=!0,this.isBtnLoading=!0,l.hc(this.assistId,e).then((function(e){a.$message.success("更新成功",1.5),setTimeout((function(){a.$router.push("./index")}),1500)})).catch((function(){a.isBtnLoading=!1})).finally((function(e){a.isLoading=!1}))}}},_=v,f=t(81656),h=(0,f.A)(_,r,i,!1,null,"16d93c7c",null),g=h.exports},90413:function(e,a,t){t.r(a),t.d(a,{default:function(){return v}});var r=function(){var e=this,a=e._self._c;return a("a-card",{attrs:{bordered:!1}},[a("div",{staticClass:"card-title"},[e._v(e._s(e.$route.meta.title))]),a("a-spin",{attrs:{spinning:e.isLoading}},[a("a-form",{attrs:{form:e.form},on:{submit:e.handleSubmit}},[a("a-form-item",{attrs:{label:"优惠券名称",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["title",{rules:[{required:!0,min:2,message:"请输入至少2个字符"}]}],expression:"['title', { rules: [{ required: true, min: 2, message: '请输入至少2个字符' }] }]"}],attrs:{placeholder:"请输入优惠券名称"}})],1),a("a-form-item",{attrs:{label:"优惠券类型",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["type",{initialValue:"discount",rules:[{required:!0}]}],expression:"['type', { initialValue: 'discount', rules: [{ required: true }] }]"}]},[a("a-radio",{attrs:{value:"discount"}},[e._v("满减券")]),a("a-radio",{attrs:{value:"percent"}},[e._v("折扣券")])],1)],1),e.form.getFieldValue("type")==e.CouponTypeEnum.FULL_DISCOUNT.value?a("a-form-item",{attrs:{label:"减免金额",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["save_amount",{rules:[{required:!0,message:"请输入减免金额"}]}],expression:"['save_amount', { rules: [{ required: true, message: '请输入减免金额' }] }]"}],attrs:{min:.01,precision:2}}),a("span",{staticClass:"ml-5"},[e._v("元")])],1):e._e(),e.form.getFieldValue("type")==e.CouponTypeEnum.DISCOUNT.value?a("a-form-item",{attrs:{label:"折扣率",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["off_percent",{initialValue:0,rules:[{required:!0,message:"请输入折扣率"}]}],expression:"['off_percent', { initialValue: 0, rules: [{ required: true, message: '请输入折扣率' }] }]"}],attrs:{min:0,max:1,precision:2,step:.05}}),a("p",{staticClass:"form-item-help"},[a("small",[e._v("折扣率范围 0-0.99，0.2代表打8折，0代表不折扣")])])],1):e._e(),a("a-form-item",{attrs:{label:"最低消费金额",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["amount_limit",{rules:[{required:!0,message:"请输入最低消费金额"}]}],expression:"['amount_limit', { rules: [{ required: true, message: '请输入最低消费金额' }] }]"}],attrs:{min:.01,precision:2}}),a("span",{staticClass:"ml-5"},[e._v("元")])],1),a("a-form-item",{attrs:{label:"到期类型",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["expire_type",{initialValue:e.ExpireTypeEnum.RECEIVE.value,rules:[{required:!0}]}],expression:"['expire_type', { initialValue: ExpireTypeEnum.RECEIVE.value, rules: [{ required: true }] }]"}]},[a("a-radio",{attrs:{value:e.ExpireTypeEnum.RECEIVE.value}},[e._v("领取后生效")]),a("a-radio",{attrs:{value:e.ExpireTypeEnum.FIXED_TIME.value}},[e._v("固定生效时段")])],1),a("a-form-item",{directives:[{name:"show",rawName:"v-show",value:e.form.getFieldValue("expire_type")==e.ExpireTypeEnum.RECEIVE.value,expression:"form.getFieldValue('expire_type') == ExpireTypeEnum.RECEIVE.value"}],staticClass:"expire_type-10"},[a("InputNumberGroup",{directives:[{name:"decorator",rawName:"v-decorator",value:["start_day",{initialValue:0,rules:[{required:!0,message:"请输入自领取起几天后开始生效"}]}],expression:"['start_day', { initialValue: 0, rules: [{ required: true, message: '请输入自领取起几天后开始生效' }] }]"}],attrs:{addonBefore:"生效于",addonAfter:"天后",inputProps:{min:0,precision:0}}}),a("InputNumberGroup",{directives:[{name:"show",rawName:"v-show",value:!e.expire_as_hour,expression:"!expire_as_hour"},{name:"decorator",rawName:"v-decorator",value:["expire_day",{initialValue:7,rules:[{required:!0,message:"请输入自领取起有效天数"}]}],expression:"['expire_day', { initialValue: 7, rules: [{ required: true, message: '请输入自领取起有效天数' }] }]"}],attrs:{addonBefore:"有效期",addonAfter:"天",inputProps:{min:1,precision:0}}}),a("InputNumberGroup",{directives:[{name:"show",rawName:"v-show",value:e.expire_as_hour,expression:"expire_as_hour"},{name:"decorator",rawName:"v-decorator",value:["expire_hour",{initialValue:3,rules:[{required:!0,message:"请输入自领取起有效小时数"}]}],expression:"['expire_hour', { initialValue: 3, rules: [{ required: true, message: '请输入自领取起有效小时数' }] }]"}],attrs:{addonBefore:"有效期",addonAfter:"小时",inputProps:{min:1,precision:0}}}),a("a",{on:{click:function(a){e.expire_as_hour=!e.expire_as_hour}}},[e._v("切换")])],1),a("a-form-item",{directives:[{name:"show",rawName:"v-show",value:e.form.getFieldValue("expire_type")==e.ExpireTypeEnum.FIXED_TIME.value,expression:"form.getFieldValue('expire_type') == ExpireTypeEnum.FIXED_TIME.value"}],staticClass:"expire_type-20"},[a("a-range-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["betweenTime",{initialValue:e.defaultTime,rules:[{required:!0,message:"请选择有效期范围"}]}],expression:"['betweenTime', { initialValue: defaultTime, rules: [{ required: true, message: '请选择有效期范围' }] }]"}],attrs:{"show-time":""}})],1)],1),a("a-form-item",{attrs:{label:"限时领取",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-range-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["gainBetween",{initialValue:["",""]}],expression:"['gainBetween', { initialValue: ['',''] }]"}],attrs:{"show-time":{defaultValue:e.defaultTime}}})],1),a("a-form-item",{attrs:{label:"领取方式",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-radio-group",{model:{value:e.gainMethod,callback:function(a){e.gainMethod=a},expression:"gainMethod"}},[a("a-radio",{attrs:{value:"manual"}},[e._v("用户手动领取")]),a("a-radio",{attrs:{value:"situation"}},[e._v("场景自动获得")])],1),a("a-select",{directives:[{name:"show",rawName:"v-show",value:"situation"==e.gainMethod,expression:"gainMethod == 'situation'"},{name:"decorator",rawName:"v-decorator",value:["auto_gain_situation",{initialValue:"after_launching"}],expression:"['auto_gain_situation', { initialValue: 'after_launching' }]"}],staticStyle:{width:"150px"},attrs:{placeholder:"请选择自动触发领取的场景"}},[a("a-select-option",{attrs:{value:"after_launching"}},[e._v("App启动时")]),a("a-select-option",{attrs:{value:"after_new_order"}},[e._v("线上下单后")]),a("a-select-option",{attrs:{value:"after_new_ontheway"}},[e._v("顺路单下单后")]),a("a-select-option",{attrs:{value:"after_registered"}},[e._v("新用户")]),a("a-select-option",{attrs:{value:"after_registered_2_day"}},[e._v("新用户次日")]),a("a-select-option",{attrs:{value:"after_registered_3_day"}},[e._v("新用户第3天")]),a("a-select-option",{attrs:{value:"after_registered_4_day"}},[e._v("新用户第4天")]),a("a-select-option",{attrs:{value:"after_registered_5_day"}},[e._v("新用户第5天")]),a("a-select-option",{attrs:{value:"after_registered_6_day"}},[e._v("新用户第6天")]),a("a-select-option",{attrs:{value:"after_registered_7_day"}},[e._v("新用户第7天")]),a("a-select-option",{attrs:{value:"after_first_referred"}},[e._v("推荐首个新用户")]),a("a-select-option",{attrs:{value:"after_referred"}},[e._v("推荐每个新用户")]),a("a-select-option",{attrs:{value:"after_referred_first_order"}},[e._v("推荐注册完成下单")])],1)],1),a("a-form-item",{attrs:{label:"券适用范围",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["apply_range",{initialValue:10,rules:[{required:!0}]}],expression:"['apply_range', { initialValue: 10, rules: [{ required: true }] }]"}]},[a("a-radio",{attrs:{value:10}},[e._v("全场通用")]),a("a-radio",{attrs:{value:20}},[e._v("指定商品")])],1),20==e.form.getFieldValue("apply_range")?a("a-form-item",[a("SelectGoods",{directives:[{name:"decorator",rawName:"v-decorator",value:["apply_range_config.applyGoodsIds",{initialValue:[],rules:[{required:!0,message:"请选择指定的商品"}]}],expression:"['apply_range_config.applyGoodsIds', { initialValue: [], rules: [{ required: true, message: '请选择指定的商品' }] }]"}],attrs:{defaultList:e.containGoodsList}})],1):e._e()],1),a("a-form-item",{attrs:{label:"发放总数量",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["max_gain",{initialValue:-1,rules:[{required:!0,message:"请输入发放总数量"}]}],expression:"['max_gain', { initialValue: -1, rules: [{ required: true, message: '请输入发放总数量' }] }]"}],attrs:{min:-1,precision:0}}),a("span",{staticClass:"ml-5"},[e._v("张")]),a("p",{staticClass:"form-item-help"},[a("small",[e._v("发放的优惠券总数量，-1为不限制")])])],1),a("a-form-item",{attrs:{label:"优惠券描述",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["description"],expression:"['description']"}],attrs:{autoSize:{minRows:4}}})],1),a("a-form-item",{staticClass:"mt-20",attrs:{"wrapper-col":{span:e.wrapperCol.span,offset:e.labelCol.span}}},[a("a-button",{attrs:{type:"primary","html-type":"submit",loading:e.isBtnLoading}},[e._v("提交")])],1)],1)],1)],1)},i=[],s=(t(28706),t(26099),t(95093)),n=t.n(s),o=t(20543),l=t(47695),u=t(28178),d={components:{SelectGoods:l.Ri,InputNumberGroup:l.tE},data:function(){return{ApplyRangeEnum:u.dw,CouponTypeEnum:u.kM,ExpireTypeEnum:u.HC,isLoading:!1,isBtnLoading:!1,labelCol:{span:3},wrapperCol:{span:10},form:this.$form.createForm(this),defaultDate:[n()(),n()()],defaultTime:[n()("00:00:00","HH:mm:ss"),n()("23:59:59","HH:mm:ss")],gainMethod:"manual",containGoodsList:[],expire_as_hour:!1}},created:function(){var e=this;this.$nextTick((function(){e.$forceUpdate()}))},methods:{handleSubmit:function(e){e.preventDefault();var a=this.form.validateFields,t=this.onFormSubmit;a((function(e,a){!e&&t(a)}))},onFormSubmit:function(e){var a=this;if(this.isLoading=!0,this.isBtnLoading=!0,e.expire_type==u.HC.RECEIVE.value){var t=this.expire_as_hour?e.expire_hour:e.expire_day;e.expires_from_gain="+".concat(t," ").concat(this.expire_as_hour?"hours":"days"),e.starts_from_gain=e.start_day?"+".concat(e.start_day," days"):null}else e.starts_at=e.betweenTime[0],e.expires_at=e.betweenTime[1];e.gain_from=e.gainBetween[0],e.gain_to=e.gainBetween[1],"situation"!=this.gainMethod&&(e.auto_gain_situation=null),o.WQ(e).then((function(e){a.$message.success("已添加",1.5),setTimeout((function(){a.$router.push("./index")}),1500)})).catch((function(){a.isBtnLoading=!1})).finally((function(e){a.isLoading=!1}))}}},c=d,m=t(81656),p=(0,m.A)(c,r,i,!1,null,"099a4724",null),v=p.exports},73083:function(e,a,t){t.r(a),t.d(a,{default:function(){return v}});t(62010),t(27495),t(5746);var r=function(){var e=this,a=e._self._c;return a("a-card",{attrs:{bordered:!1}},[a("div",{staticClass:"card-title"},[e._v(e._s(e.$route.meta.title))]),a("a-alert",{attrs:{message:"注：优惠券只能抵扣商品金额，最多优惠到0.01元，不能抵扣运费",banner:""}}),a("div",{staticClass:"table-operator"},[a("a-row",[a("a-col",{attrs:{span:6}},[e.$auth("vouchers.create")?a("a-button",{attrs:{type:"primary",icon:"plus"},on:{click:e.handleAdd}},[e._v("新增")]):e._e()],1),a("a-col",{attrs:{span:8,offset:10}},[a("a-input-search",{staticStyle:{"max-width":"300px","min-width":"150px",float:"right"},attrs:{placeholder:"请输入优惠券名称"},on:{search:e.onSearch},model:{value:e.queryParam.search,callback:function(a){e.$set(e.queryParam,"search",a)},expression:"queryParam.search"}})],1)],1)],1),a("s-table",{ref:"table",attrs:{rowKey:"id",loading:e.isLoading,columns:e.columns,data:e.loadData,pageSize:15},scopedSlots:e._u([{key:"type",fn:function(t){return[a("a-tag",[e._v(e._s(e.CouponTypeEnum[t].name))])]}},{key:"amount_limit",fn:function(t){return[a("p",{staticClass:"c-p"},[e._v(e._s(t))])]}},{key:"discount",fn:function(t){return["discount"==t.type?[a("span",[e._v("立减")]),a("span",{staticClass:"c-p mlr-2"},[e._v(e._s(t.save_amount))]),a("span",[e._v("元")])]:e._e(),"percent"==t.type?[a("span",[e._v("打")]),a("span",{staticClass:"c-p mlr-2"},[e._v(e._s(t.off_percent))]),a("span",[e._v("折")])]:e._e()]}},{key:"duetime",fn:function(t){return[t.expire_type==e.ExpireTypeEnum.RECEIVE.value?[a("span",[e._v("领取")]),a("span",{staticClass:"c-p mlr-2"},[e._v(e._s(t.expire_day))]),a("span",[e._v("天内有效")])]:e._e(),t.expire_type==e.ExpireTypeEnum.FIXED_TIME.value?[a("span",[e._v(e._s(t.start_time)+" ~ "+e._s(t.end_time))])]:e._e()]}},{key:"action",fn:function(t){return a("span",{staticClass:"actions"},[e.$auth("vouchers.update")?a("a",{on:{click:function(a){return e.handleEdit(t)}}},[e._v("编辑")]):e._e(),a("a",{directives:[{name:"action",rawName:"v-action:delete",arg:"delete"}],on:{click:function(a){return e.handleDelete(t)}}},[e._v("删除")])])}}])})],1)},i=[],s=t(57888),n=(t(26099),t(20543)),o=t(47695),l=t(28178),u=t(47026),d={name:"Index",components:{STable:o.Wd},data:function(){var e=this;return{queryParam:{area_id:u.A.getters.areaId},ApplyRangeEnum:l.dw,CouponTypeEnum:l.kM,ExpireTypeEnum:l.HC,isLoading:!1,columns:[{title:"优惠券ID",dataIndex:"id"},{title:"优惠券名称",dataIndex:"title"},{title:"优惠券类型",dataIndex:"type",scopedSlots:{customRender:"type"}},{title:"最低消费 (元)",dataIndex:"amount_limit",scopedSlots:{customRender:"amount_limit"}},{title:"优惠方式",scopedSlots:{customRender:"discount"}},{title:"已发放/领取数量",dataIndex:"gain_count"},{title:"添加时间",dataIndex:"created_at"},{title:"操作",width:"180px",scopedSlots:{customRender:"action"}}],loadData:function(a){return n.p_((0,s.A)((0,s.A)({},a),e.queryParam)).then((function(e){return e}))}}},created:function(){},methods:{handleAdd:function(){this.$router.push("./create")},handleEdit:function(e){this.$router.push({path:"./update",query:{couponId:e.id}})},handleDelete:function(e){var a=this,t=this.$confirm({title:"您确定要删除该记录吗?",content:"删除后不可恢复",onOk:function(){return n.KF({couponId:e.id}).then((function(e){a.$message.success(e.message,1.5),a.handleRefresh()})).finally((function(e){t.destroy()}))}})},handleRefresh:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.$refs.table.refresh(e)},onSearch:function(){this.handleRefresh(!0)}}},c=d,m=t(81656),p=(0,m.A)(c,r,i,!1,null,null,null),v=p.exports},7532:function(e,a,t){t.r(a),t.d(a,{default:function(){return p}});t(62010);var r=function(){var e=this,a=e._self._c;return a("a-card",{attrs:{bordered:!1}},[a("div",{staticClass:"card-title"},[e._v(e._s(e.$route.meta.title))]),a("div",{staticClass:"table-operator"},[a("a-row",{staticClass:"row-item-search"},[a("a-form",{staticClass:"search-form",attrs:{form:e.searchForm,layout:"inline"},on:{submit:e.handleSearch}},[a("a-form-item",{attrs:{label:"优惠券编号"}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["code"],expression:"['code']"}],attrs:{placeholder:"请输入优惠券名称"}})],1),a("a-form-item",{attrs:{label:"会员ID"}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["user_id"],expression:"['user_id']"}],attrs:{placeholder:"请输入会员ID"}})],1),a("a-form-item",{attrs:{label:"是否过期"}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["is_expired"],expression:"['is_expired']"}],attrs:{"default-value":null,placeholder:"筛选过期优惠券"}},[a("a-select-option",{attrs:{value:null}},[e._v("全部")]),a("a-select-option",{attrs:{value:!1}},[e._v("未过期")]),a("a-select-option",{attrs:{value:!0}},[e._v("已过期")])],1)],1),a("a-form-item",{attrs:{label:"领取时间"}},[a("a-range-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["created_between"],expression:"['created_between']"}],attrs:{format:"YYYY-MM-DD"}})],1),a("a-form-item",{staticClass:"search-btn"},[a("a-button",{attrs:{type:"primary",icon:"search","html-type":"submit"}},[e._v("搜索")])],1)],1)],1)],1),a("s-table",{ref:"table",attrs:{rowKey:"id",loading:e.isLoading,columns:e.columns,data:e.loadData,pageSize:15},scopedSlots:e._u([{key:"user",fn:function(e){return[a("UserItem",{attrs:{user:e}})]}},{key:"type",fn:function(t){return[a("a-tag",[e._v(e._s(e.CouponTypeEnum[t].name))])]}},{key:"min_price",fn:function(t){return[a("p",{staticClass:"c-p"},[e._v(e._s(t))])]}},{key:"discount",fn:function(t){return[t.type==e.CouponTypeEnum.FULL_DISCOUNT.value?[a("span",[e._v("立减")]),a("span",{staticClass:"c-p mlr-2"},[e._v(e._s(t.metadata.save_amount))]),a("span",[e._v("元")])]:e._e(),t.type==e.CouponTypeEnum.DISCOUNT.value?[a("span",[e._v("打")]),a("span",{staticClass:"c-p mlr-2"},[e._v(e._s(10*(1-t.metadata.off_percent)))]),a("span",[e._v("折")])]:e._e()]}},{key:"duetime",fn:function(t){return[t.expire_type==e.ExpireTypeEnum.RECEIVE.value?[a("span",[e._v("领取")]),a("span",{staticClass:"c-p mlr-2"},[e._v(e._s(t.expire_day))]),a("span",[e._v("天内有效")])]:e._e(),t.expire_type==e.ExpireTypeEnum.FIXED_TIME.value?[a("span",[e._v(e._s(t.start_time)+" ~ "+e._s(t.end_time))])]:e._e()]}}])})],1)},i=[],s=t(57888),n=t(20543),o=t(32664),l=t(28178),u={name:"Index",components:{STable:o.Wd,UserItem:o.Dn},data:function(){var e=this;return{searchForm:this.$form.createForm(this),queryParam:{},CouponTypeEnum:l.kM,isLoading:!1,columns:[{title:"ID",dataIndex:"id"},{title:"会员信息",dataIndex:"user",scopedSlots:{customRender:"user"}},{title:"优惠券码",dataIndex:"code"},{title:"优惠券类型",dataIndex:"type",scopedSlots:{customRender:"type"}},{title:"最低消费金额 (元)",dataIndex:"metadata.amount_limit",scopedSlots:{customRender:"min_price"}},{title:"优惠方式",scopedSlots:{customRender:"discount"}},{title:"有效期",dataIndex:"expires_at"},{title:"领取时间",dataIndex:"created_at"}],loadData:function(a){return n.uZ((0,s.A)((0,s.A)({},a),e.queryParam)).then((function(e){return e}))}}},created:function(){},methods:{handleRefresh:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.$refs.table.refresh(e)},handleSearch:function(e){var a=this;e.preventDefault(),this.searchForm.validateFields((function(e,t){e||(a.queryParam=(0,s.A)((0,s.A)({},a.queryParam),t),a.handleRefresh(!0))}))}}},d=u,c=t(81656),m=(0,c.A)(d,r,i,!1,null,null,null),p=m.exports},71195:function(e,a,t){t.r(a),t.d(a,{default:function(){return E}});var r=function(){var e=this,a=e._self._c;return a("a-card",{attrs:{bordered:!1}},[a("div",{staticClass:"card-title"},[e._v(e._s(e.$route.meta.title))]),a("a-spin",{attrs:{spinning:e.isLoading}},[a("a-form",{attrs:{form:e.form},on:{submit:e.handleSubmit}},[a("a-form-item",{attrs:{label:"优惠券名称",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["title",{rules:[{required:!0,min:2,message:"请输入至少2个字符"}]}],expression:"['title', { rules: [{ required: true, min: 2, message: '请输入至少2个字符' }] }]"}],attrs:{placeholder:"请输入优惠券名称"}})],1),a("a-form-item",{attrs:{label:"优惠券类型",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["type",{initialValue:"discount",rules:[{required:!0}]}],expression:"['type', { initialValue: 'discount', rules: [{ required: true }] }]"}]},[a("a-radio",{attrs:{value:"discount"}},[e._v("满减券")]),a("a-radio",{attrs:{value:"percent"}},[e._v("折扣券")])],1)],1),a("a-form-item",{directives:[{name:"show",rawName:"v-show",value:e.form.getFieldValue("type")==e.CouponTypeEnum.FULL_DISCOUNT.value,expression:"form.getFieldValue('type') == CouponTypeEnum.FULL_DISCOUNT.value"}],attrs:{label:"减免金额",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["save_amount",{rules:[{required:e.form.getFieldValue("type")==e.CouponTypeEnum.FULL_DISCOUNT.value,message:"请输入减免金额"}]}],expression:"['save_amount', { rules: [{ required: form.getFieldValue('type') == CouponTypeEnum.FULL_DISCOUNT.value, message: '请输入减免金额' }] }]"}],attrs:{min:.01,precision:2}}),a("span",{staticClass:"ml-5"},[e._v("元")])],1),a("a-form-item",{directives:[{name:"show",rawName:"v-show",value:e.form.getFieldValue("type")==e.CouponTypeEnum.DISCOUNT.value,expression:"form.getFieldValue('type') == CouponTypeEnum.DISCOUNT.value"}],attrs:{label:"折扣率",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["off_percent",{initialValue:0,rules:[{required:e.form.getFieldValue("type")==e.CouponTypeEnum.DISCOUNT.value,message:"请输入折扣率"}]}],expression:"['off_percent', { initialValue: 0, rules: [{ required: form.getFieldValue('type') == CouponTypeEnum.DISCOUNT.value, message: '请输入折扣率' }] }]"}],attrs:{min:0,max:1,precision:2,step:.05}}),a("p",{staticClass:"form-item-help"},[a("small",[e._v("折扣率范围 0-0.99，0.2代表打8折，0代表不折扣")])])],1),a("a-form-item",{attrs:{label:"最低消费金额",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["amount_limit",{rules:[{required:!0,message:"请输入最低消费金额"}]}],expression:"['amount_limit', { rules: [{ required: true, message: '请输入最低消费金额' }] }]"}],attrs:{min:.01,precision:2}}),a("span",{staticClass:"ml-5"},[e._v("元")])],1),a("a-form-item",{attrs:{label:"到期类型",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["expire_type",{initialValue:e.ExpireTypeEnum.RECEIVE.value,rules:[{required:!0}]}],expression:"['expire_type', { initialValue: ExpireTypeEnum.RECEIVE.value, rules: [{ required: true }] }]"}]},[a("a-radio",{attrs:{value:e.ExpireTypeEnum.RECEIVE.value}},[e._v("领取后生效")]),a("a-radio",{attrs:{value:e.ExpireTypeEnum.FIXED_TIME.value}},[e._v("固定生效时段")])],1),a("a-form-item",{directives:[{name:"show",rawName:"v-show",value:e.form.getFieldValue("expire_type")==e.ExpireTypeEnum.RECEIVE.value,expression:"form.getFieldValue('expire_type') == ExpireTypeEnum.RECEIVE.value"}],staticClass:"expire_type-10"},[a("InputNumberGroup",{directives:[{name:"decorator",rawName:"v-decorator",value:["start_day",{initialValue:0,rules:[{required:!0,message:"请输入自领取起几天后开始生效"}]}],expression:"['start_day', { initialValue: 0, rules: [{ required: true, message: '请输入自领取起几天后开始生效' }] }]"}],attrs:{addonBefore:"生效于",addonAfter:"天后",inputProps:{min:0,precision:0}}}),a("InputNumberGroup",{directives:[{name:"show",rawName:"v-show",value:!e.expire_as_hour,expression:"!expire_as_hour"},{name:"decorator",rawName:"v-decorator",value:["expire_day",{initialValue:7,rules:[{required:!0,message:"请输入自领取起有效天数"}]}],expression:"['expire_day', { initialValue: 7, rules: [{ required: true, message: '请输入自领取起有效天数' }] }]"}],attrs:{addonBefore:"有效期",addonAfter:"天",inputProps:{min:1,precision:0}}}),a("InputNumberGroup",{directives:[{name:"show",rawName:"v-show",value:e.expire_as_hour,expression:"expire_as_hour"},{name:"decorator",rawName:"v-decorator",value:["expire_hour",{initialValue:3,rules:[{required:!0,message:"请输入自领取起有效小时数"}]}],expression:"['expire_hour', { initialValue: 3, rules: [{ required: true, message: '请输入自领取起有效小时数' }] }]"}],attrs:{addonBefore:"有效期",addonAfter:"小时",inputProps:{min:1,precision:0}}}),a("a",{on:{click:function(a){e.expire_as_hour=!e.expire_as_hour}}},[e._v("切换")])],1),a("a-form-item",{directives:[{name:"show",rawName:"v-show",value:e.form.getFieldValue("expire_type")==e.ExpireTypeEnum.FIXED_TIME.value,expression:"form.getFieldValue('expire_type') == ExpireTypeEnum.FIXED_TIME.value"}],staticClass:"expire_type-20"},[a("a-range-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["betweenTime",{initialValue:e.defaultDate,rules:[{required:!0,message:"请选择有效期范围"}]}],expression:"['betweenTime', { initialValue: defaultDate, rules: [{ required: true, message: '请选择有效期范围' }] }]"}],attrs:{"show-time":{hideDisabledOptions:!0,defaultValue:e.defaultTime},valueFormat:"YYYY-MM-DD HH:mm:ss"}})],1)],1),a("a-form-item",{attrs:{label:"限时领取",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-range-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["gainBetween",{initialValue:["",""]}],expression:"['gainBetween', { initialValue: ['',''] }]"}],attrs:{"show-time":{defaultValue:e.defaultTime},valueFormat:"YYYY-MM-DD HH:mm:ss"}})],1),a("a-form-item",{attrs:{label:"领取方式",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-radio-group",{model:{value:e.gainMethod,callback:function(a){e.gainMethod=a},expression:"gainMethod"}},[a("a-radio",{attrs:{value:"manual"}},[e._v("用户手动领取")]),a("a-radio",{attrs:{value:"situation"}},[e._v("场景自动获得")])],1),a("a-select",{directives:[{name:"show",rawName:"v-show",value:"situation"==e.gainMethod,expression:"gainMethod == 'situation'"},{name:"decorator",rawName:"v-decorator",value:["auto_gain_situation",{initialValue:"after_launching"}],expression:"['auto_gain_situation', { initialValue: 'after_launching' }]"}],staticStyle:{width:"150px"},attrs:{placeholder:"请选择自动触发领取的场景"}},[a("a-select-option",{attrs:{value:"after_launching"}},[e._v("App启动时")]),a("a-select-option",{attrs:{value:"after_new_order"}},[e._v("线上下单后")]),a("a-select-option",{attrs:{value:"after_new_ontheway"}},[e._v("顺路单下单后")]),a("a-select-option",{attrs:{value:"after_registered"}},[e._v("新用户")]),a("a-select-option",{attrs:{value:"after_registered_2_day"}},[e._v("新用户次日")]),a("a-select-option",{attrs:{value:"after_registered_3_day"}},[e._v("新用户第3天")]),a("a-select-option",{attrs:{value:"after_registered_4_day"}},[e._v("新用户第4天")]),a("a-select-option",{attrs:{value:"after_registered_5_day"}},[e._v("新用户第5天")]),a("a-select-option",{attrs:{value:"after_registered_6_day"}},[e._v("新用户第6天")]),a("a-select-option",{attrs:{value:"after_registered_7_day"}},[e._v("新用户第7天")]),a("a-select-option",{attrs:{value:"after_first_referred"}},[e._v("推荐首个新用户")]),a("a-select-option",{attrs:{value:"after_referred"}},[e._v("推荐每个新用户")]),a("a-select-option",{attrs:{value:"after_referred_first_order"}},[e._v("推荐注册完成下单")])],1)],1),a("a-form-item",{attrs:{label:"领取条件",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["condition.user_tag_ids"],expression:"['condition.user_tag_ids']"}],attrs:{mode:"multiple",placeholder:"请选择可领取用户的标签",allowClear:"",dropdownStyle:{maxHeight:"300px",overflow:"auto"},options:e.tagList,"filter-option":!1},on:{search:e.searchTags,blur:e.blurTags}}),a("InputNumberGroup",{directives:[{name:"decorator",rawName:"v-decorator",value:["max_gain_per_user",{initialValue:3}],expression:"['max_gain_per_user', { initialValue: 3}]"}],attrs:{addonBefore:"每用户最多领取",addonAfter:"张",inputProps:{min:-1,precision:0}}}),a("span",{staticClass:"ant-input-group-wrapper",staticStyle:{width:"auto"}},[a("span",{staticClass:"ant-input-wrapper ant-input-group"},[a("span",{staticClass:"ant-input-group-addon"},[e._v("每")]),a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["limit_once_every"],expression:"['limit_once_every']"}],staticStyle:{width:"150px"},attrs:{placeholder:"限制每xx时段领取一张"}},[a("a-select-option",{attrs:{value:"day"}},[e._v("天")]),a("a-select-option",{attrs:{value:"week"}},[e._v("周")]),a("a-select-option",{attrs:{value:"month"}},[e._v("月")]),a("a-select-option",{attrs:{value:null}},[e._v("不限")])],1),a("span",{staticClass:"ant-input-group-addon"},[e._v("限领取一张")])],1)])],1),a("a-form-item",{attrs:{label:"券适用范围",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["apply_range",{initialValue:10,rules:[{required:!0}]}],expression:"['apply_range', { initialValue: 10, rules: [{ required: true }] }]"}]},[a("a-radio",{attrs:{value:10}},[e._v("全场通用")]),a("a-radio",{attrs:{value:20}},[e._v("指定商品")]),a("a-radio",{attrs:{value:30}},[e._v("排除商品")])],1),a("a-form-item",{directives:[{name:"show",rawName:"v-show",value:20==e.form.getFieldValue("apply_range"),expression:"form.getFieldValue('apply_range') == 20"}]},[a("a-tree-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["categorys",{rules:[{required:!1,message:"请至少选择1个商品分类"}]}],expression:"['categorys', { rules: [{required: false, message: '请至少选择1个商品分类'}]}]"}],attrs:{placeholder:"请选择指定的商品分类",dropdownStyle:{maxHeight:"500px",overflow:"auto"},treeData:e.categoryList,treeCheckable:"",treeCheckStrictly:"",allowClear:""}}),a("SelectGoods",{directives:[{name:"decorator",rawName:"v-decorator",value:["include_product_ids",{rules:[{required:!1,message:"请选择指定的商品"}]}],expression:"['include_product_ids', { rules: [{ required: false, message: '请选择指定的商品' }] }]"}],attrs:{defaultList:e.containGoodsList}})],1),a("a-form-item",{directives:[{name:"show",rawName:"v-show",value:30==e.form.getFieldValue("apply_range"),expression:"form.getFieldValue('apply_range') == 30"}]},[a("a-tree-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["exclude_categorys",{rules:[{required:!1,message:"请至少选择1个商品分类"}]}],expression:"['exclude_categorys', { rules: [{required: false, message: '请至少选择1个商品分类'}]}]"}],attrs:{placeholder:"请选择排除的商品分类",dropdownStyle:{maxHeight:"500px",overflow:"auto"},treeData:e.categoryList,treeCheckable:"",treeCheckStrictly:"",allowClear:""}}),a("SelectGoods",{directives:[{name:"decorator",rawName:"v-decorator",value:["exclude_product_ids",{rules:[{required:!1,message:"请选择排除的商品"}]}],expression:"['exclude_product_ids', { rules: [{ required: false, message: '请选择排除的商品' }] }]"}],attrs:{defaultList:e.excludeGoodsList}})],1)],1),a("a-form-item",{attrs:{label:"发放总数量",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["max_gain",{initialValue:-1,rules:[{required:!0,message:"请输入发放总数量"}]}],expression:"['max_gain', { initialValue: -1, rules: [{ required: true, message: '请输入发放总数量' }] }]"}],attrs:{min:-1,precision:0}}),a("span",{staticClass:"ml-5"},[e._v("张")]),a("p",{staticClass:"form-item-help"},[a("small",[e._v("发放的优惠券总数量，-1为不限制")])])],1),a("a-form-item",{attrs:{label:"优惠券描述",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["description"],expression:"['description']"}],attrs:{autoSize:{minRows:4}}})],1),a("a-form-item",{staticClass:"mt-20",attrs:{"wrapper-col":{span:e.wrapperCol.span,offset:e.labelCol.span}}},[a("a-button",{attrs:{type:"primary","html-type":"submit",loading:e.isBtnLoading}},[e._v("提交")])],1)],1)],1)],1)},i=[],s=t(69870),n=t(9133),o=t(17654),l=(t(28706),t(2008),t(50113),t(62062),t(62010),t(26099),t(95093)),u=t.n(l),d=t(2543),c=t(20543),m=t(5893),p=t(26222),v={list:"/tags",add:"/tags/add",edit:"/tags/edit",delete:"/tags/delete"};function _(e){return(0,p.p)({url:v.list,method:"get",params:e})}var f=t(61145),h=t(47695),g=t(28178),w=t(90667),C={components:{SelectGoods:h.Ri,InputNumberGroup:h.tE},data:function(){return{ApplyRangeEnum:g.dw,CouponTypeEnum:g.kM,ExpireTypeEnum:g.HC,isLoading:!1,isBtnLoading:!1,labelCol:{span:3},wrapperCol:{span:10},form:this.$form.createForm(this),categoryList:[],tagList:[],tagListFirstPage:[],defaultDate:[u()(),u()()],defaultTime:[u()("00:00:00","HH:mm:ss"),u()("23:59:59","HH:mm:ss")],gainMethod:"manual",couponId:null,record:{},containGoodsList:[],excludeGoodsList:[],expire_as_hour:!1}},created:function(){var e=this;return(0,o.A)((0,s.A)().mark((function a(){var t;return(0,s.A)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return e.couponId=e.$route.query.couponId,a.next=3,e.getDetail();case 3:return a.next=5,e.getContainGoodsList();case 5:return a.next=7,e.getExcludeGoodsList();case 7:return a.next=9,w.A.getCategoryTreeSelect();case 9:return e.categoryList=a.sent,a.next=12,_({per_page:99});case 12:t=a.sent,e.tagList=t.data.map((function(e){return{label:e.name,value:e.id}})),e.tagListFirstPage=(0,n.A)(e.tagList);case 15:case"end":return a.stop()}}),a)})))()},methods:{getDetail:function(){var e=this;return(0,o.A)((0,s.A)().mark((function a(){var t;return(0,s.A)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t=e.couponId,e.isLoading=!0,a.next=4,c._0(t).then((function(a){e.record=a,e.setFieldsValue()})).finally((function(){e.isLoading=!1}));case 4:case"end":return a.stop()}}),a)})))()},getContainGoodsList:function(){var e=this;return(0,o.A)((0,s.A)().mark((function a(){var t,r;return(0,s.A)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(t=e.record,r=t.valid_entities.filter((function(e){return"App\\Models\\Product"==e.entity_type&&!e.is_excluded})).map((function(e){return e.entity_id})),void 0===r||!r.length){a.next=6;break}return e.isLoading=!0,a.next=6,m.eV(r).then((function(a){e.containGoodsList=a.data})).finally((function(a){e.isLoading=!1}));case 6:case"end":return a.stop()}}),a)})))()},getExcludeGoodsList:function(){var e=this;return(0,o.A)((0,s.A)().mark((function a(){var t,r;return(0,s.A)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(t=e.record,r=t.valid_entities.filter((function(e){return"App\\Models\\Product"==e.entity_type&&e.is_excluded})).map((function(e){return e.entity_id})),void 0===r||!r.length){a.next=6;break}return e.isLoading=!0,a.next=6,m.eV(r).then((function(a){e.excludeGoodsList=a.data})).finally((function(a){e.isLoading=!1}));case 6:case"end":return a.stop()}}),a)})))()},setFieldsValue:function(){var e=this,a=this.record,t=this.form,r=this.$nextTick;!(0,f.Im)(t.getFieldsValue())&&r((function(){var r=(0,d.pick)(a,["title","type","save_amount","off_percent","amount_limit","auto_gain_situation","expire_type","expires_from_gain","apply_range","max_gain","max_gain_per_user","limit_once_every","description"]);e.expire_as_hour=-1!=r.expires_from_gain.indexOf("hour"),r.expires_from_gain&&e.expire_as_hour?r.expire_hour=parseInt(a.expires_from_gain):r.expire_day=parseInt(a.expires_from_gain)||0,r.start_day=parseInt(a.starts_from_gain)||0,r.betweenTime=e.getBetweenTime(a.starts_at,a.expires_at),r.gainBetween=e.getBetweenTime(a.gain_from,a.gain_to),e.gainMethod=a.auto_gain_situation?"situation":"manual",r.condition=a.conditions.find((function(e){return"first"}))||{},r.condition.user_tag_ids=a.conditions.filter((function(e){return"App\\Models\\Tag"==e.condition_type})).map((function(e){return e.condition_id})),r.apply_range=a.valid_entities.filter((function(e){return e.is_excluded})).length?30:a.valid_entities.length?20:10,r.categorys=a.valid_entities.filter((function(e){return"Rinvex\\Categories\\Models\\Category"==e.entity_type&&!e.is_excluded})).map((function(e){return{value:e.entity_id}})),r.exclude_categorys=a.valid_entities.filter((function(e){return"Rinvex\\Categories\\Models\\Category"==e.entity_type&&e.is_excluded})).map((function(e){return{value:e.entity_id}})),t.setFieldsValue(r)}))},getBetweenTime:function(e,a){return[e?u()(new Date(e)):null,a?u()(new Date(a)):null]},searchTags:function(e){var a=this;return(0,o.A)((0,s.A)().mark((function t(){var r;return(0,s.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,_({name:e,per_page:99});case 2:r=t.sent,a.tagList=(0,n.A)(r.data.map((function(e){return{label:e.name,value:e.id}})));case 4:case"end":return t.stop()}}),t)})))()},blurTags:function(){this.tagList=(0,n.A)(this.tagListFirstPage)},handleSubmit:function(e){e.preventDefault();var a=this.form.validateFields,t=this.onFormSubmit;a((function(e,a){!e&&t(a)}))},onFormSubmit:function(e){var a,t=this;if(this.isLoading=!0,this.isBtnLoading=!0,e.off_percent||delete e.off_percent,e.expire_type==g.HC.RECEIVE.value){var r=this.expire_as_hour?e.expire_hour:e.expire_day;e.expires_from_gain="+".concat(r," ").concat(this.expire_as_hour?"hours":"days"),e.starts_from_gain=e.start_day?"+".concat(e.start_day," days"):""}else e.starts_at=e.betweenTime[0],e.expires_at=e.betweenTime[1];e.gain_from=e.gainBetween[0],e.gain_to=e.gainBetween[1],"situation"!=this.gainMethod&&(e.auto_gain_situation=null),30==e.apply_range?e.exclude_category_ids=e.exclude_categorys?e.exclude_categorys.map((function(e){return e.value})):"":20==e.apply_range?(e.include_category_ids=e.categorys?e.categorys.map((function(e){return e.value})):"",e.exclude_product_ids="",e.exclude_category_ids=""):(e.include_product_ids="",e.include_category_ids="");var i=function(a){c.hc(t.couponId,e).then((function(e){t.$message.success("更新成功",1.5),setTimeout((function(){t.$router.push("./index")}),1500)})).catch((function(){t.isBtnLoading=!1})).finally((function(e){t.isLoading=!1}))};null!==(a=e.condition)&&void 0!==a&&null!==(a=a.user_tag_ids)&&void 0!==a&&a.length?c.Nc(this.couponId,e.condition).then(i).catch((function(e){t.$message.error(e.msg,3),t.isBtnLoading=!1,t.isLoading=!1})):c.zO(this.couponId,e).then(i).catch((function(e){t.$message.error(e.msg,3),t.isBtnLoading=!1,t.isLoading=!1}))}}},b=C,x=t(81656),y=(0,x.A)(b,r,i,!1,null,"4cbb5000",null),E=y.exports},30129:function(e,a,t){t.r(a),t.d(a,{default:function(){return _}});var r=function(){var e=this,a=e._self._c;return a("a-card",{attrs:{bordered:!1}},[a("div",{staticClass:"card-title"},[e._v(e._s(e.$route.meta.title))]),a("div",{staticClass:"table-operator"},[a("a-row",{staticClass:"row-item-search"},[a("a-form",{staticClass:"search-form",attrs:{form:e.searchForm,layout:"inline"},on:{submit:e.handleSearch}},[a("a-form-item",{attrs:{label:"会员昵称"}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["search"],expression:"['search']"}],attrs:{placeholder:"请输入会员昵称"}})],1),a("a-form-item",{attrs:{label:"变动时间"}},[a("a-range-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["betweenTime"],expression:"['betweenTime']"}],attrs:{format:"YYYY-MM-DD"}})],1),a("a-form-item",{staticClass:"search-btn"},[a("a-button",{attrs:{type:"primary",icon:"search","html-type":"submit"}},[e._v("搜索")])],1)],1)],1)],1),a("s-table",{ref:"table",attrs:{rowKey:"log_id",loading:e.isLoading,columns:e.columns,data:e.loadData,pageSize:15},scopedSlots:e._u([{key:"user",fn:function(e){return a("span",{},[a("UserItem",{attrs:{user:e}})],1)}},{key:"value",fn:function(t){return a("span",{},[a("p",{staticClass:"c-p"},[e._v(e._s(t>0?"+":"")+e._s(t))])])}}])})],1)},i=[],s=t(57888),n=t(26222),o={log:"/market.points/log"};function l(e){return(0,n.p)({url:o.log,method:"get",params:e})}var u=t(32664),d=t(93901),c={name:"Index",components:{STable:u.Wd,UserItem:u.Dn},data:function(){var e=this;return{SceneEnum:d.A,searchForm:this.$form.createForm(this),queryParam:{},isLoading:!1,columns:[{title:"ID",dataIndex:"log_id"},{title:"会员信息",dataIndex:"user",scopedSlots:{customRender:"user"}},{title:"变动数量",dataIndex:"value",scopedSlots:{customRender:"value"}},{title:"描述/说明",dataIndex:"describe"},{title:"管理员备注",dataIndex:"remark"},{title:"变动时间",dataIndex:"create_time"}],loadData:function(a){return l((0,s.A)((0,s.A)({},a),e.queryParam)).then((function(e){return e.data.list}))}}},created:function(){},methods:{handleRefresh:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.$refs.table.refresh(e)},handleSearch:function(e){var a=this;e.preventDefault(),this.searchForm.validateFields((function(e,t){e||(a.queryParam=(0,s.A)((0,s.A)({},a.queryParam),t),a.handleRefresh(!0))}))}}},m=c,p=t(81656),v=(0,p.A)(m,r,i,!1,null,"0d4db7ff",null),_=v.exports},17901:function(e,a,t){t.r(a),t.d(a,{default:function(){return p}});var r=function(){var e=this,a=e._self._c;return a("a-card",{attrs:{bordered:!1}},[a("div",{staticClass:"card-title"},[e._v(e._s(e.$route.meta.title))]),a("a-spin",{attrs:{spinning:e.isLoading}},[a("a-form",{attrs:{form:e.form},on:{submit:e.handleSubmit}},[a("a-form-item",{attrs:{label:"积分名称",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["points_name",{rules:[{required:!0,message:"请输入积分名称"}]}],expression:"['points_name', { rules: [{ required: true, message: '请输入积分名称' }] }]"}]}),a("div",{staticClass:"form-item-help"},[a("small",[e._v("注：商家使用自定义的积分名称来做品牌运营。如京东把积分称为“京豆”，淘宝把积分称为“淘金币”")])])],1),a("a-form-item",{attrs:{label:"积分说明",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["describe",{rules:[{required:!0,message:"请输入积分说明"}]}],expression:"['describe', { rules: [{ required: true, message: '请输入积分说明' }] }]"}],attrs:{autoSize:{minRows:4}}})],1),a("a-divider",{attrs:{orientation:"left"}},[e._v("积分赠送")]),a("a-form-item",{attrs:{label:"购物送积分",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["is_shopping_gift",{initialValue:1,rules:[{required:!0}]}],expression:"['is_shopping_gift', { initialValue: 1, rules: [{ required: true }] }]"}]},[a("a-radio",{attrs:{value:1}},[e._v("开启")]),a("a-radio",{attrs:{value:0}},[e._v("关闭")])],1),a("div",{staticClass:"form-item-help"},[a("small",[e._v("积分赠送规则：1. 订单确认收货已完成； 2. 已完成订单超出后台设置的申请售后期限")])])],1),a("div",{directives:[{name:"show",rawName:"v-show",value:1==e.form.getFieldValue("is_shopping_gift"),expression:"form.getFieldValue('is_shopping_gift') == 1"}]},[a("a-form-item",{attrs:{label:"积分赠送比例",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["gift_ratio",{rules:[{required:!0,message:"请输入积分赠送比例"}]}],expression:"['gift_ratio', { rules: [{ required: true, message: '请输入积分赠送比例' }] }]"}],attrs:{min:.1,max:100,precision:1}}),a("span",{staticClass:"ml-10"},[e._v("%")]),a("div",{staticClass:"form-item-help"},[a("p",{staticClass:"extra"},[e._v("注：赠送比例请填写数字0~100；订单的运费不参与积分赠送")]),a("p",{staticClass:"extra"},[e._v("例：订单付款金额(100.00元) * 积分赠送比例(100%) = 实际赠送的积分(100积分)")])])],1)],1),a("a-divider",{attrs:{orientation:"left"}},[e._v("积分抵扣")]),a("a-form-item",{attrs:{label:"下单使用积分抵扣",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["is_shopping_discount",{initialValue:1,rules:[{required:!0}]}],expression:"['is_shopping_discount', { initialValue: 1, rules: [{ required: true }] }]"}]},[a("a-radio",{attrs:{value:1}},[e._v("开启")]),a("a-radio",{attrs:{value:0}},[e._v("关闭")])],1),a("div",{staticClass:"form-item-help"},[a("small",[e._v("注：如开启则用户下单时可选择使用积分抵扣订单金额")])])],1),a("div",{directives:[{name:"show",rawName:"v-show",value:1==e.form.getFieldValue("is_shopping_discount"),expression:"form.getFieldValue('is_shopping_discount') == 1"}]},[a("a-form-item",{attrs:{label:"积分抵扣比例",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("InputNumberGroup",{directives:[{name:"decorator",rawName:"v-decorator",value:["discount.discount_ratio",{rules:[{required:!0,message:"积分抵扣比例不能为空"}]}],expression:"['discount.discount_ratio', { rules: [{ required: true, message: '积分抵扣比例不能为空' }] }]"}],attrs:{addonBefore:"1个积分可抵扣",addonAfter:"元",inputProps:{min:.01,precision:2}}}),a("div",{staticClass:"form-item-help"},[a("small",[e._v("例如：设置1个积分可抵扣0.1元，则10积分可抵扣1元，100积分可抵扣10元")])])],1),a("a-form-item",{attrs:{label:"最高可抵扣金额",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-form-item",[a("InputNumberGroup",{directives:[{name:"decorator",rawName:"v-decorator",value:["discount.full_order_price",{rules:[{required:!0,message:"抵扣条件不能为空"}]}],expression:"['discount.full_order_price', { rules: [{ required: true, message: '抵扣条件不能为空' }] }]"}],attrs:{addonBefore:"订单满",addonAfter:"元",inputProps:{min:.01,precision:2}}})],1),a("a-form-item",[a("InputNumberGroup",{directives:[{name:"decorator",rawName:"v-decorator",value:["discount.max_money_ratio",{rules:[{required:!0,message:"最高可抵扣金额不能为空"}]}],expression:"['discount.max_money_ratio', { rules: [{ required: true, message: '最高可抵扣金额不能为空' }] }]"}],attrs:{addonBefore:"最高可抵扣金额",addonAfter:"%",inputProps:{min:.1,max:90,precision:1}}}),a("div",{staticClass:"form-item-help"},[a("small",[e._v("例如：设置最高可抵扣10%，订单金额100元，此时用户可抵扣10元")])])],1)],1)],1),a("a-form-item",{attrs:{"wrapper-col":{span:e.wrapperCol.span,offset:e.labelCol.span}}},[a("a-button",{attrs:{type:"primary","html-type":"submit"}},[e._v("提交")])],1)],1)],1)],1)},i=[],s=(t(26099),t(62953),t(91863)),n=t.n(s),o=t(25962),l=t(47695),u={components:{InputNumberGroup:l.tE},data:function(){return{key:"points",labelCol:{span:4},wrapperCol:{span:10},isLoading:!1,form:this.$form.createForm(this),record:{}}},created:function(){this.getDetail()},methods:{getDetail:function(){var e=this;this.isLoading=!0,o._(this.key).then((function(a){e.record=a.data.values,e.setFieldsValue()})).finally((function(a){e.isLoading=!1}))},setFieldsValue:function(){var e=this.record,a=this.$nextTick,t=this.form.setFieldsValue;a((function(){t(n()(e,["points_name","describe","is_shopping_gift","gift_ratio","is_shopping_discount","discount"]))}))},handleSubmit:function(e){var a=this;e.preventDefault();var t=this.form.validateFields;t((function(e,t){!e&&a.onFormSubmit(t)}))},onFormSubmit:function(e){var a=this;this.isLoading=!0,o.y(this.key,{form:e}).then((function(e){a.$message.success(e.message,1.5)})).finally((function(e){a.isLoading=!1}))}}},d=u,c=t(81656),m=(0,c.A)(d,r,i,!1,null,"c1674690",null),p=m.exports},14182:function(e,a,t){t.r(a),t.d(a,{default:function(){return m}});var r=function(){var e=this,a=e._self._c;return a("a-card",{attrs:{bordered:!1}},[a("div",{staticClass:"card-title"},[e._v(e._s(e.$route.meta.title))]),a("a-spin",{attrs:{spinning:e.isLoading}},[a("a-form",{attrs:{form:e.form},on:{submit:e.handleSubmit}},[a("a-form-item",{attrs:{label:"是否开启会员充值",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["is_entrance",{rules:[{required:!0}]}],expression:"['is_entrance', { rules: [{ required: true }] }]"}]},[a("a-radio",{attrs:{value:1}},[e._v("开启")]),a("a-radio",{attrs:{value:0}},[e._v("关闭")])],1),a("div",{staticClass:"form-item-help"},[a("small",[e._v("如设置关闭则用户端不显示充值按钮")])])],1),a("a-form-item",{attrs:{label:"充值自定义金额",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["is_custom",{rules:[{required:!0}]}],expression:"['is_custom', { rules: [{ required: true }] }]"}]},[a("a-radio",{attrs:{value:1}},[e._v("允许")]),a("a-radio",{attrs:{value:0}},[e._v("不允许")])],1),a("div",{staticClass:"form-item-help"},[a("small",[e._v("是否允许用户填写自定义的充值金额")])])],1),a("a-form-item",{directives:[{name:"show",rawName:"v-show",value:1==e.form.getFieldValue("is_custom"),expression:"form.getFieldValue('is_custom') == 1"}],attrs:{label:"最低充值金额",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["lowest_money",{rules:[{required:!0,message:"请输入最低充值金额"}]}],expression:"['lowest_money', { rules: [{ required: true, message: '请输入最低充值金额' }] }]"}],attrs:{min:.01,precision:2}}),a("span",{staticClass:"ml-10"},[e._v("元")]),a("div",{staticClass:"form-item-help"},[a("small",[e._v("低于该设定金额时不允许充值")])])],1),a("a-form-item",{attrs:{label:"自动匹配套餐",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["is_match_plan",{rules:[{required:!0}]}],expression:"['is_match_plan', { rules: [{ required: true }] }]"}]},[a("a-radio",{attrs:{value:1}},[e._v("开启")]),a("a-radio",{attrs:{value:0}},[e._v("关闭")])],1),a("div",{staticClass:"form-item-help"},[a("small",[e._v("充值自定义金额时 是否自动匹配充值套餐，如不开启则不参与套餐金额赠送")])])],1),a("a-form-item",{attrs:{label:"充值说明",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["describe",{rules:[{required:!0,message:"请输入充值说明"}]}],expression:"['describe', { rules: [{ required: true, message: '请输入充值说明' }] }]"}],attrs:{autoSize:{minRows:4}}})],1),a("a-form-item",{attrs:{"wrapper-col":{span:e.wrapperCol.span,offset:e.labelCol.span}}},[a("a-button",{attrs:{type:"primary","html-type":"submit"}},[e._v("提交")])],1)],1)],1)],1)},i=[],s=(t(26099),t(62953),t(91863)),n=t.n(s),o=t(25962),l={components:{},data:function(){return{key:"recharge",labelCol:{span:4},wrapperCol:{span:10},isLoading:!1,form:this.$form.createForm(this),record:{}}},created:function(){this.getDetail()},methods:{getDetail:function(){var e=this;this.isLoading=!0,o._(this.key).then((function(a){e.record=a.data.values,e.setFieldsValue()})).finally((function(a){e.isLoading=!1}))},setFieldsValue:function(){var e=this.record,a=this.$nextTick,t=this.form.setFieldsValue;a((function(){t(n()(e,["is_entrance","is_custom","lowest_money","is_match_plan","describe"]))}))},handleSubmit:function(e){var a=this;e.preventDefault();var t=this.form.validateFields;t((function(e,t){!e&&a.onFormSubmit(t)}))},onFormSubmit:function(e){var a=this;this.isLoading=!0,o.y(this.key,{form:e}).then((function(e){a.$message.success(e.message,1.5)})).finally((function(e){a.isLoading=!1}))}}},u=l,d=t(81656),c=(0,d.A)(u,r,i,!1,null,"65eaa220",null),m=c.exports},22314:function(e,a,t){t.r(a),t.d(a,{default:function(){return A}});t(27495),t(5746);var r=function(){var e=this,a=e._self._c;return a("a-card",{attrs:{bordered:!1}},[a("div",{staticClass:"card-title"},[e._v(e._s(e.$route.meta.title))]),a("div",{staticClass:"table-operator"},[a("a-row",[a("a-col",{attrs:{span:6}},[a("a-button",{directives:[{name:"action",rawName:"v-action:create",arg:"create"}],attrs:{type:"primary",icon:"plus"},on:{click:e.handleAdd}},[e._v("新增")])],1),a("a-col",{attrs:{span:8,offset:10}},[a("a-input-search",{staticStyle:{"max-width":"300px","min-width":"150px",float:"right"},attrs:{placeholder:"请输入套餐名称"},on:{search:e.onSearch},model:{value:e.queryParam.search,callback:function(a){e.$set(e.queryParam,"search",a)},expression:"queryParam.search"}})],1)],1)],1),a("s-table",{ref:"table",attrs:{rowKey:"plan_id",loading:e.isLoading,columns:e.columns,data:e.loadData,pageSize:15},scopedSlots:e._u([{key:"money",fn:function(t){return a("span",{},[a("p",{staticClass:"c-p"},[e._v(e._s(t))])])}},{key:"gift_money",fn:function(t){return a("span",{},[a("p",{staticClass:"c-p"},[e._v(e._s(t))])])}},{key:"action",fn:function(t,r){return a("span",{},[a("a",{directives:[{name:"action",rawName:"v-action:update",arg:"update"}],staticStyle:{"margin-right":"8px"},on:{click:function(a){return e.handleEdit(r)}}},[e._v("编辑")]),a("a",{directives:[{name:"action",rawName:"v-action:delete",arg:"delete"}],on:{click:function(a){return e.handleDelete(r)}}},[e._v("删除")])])}}])}),a("AddForm",{ref:"AddForm",on:{handleSubmit:e.handleRefresh}}),a("EditForm",{ref:"EditForm",on:{handleSubmit:e.handleRefresh}})],1)},i=[],s=t(57888),n=(t(26099),t(26222)),o={list:"/market.recharge.plan/list",add:"/market.recharge.plan/add",edit:"/market.recharge.plan/edit",delete:"/market.recharge.plan/delete"};function l(e){return(0,n.p)({url:o.list,method:"get",params:e})}function u(e){return(0,n.p)({url:o.add,method:"post",data:e})}function d(e){return(0,n.p)({url:o.edit,method:"post",data:e})}function c(e){return(0,n.p)({url:o.delete,method:"post",data:e})}var m=t(47695),p=function(){var e=this,a=e._self._c;return a("a-modal",{attrs:{title:e.title,width:720,visible:e.visible,confirmLoading:e.confirmLoading,maskClosable:!1},on:{ok:e.handleSubmit,cancel:e.handleCancel}},[a("a-spin",{attrs:{spinning:e.confirmLoading}},[a("a-form",{attrs:{form:e.form}},[a("a-form-item",{attrs:{label:"套餐名称",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"便于后台查找，例如：充100元送10元"}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["plan_name",{rules:[{required:!0,min:2,message:"请输入至少2个字符"}]}],expression:"['plan_name', {rules: [{required: true, min: 2, message: '请输入至少2个字符'}]}]"}]})],1),a("a-form-item",{attrs:{label:"充值金额",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"会员充值并支付的金额"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["money",{rules:[{required:!0,message:"请输入充值的金额"}]}],expression:"['money', {rules: [{required: true, message: '请输入充值的金额'}]}]"}],attrs:{min:.01}}),a("span",{staticClass:"ml-10"},[e._v("元")])],1),a("a-form-item",{attrs:{label:"赠送金额",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"充值成功后赠送的金额，不能大于充值金额"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["gift_money",{rules:[{required:!0,message:"请输入赠送的金额"}]}],expression:"['gift_money', {rules: [{required: true, message: '请输入赠送的金额'}]}]"}],attrs:{min:.01}}),a("span",{staticClass:"ml-10"},[e._v("元")])],1),a("a-form-item",{attrs:{label:"排序",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"数字越小越靠前"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["sort",{initialValue:100,rules:[{required:!0,message:"请输入排序值"}]}],expression:"['sort', {initialValue: 100, rules: [{required: true, message: '请输入排序值'}]}]"}],attrs:{min:0}})],1)],1)],1)],1)},v=[],_={data:function(){return{title:"新增充值套餐",labelCol:{span:7},wrapperCol:{span:13},visible:!1,confirmLoading:!1,form:this.$form.createForm(this)}},methods:{add:function(){this.visible=!0},handleSubmit:function(e){var a=this;e.preventDefault();var t=this.form.validateFields;t((function(e,t){!e&&a.onFormSubmit(t)}))},handleCancel:function(){this.visible=!1,this.form.resetFields()},onFormSubmit:function(e){var a=this;this.confirmLoading=!0,u({form:e}).then((function(t){a.$message.success(t.message,1.5),a.handleCancel(),a.$emit("handleSubmit",e)})).finally((function(){a.confirmLoading=!1}))}}},f=_,h=t(81656),g=(0,h.A)(f,p,v,!1,null,null,null),w=g.exports,C=function(){var e=this,a=e._self._c;return a("a-modal",{attrs:{title:e.title,width:720,visible:e.visible,confirmLoading:e.confirmLoading,maskClosable:!1},on:{ok:e.handleSubmit,cancel:e.handleCancel}},[a("a-spin",{attrs:{spinning:e.confirmLoading}},[a("a-form",{attrs:{form:e.form}},[a("a-form-item",{attrs:{label:"套餐名称",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"便于后台查找，例如：充100元送10元"}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["plan_name",{rules:[{required:!0,min:2,message:"请输入至少2个字符"}]}],expression:"['plan_name', {rules: [{required: true, min: 2, message: '请输入至少2个字符'}]}]"}]})],1),a("a-form-item",{attrs:{label:"充值金额",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"会员充值并支付的金额"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["money",{rules:[{required:!0,message:"请输入充值的金额"}]}],expression:"['money', {rules: [{required: true, message: '请输入充值的金额'}]}]"}],attrs:{min:.01}}),a("span",{staticClass:"ml-10"},[e._v("元")])],1),a("a-form-item",{attrs:{label:"赠送金额",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"充值成功后赠送的金额，不能大于充值金额"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["gift_money",{rules:[{required:!0,message:"请输入赠送的金额"}]}],expression:"['gift_money', {rules: [{required: true, message: '请输入赠送的金额'}]}]"}],attrs:{min:.01}}),a("span",{staticClass:"ml-10"},[e._v("元")])],1),a("a-form-item",{attrs:{label:"排序",labelCol:e.labelCol,wrapperCol:e.wrapperCol,extra:"数字越小越靠前"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["sort",{initialValue:100,rules:[{required:!0,message:"请输入排序值"}]}],expression:"['sort', {initialValue: 100, rules: [{required: true, message: '请输入排序值'}]}]"}],attrs:{min:0}})],1)],1)],1)],1)},b=[],x=t(91863),y=t.n(x),E={data:function(){return{title:"编辑充值套餐",labelCol:{span:7},wrapperCol:{span:13},visible:!1,confirmLoading:!1,form:this.$form.createForm(this),record:{}}},methods:{edit:function(e){this.visible=!0,this.record=e,this.setFieldsValue()},setFieldsValue:function(){var e=this,a=this.form.setFieldsValue;this.$nextTick((function(){a(y()(e.record,["plan_name","money","gift_money","sort"]))}))},handleSubmit:function(e){var a=this;e.preventDefault();var t=this.form.validateFields;t((function(e,t){!e&&a.onFormSubmit(t)}))},handleCancel:function(){this.visible=!1,this.form.resetFields()},onFormSubmit:function(e){var a=this;this.confirmLoading=!0,d({planId:this.record.plan_id,form:e}).then((function(t){a.$message.success(t.message,1.5),a.handleCancel(),a.$emit("handleSubmit",e)})).finally((function(){a.confirmLoading=!1}))}}},I=E,S=(0,h.A)(I,C,b,!1,null,null,null),k=S.exports,q={name:"Index",components:{STable:m.Wd,AddForm:w,EditForm:k},data:function(){var e=this;return{queryParam:{},isLoading:!1,columns:[{title:"套餐ID",dataIndex:"plan_id"},{title:"套餐名称",dataIndex:"plan_name"},{title:"充值金额 (元)",dataIndex:"money",scopedSlots:{customRender:"money"}},{title:"赠送金额 (元)",dataIndex:"gift_money",scopedSlots:{customRender:"gift_money"}},{title:"排序",dataIndex:"sort"},{title:"添加时间",dataIndex:"create_time"},{title:"操作",dataIndex:"action",width:"180px",scopedSlots:{customRender:"action"}}],loadData:function(a){return l((0,s.A)((0,s.A)({},a),e.queryParam)).then((function(e){return e.data.list}))}}},created:function(){},methods:{handleAdd:function(){this.$refs.AddForm.add()},handleEdit:function(e){this.$refs.EditForm.edit(e)},handleDelete:function(e){var a=this,t=this.$confirm({title:"您确定要删除该记录吗?",content:"删除后不可恢复",onOk:function(){return c({planId:e.plan_id}).then((function(e){a.$message.success(e.message,1.5),a.handleRefresh()})).finally((function(e){t.destroy()}))}})},handleRefresh:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.$refs.table.refresh(e)},onSearch:function(){this.handleRefresh(!0)}}},N=q,V=(0,h.A)(N,r,i,!1,null,null,null),A=V.exports},12690:function(e,a,t){t.r(a),t.d(a,{default:function(){return y}});t(26099),t(27495),t(42781),t(5746);var r=function(){var e=this,a=e._self._c;return a("a-card",{attrs:{bordered:!1}},[a("div",{staticClass:"card-title"},[e._v(e._s(e.$route.meta.title))]),a("div",{staticClass:"table-operator"},[a("a-row",[a("a-col",{attrs:{span:6}},[e.$auth("/market/seckill/create")?a("a-button",{attrs:{type:"primary",icon:"plus"},on:{click:e.handleAdd}},[e._v("新增")]):e._e()],1),a("a-col",{attrs:{span:8,offset:10}},[a("a-input-search",{staticStyle:{"max-width":"300px","min-width":"150px",float:"right"},attrs:{placeholder:"请输入限时秒杀商品名称"},on:{search:e.onSearch},model:{value:e.queryParam.search,callback:function(a){e.$set(e.queryParam,"search",a)},expression:"queryParam.search"}})],1)],1)],1),a("s-table",{ref:"table",attrs:{rowKey:"id",loading:e.isLoading,columns:e.columns,data:e.loadData,pageSize:15},scopedSlots:e._u([{key:"target_price",fn:function(t,r){return[a("span",[e._v("¥"+e._s(r.product_sku.price)+" -> ")]),a("span",{staticClass:"c-p mlr-2"},[e._v("¥"+e._s(t))])]}},{key:"duetime",fn:function(t){return[a("span",[e._v(e._s(t.adjust_at))]),t.turn_back?a("span",[e._v(" ~ "+e._s(e.moment(t.turn_back.adjust_at).format("HH:mm:ss")))]):e._e()]}},{key:"repeat",fn:function(t){return[t.every?[a("span",[e._v("每 "+e._s(t.every)+" "+e._s(t.repeat))])]:a("a-tag",[e._v("否")])]}},{key:"is_show",fn:function(t){return[a("a-tag",{attrs:{color:t?"green":""}},[e._v(e._s(t?"显示":"隐藏"))])]}},{key:"action",fn:function(t){return a("span",{staticClass:"actions"},[e.$auth("/market/seckill/update")?a("a",{on:{click:function(a){return e.handleEdit(t)}}},[e._v("编辑")]):e._e(),a("a",{directives:[{name:"action",rawName:"v-action:delete",arg:"delete"}],on:{click:function(a){return e.handleDelete(t)}}},[e._v("删除")])])}}])}),a("PriceScheduleEdit",{ref:"EditForm",on:{handleSubmit:e.handleRefresh}})],1)},i=[],s=t(57888),n=(t(25440),t(26222)),o={list:"/scheduled_prices",detail:"/market.seckill/detail",receive:"/market.seckill/receive",add:"/market.seckill/add",edit:"/market.seckill/edit",delete:"/scheduled_prices/{id}"};function l(e){return(0,n.p)({url:o.list,method:"get",params:e})}var u=t(5893),d=t(47695),c=t(35230),m=new c.A([{key:"ALL",name:"全部商品",value:10},{key:"SOME_GOODS",name:"指定商品",value:20}]),p=new c.A([{key:"RECEIVE",name:"领取后",value:10},{key:"FIXED_TIME",name:"固定时间",value:20}]),v=new c.A([{key:"FULL_DISCOUNT",name:"限时秒杀",value:10},{key:"DISCOUNT",name:"实时秒杀",value:20}]),_=t(19134),f=t(47026),h=t(95093),g=t.n(h),w={name:"Index",components:{STable:d.Wd,PriceScheduleEdit:_.A},data:function(){var e=this;return{queryParam:{with_turn_back:"only",valid:!0,area_id:f.A.getters.areaId},ApplyRangeEnum:m,SeckillTypeEnum:v,ExpireTypeEnum:p,isLoading:!1,columns:[{title:"秒杀ID",dataIndex:"id"},{title:"商品名称",dataIndex:"product.title"},{title:"秒杀价格",dataIndex:"target_price",scopedSlots:{customRender:"target_price"}},{title:"秒杀时间范围",scopedSlots:{customRender:"duetime"}},{title:"自动重复",scopedSlots:{customRender:"repeat"}},{title:"状态",dataIndex:"is_show",scopedSlots:{customRender:"is_show"}},{title:"操作",width:"180px",scopedSlots:{customRender:"action"}}],loadData:function(a){return l((0,s.A)((0,s.A)({},a),e.queryParam)).then((function(e){return e}))}}},created:function(){},methods:{moment:g(),handleAdd:function(){this.$refs.EditForm.create()},handleEdit:function(e){this.$refs.EditForm.edit(e)},handleDelete:function(e){var a=this,t=this.$confirm({title:"您确定要删除该记录吗?",content:"删除后不可恢复",onOk:function(){return u.Kv(e.product_id,e.id).then((function(e){a.$message.success("已删除",1.5),a.handleRefresh()})).finally((function(e){t.destroy()}))}})},handleRefresh:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.$refs.table.refresh(e)},onSearch:function(){this.handleRefresh(!0)}}},C=w,b=t(81656),x=(0,b.A)(C,r,i,!1,null,null,null),y=x.exports},94197:function(e,a,t){t.d(a,{KF:function(){return d},Rm:function(){return o},WQ:function(){return l},_0:function(){return n},hc:function(){return u},p_:function(){return s}});t(27495),t(25440);var r=t(26222),i={list:"/assists",detail:"/assists/{id}",log:"/assists/logs",add:"/assists",edit:"/assists/{id}",delete:"/assists/{id}"};function s(e){return(0,r.p)({url:i.list,method:"get",params:e})}function n(e,a){return(0,r.p)({url:i.detail.replace("{id}",e),method:"get",params:a})}function o(e){return(0,r.p)({url:i.log,method:"get",params:e})}function l(e){return(0,r.p)({url:i.add,method:"post",data:e})}function u(e,a){return(0,r.p)({url:i.edit.replace("{id}",e),method:"patch",data:a})}function d(e){return(0,r.p)({url:i.delete.replace("{id}",e),method:"delete"})}},25962:function(e,a,t){t.d(a,{_:function(){return n},y:function(){return o}});var r=t(57888),i=t(26222),s={detail:"/setting/detail",update:"/setting/update"};function n(e){return(0,i.p)({url:s.detail,method:"get",params:{key:e}})}function o(e,a){return(0,i.p)({url:s.update,method:"post",data:(0,r.A)({key:e},a)})}},28178:function(e,a,t){t.d(a,{dw:function(){return i},kM:function(){return n},HC:function(){return s}});var r=t(35230),i=new r.A([{key:"ALL",name:"全部商品",value:10},{key:"SOME_GOODS",name:"指定商品",value:20}]),s=new r.A([{key:"RECEIVE",name:"领取后",value:"from_gain"},{key:"FIXED_TIME",name:"固定时间",value:"fixed_time"}]),n=new r.A([{key:"FULL_DISCOUNT",name:"满减券",value:"discount"},{key:"DISCOUNT",name:"折扣券",value:"percent"}])},93901:function(e,a,t){var r=t(35230);a.A=new r.A([{key:"RECHARGE",name:"用户充值",value:10},{key:"CONSUME",name:"用户消费",value:20},{key:"ADMIN",name:"管理员操作",value:30},{key:"REFUND",name:"订单退款",value:40}])}}]);
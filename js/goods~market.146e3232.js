(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["goods~market"],{"15bd":function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-modal",{attrs:{title:e.title,width:720,visible:e.visible,confirmLoading:e.confirmLoading,maskClosable:!1},on:{ok:e.handleSubmit,cancel:e.handleCancel}},[a("a-spin",{attrs:{spinning:e.confirmLoading}},[a("a-form",{attrs:{form:e.form}},[a("a-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.goodsId,expression:"!goodsId"}],attrs:{label:"选择商品",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("SelectGoods",{directives:[{name:"decorator",rawName:"v-decorator",value:["product_id",{rules:[{required:!0,message:"请选择指定的商品"}]}],expression:"['product_id', { rules: [{ required: true, message: '请选择指定的商品' }] }]"}],attrs:{multiple:!1,disabled:e.isEditing,defaultList:e.containGoodsList},on:{change:e.selectGoods}})],1),a("a-form-item",{attrs:{label:"选择规格",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["sku_id",{rules:[{required:!0,message:"请选择目标规格"}]}],expression:"['sku_id', {rules: [{required: true, message: '请选择目标规格'}]}]"}],attrs:{options:e.skusOption,disabled:e.isEditing},on:{change:e.selectSku}})],1),a("a-form-item",{attrs:{label:"调整价格",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["target_dates",{rules:[{required:e.targetDatesOption.length>0,message:"请选择对应团期"}]}],expression:"['target_dates', {rules: [{required: targetDatesOption.length > 0, message: '请选择对应团期'}]}]"},{name:"show",rawName:"v-show",value:e.targetDatesOption.length,expression:"targetDatesOption.length"}],staticStyle:{width:"200px"},attrs:{mode:"multiple",options:e.targetDatesOption}}),a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["target_price",{rules:[{required:!0,message:"请输入目标调整的价格"}]}],expression:"['target_price', {rules: [{required: true, message: '请输入目标调整的价格'}]}]"}],attrs:{min:.01,precision:2}}),e._v(" 元 "),e.form.getFieldValue("sku_id")&&e.skus.length?a("p",{staticClass:"form-item-help"},[e.targetDatesOption.length?e.form.getFieldValue("target_dates")&&1==e.form.getFieldValue("target_dates").length?a("small",[e._v("当前价格："+e._s(e.skus.find((function(t){return t.id==e.form.getFieldValue("sku_id")})).daily_price[e.form.getFieldValue("target_dates")[0]].price))]):e._e():a("small",[e._v("当前价格："+e._s(e.skus.find((function(t){return t.id==e.form.getFieldValue("sku_id")})).price))])]):e._e()],1),a("a-form-item",{attrs:{label:"调整库存",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-switch",{model:{value:e.isChangeStock,callback:function(t){e.isChangeStock=t},expression:"isChangeStock"}}),a("a-input-number",{directives:[{name:"show",rawName:"v-show",value:e.isChangeStock,expression:"isChangeStock"},{name:"decorator",rawName:"v-decorator",value:["target_stock"],expression:"['target_stock']"}],attrs:{min:0}}),e.form.getFieldValue("sku_id")&&e.skus.length?a("p",{staticClass:"form-item-help"},[e.targetDatesOption.length?e.form.getFieldValue("target_dates")&&1==e.form.getFieldValue("target_dates").length?a("small",[e._v("当前库存："+e._s(e.skus.find((function(t){return t.id==e.form.getFieldValue("sku_id")})).daily_price[e.form.getFieldValue("target_dates")[0]].stock))]):e._e():a("small",[e._v("当前库存："+e._s(e.skus.find((function(t){return t.id==e.form.getFieldValue("sku_id")})).stock))])]):e._e()],1),a("a-form-item",{attrs:{label:"模板",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-radio-group",{attrs:{"button-style":"solid"},on:{change:e.changeQuickOption},model:{value:e.quickOption,callback:function(t){e.quickOption=t},expression:"quickOption"}},[a("a-radio-button",{attrs:{value:"every_1_daily_at_6"}},[e._v("每天6点场")]),a("a-radio-button",{attrs:{value:"every_1_daily_at_9"}},[e._v("每天9点场")]),a("a-radio-button",{attrs:{value:"every_1_daily_at_12"}},[e._v("每天12点场")]),a("a-radio-button",{attrs:{value:"every_1_daily_at_16"}},[e._v("每天16点场")]),a("a-radio-button",{attrs:{value:"every_1_daily_at_20"}},[e._v("每天20点场")]),a("a-radio-button",{attrs:{value:"every_1_daily_at_0"}},[e._v("每天0点场")]),a("a-radio-button",{attrs:{value:""}},[e._v("自定义")])],1)],1),a("a-form-item",{directives:[{name:"show",rawName:"v-show",value:e.quickOption,expression:"quickOption"}],attrs:{label:"触发日期",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-date-picker",{attrs:{allowClear:!1},on:{change:e.changeQuickOption},model:{value:e.adjust_date,callback:function(t){e.adjust_date=t},expression:"adjust_date"}})],1),a("a-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.quickOption,expression:"!quickOption"}],attrs:{label:"触发时间",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-config-provider",{attrs:{locale:e.locale}},[a("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["adjust_at",{rules:[{required:!0,message:"请选择触发时间"}]}],expression:"['adjust_at', {rules: [{required: true, message: '请选择触发时间'}]}]"}],attrs:{"show-time":""}})],1)],1),a("a-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.quickOption,expression:"!quickOption"}],attrs:{label:"重复触发",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-switch",{model:{value:e.isRepeat,callback:function(t){e.isRepeat=t},expression:"isRepeat"}}),a("span",{directives:[{name:"show",rawName:"v-show",value:e.isRepeat,expression:"isRepeat"}]},[e._v(" 每 "),a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["every"],expression:"['every']"}]}),a("a-select",{directives:[{name:"show",rawName:"v-show",value:e.isRepeat,expression:"isRepeat"},{name:"decorator",rawName:"v-decorator",value:["repeat"],expression:"['repeat']"}],staticStyle:{width:"100px"}},[a("a-select-option",{attrs:{value:"daily"}},[e._v("天")]),a("a-select-option",{attrs:{value:"weekly"}},[e._v("周")]),a("a-select-option",{attrs:{value:"monthly"}},[e._v("月")]),a("a-select-option",{attrs:{value:"yearly"}},[e._v("年")])],1),e._v(" 触发 ")],1)],1),a("a-form-item",{attrs:{label:e.quickOption?"限时":"价格库存回改",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[a("a-switch",{directives:[{name:"show",rawName:"v-show",value:!e.quickOption,expression:"!quickOption"}],model:{value:e.isTurnBack,callback:function(t){e.isTurnBack=t},expression:"isTurnBack"}}),a("span",{directives:[{name:"show",rawName:"v-show",value:e.isTurnBack||e.quickOption,expression:"isTurnBack || quickOption"}]},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["turn_back_minutes",{initialValue:60,rules:[{required:!!e.quickOption,message:"请输入限时分钟数"}]}],expression:"['turn_back_minutes', {initialValue: 60, rules: [{required: !!quickOption, message: '请输入限时分钟数'}]}]"}],attrs:{min:1}}),e._v(" "+e._s(e.quickOption?"分钟":"分钟后"))],1)],1)],1)],1)],1)},i=[],n=a("5530"),s=a("1da1"),o=(a("96cf"),a("d81d"),a("b0c0"),a("7db0"),a("d3b7"),a("4de4"),a("38cf"),a("4d91")),l=a("d084"),u=a("2af9"),c=a("2ef0"),d=a.n(c),p=a("c1df"),m=a.n(p),v=a("40a7"),h={components:{SelectGoods:u["d"]},props:{goodsId:null,goodsSkus:o["a"].array.def([])},data:function(){return{gId:this.goodsId,skus:this.goodsSkus,title:"调价修改",labelCol:{span:7},wrapperCol:{span:13},visible:!1,confirmLoading:!1,form:this.$form.createForm(this),containGoodsList:[],record:{},selectedSkuId:0,isEditing:!1,isChangeStock:!1,isRepeat:!1,isTurnBack:!1,quickOption:"",adjust_date:m()(),locale:v["a"]}},computed:{skusOption:function(){return this.skus.map((function(e){return{value:e.id,label:e.name}}))},targetDatesOption:function(){var e,t=this,a=null===(e=this.skus.find((function(e){return e.id==t.selectedSkuId})))||void 0===e?void 0:e.daily_price;return a?d()(a).map((function(e,t){return{value:t,label:t}})).value():[]}},methods:{create:function(){this.visible=!0},edit:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var r,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(t.isEditing=!0,t.visible=!0,t.record=e,t.setFieldsValue(),t.gId||(t.gId=e.product_id),null!==(r=t.skus)&&void 0!==r&&r.length){a.next=10;break}return a.next=8,l["e"](t.gId);case 8:i=a.sent,t.skus=t.$store.getters.storeId?i.skus.filter((function(e){return e.store_id==t.$store.getters.storeId})):i.skus;case 10:if(t.goodsId){a.next=13;break}return a.next=13,t.getContainGoodsList();case 13:case"end":return a.stop()}}),a)})))()},getContainGoodsList:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a=e.record,r=[a.product_id],void 0===r||!r.length){t.next=6;break}return e.isLoading=!0,t.next=6,l["j"](r,{store_id:e.$store.getters.storeId}).then((function(t){e.containGoodsList=t.data})).finally((function(t){e.isLoading=!1}));case 6:case"end":return t.stop()}}),t)})))()},setFieldsValue:function(){var e=this,t=this.record,a=this.form.setFieldsValue;this.$nextTick((function(){var r=Object(c["pick"])(t,["product_id","target_dates","target_price","target_stock","repeat","every","adjust_at"]);r.sku_id=t.product_sku_id,t.turn_back&&(e.isTurnBack=!0,r.turn_back_minutes=m()(t.turn_back.adjust_at).diff(t.adjust_at,"minutes"),e.quickOption="every_"+t.every+"_"+t.repeat+"_at_"+m()(t.adjust_at).hour(),e.adjust_date=m()(t.adjust_at)),a(r)})),t.every&&t.repeat&&(this.isRepeat=!0),this.selectedSkuId=t.product_sku_id},selectSku:function(e){this.selectedSkuId=e},selectGoods:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!t.isEditing){a.next=2;break}return a.abrupt("return");case 2:return t.gId=e,a.next=5,l["e"](t.gId);case 5:r=a.sent,t.skus=t.$store.getters.storeId?r.skus.filter((function(e){return e.store_id==t.$store.getters.storeId})):r.skus,t.selectedSkuId=0,t.form.setFieldsValue({sku_id:null});case 9:case"end":return a.stop()}}),a)})))()},changeQuickOption:function(e){var t=1,a="daily",r=this.adjust_date;r.minute(0),r.second(0),this.quickOption&&("every_1_daily_at_6"==this.quickOption?r.hour(6):"every_1_daily_at_9"==this.quickOption?r.hour(9):"every_1_daily_at_12"==this.quickOption?r.hour(12):"every_1_daily_at_16"==this.quickOption?r.hour(16):"every_1_daily_at_20"==this.quickOption?r.hour(20):"every_1_daily_at_0"==this.quickOption?r.hour(0):this.quickOption="",this.isRepeat=!0,this.form.setFieldsValue({every:t,repeat:a,adjust_at:r}))},handleSubmit:function(e){var t=this;e.preventDefault();var a=this.form.validateFields;a((function(e,a){t.isChangeStock||(a.target_stock=null),a.adjust_at.local&&(a.adjust_at=a.adjust_at.local().format()),a.turn_back_seconds=60*a.turn_back_minutes,t.quickOption||t.isTurnBack||(a.turn_back_seconds=null),!e&&t.onFormSubmit(a)}))},handleCancel:function(){this.gId=null,this.skus=[],this.visible=!1,this.form.resetFields(),this.isEditing=!1,this.isChangeStock=!1,this.isRepeat=!1,this.quickOption=""},onFormSubmit:function(e){var t=this;this.confirmLoading=!0,this.isEditing?l["g"](this.record.product_id,this.record.id,Object(n["a"])({},e)).then((function(a){t.$message.success("已修改",1.5),t.handleCancel(),t.$emit("handleSubmit",e)})).finally((function(){t.confirmLoading=!1})):l["m"](this.gId,Object(n["a"])({},e)).then((function(a){t.$message.success("已新增",1.5),t.handleCancel(),t.$emit("handleSubmit",e)})).finally((function(){t.confirmLoading=!1}))}}},f=h,_=a("2877"),g=Object(_["a"])(f,r,i,!1,null,null,null);t["a"]=g.exports},"1da1":function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));a("d3b7");function r(e,t,a,r,i,n,s){try{var o=e[n](s),l=o.value}catch(u){return void a(u)}o.done?t(l):Promise.resolve(l).then(r,i)}function i(e){return function(){var t=this,a=arguments;return new Promise((function(i,n){var s=e.apply(t,a);function o(e){r(s,i,n,o,l,"next",e)}function l(e){r(s,i,n,o,l,"throw",e)}o(void 0)}))}}},"40a7":function(e,t,a){"use strict";var r=a("41b2"),i=a.n(r),n={today:"今天",now:"此刻",backToToday:"返回今天",ok:"确定",timeSelect:"选择时间",dateSelect:"选择日期",weekSelect:"选择周",clear:"清除",month:"月",year:"年",previousMonth:"上个月 (翻页上键)",nextMonth:"下个月 (翻页下键)",monthSelect:"选择月份",yearSelect:"选择年份",decadeSelect:"选择年代",yearFormat:"YYYY年",dayFormat:"D日",dateFormat:"YYYY年M月D日",dateTimeFormat:"YYYY年M月D日 HH时mm分ss秒",previousYear:"上一年 (Control键加左方向键)",nextYear:"下一年 (Control键加右方向键)",previousDecade:"上一年代",nextDecade:"下一年代",previousCentury:"上一世纪",nextCentury:"下一世纪"},s=a("87b8"),o={lang:i()({placeholder:"请选择日期",rangePlaceholder:["开始日期","结束日期"]},n),timePickerLocale:i()({},s["a"])};o.lang.ok="确 定";t["a"]=o},"87b8":function(e,t,a){"use strict";var r={placeholder:"请选择时间"};t["a"]=r},"88bc":function(e,t,a){(function(t){var a=1/0,r=9007199254740991,i="[object Arguments]",n="[object Function]",s="[object GeneratorFunction]",o="[object Symbol]",l="object"==typeof t&&t&&t.Object===Object&&t,u="object"==typeof self&&self&&self.Object===Object&&self,c=l||u||Function("return this")();function d(e,t,a){switch(a.length){case 0:return e.call(t);case 1:return e.call(t,a[0]);case 2:return e.call(t,a[0],a[1]);case 3:return e.call(t,a[0],a[1],a[2])}return e.apply(t,a)}function p(e,t){var a=-1,r=e?e.length:0,i=Array(r);while(++a<r)i[a]=t(e[a],a,e);return i}function m(e,t){var a=-1,r=t.length,i=e.length;while(++a<r)e[i+a]=t[a];return e}var v=Object.prototype,h=v.hasOwnProperty,f=v.toString,_=c.Symbol,g=v.propertyIsEnumerable,k=_?_.isConcatSpreadable:void 0,b=Math.max;function w(e,t,a,r,i){var n=-1,s=e.length;a||(a=x),i||(i=[]);while(++n<s){var o=e[n];t>0&&a(o)?t>1?w(o,t-1,a,r,i):m(i,o):r||(i[i.length]=o)}return i}function y(e,t){return e=Object(e),C(e,t,(function(t,a){return a in e}))}function C(e,t,a){var r=-1,i=t.length,n={};while(++r<i){var s=t[r],o=e[s];a(o,s)&&(n[s]=o)}return n}function O(e,t){return t=b(void 0===t?e.length-1:t,0),function(){var a=arguments,r=-1,i=b(a.length-t,0),n=Array(i);while(++r<i)n[r]=a[t+r];r=-1;var s=Array(t+1);while(++r<t)s[r]=a[r];return s[t]=n,d(e,this,s)}}function x(e){return S(e)||j(e)||!!(k&&e&&e[k])}function q(e){if("string"==typeof e||D(e))return e;var t=e+"";return"0"==t&&1/e==-a?"-0":t}function j(e){return I(e)&&h.call(e,"callee")&&(!g.call(e,"callee")||f.call(e)==i)}var S=Array.isArray;function F(e){return null!=e&&V(e.length)&&!N(e)}function I(e){return L(e)&&F(e)}function N(e){var t=R(e)?f.call(e):"";return t==n||t==s}function V(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=r}function R(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function L(e){return!!e&&"object"==typeof e}function D(e){return"symbol"==typeof e||L(e)&&f.call(e)==o}var Y=O((function(e,t){return null==e?{}:y(e,p(w(t,1),q))}));e.exports=Y}).call(this,a("c8ba"))}}]);